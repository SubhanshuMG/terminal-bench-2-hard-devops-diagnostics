New Terminal Output:

root@22c9b5817594:/app# cat > /tmp/fix_validator.py << 'EOF'
> #!/usr/bin/env python3
> import re
>
> # Read the original file
> with open('/app/validator.py', 'r') as f:
>     content = f.read()
>
> # Bug 1: Fix manifest access
> content = content.replace('return config["services"]', 'return config["deployment"]["services"]')
>
> # Bug 2: Fix health endpoint (use configured endpoint instead of hardcoded /health)
> content = content.replace("url = f\"http://127.0.0.1:{service['port']}/health\"", "url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"")
>
> # Bug 3: Fix graph edge direction in compute_startup_order
> # Find the problematic section and replace it
> old_section = '''    for svc, deps in deps_map.items():
>         for dep in deps:
>             # BUG-3: edge direction is reversed; graph is built backwards.
>             # This makes dependents appear before their dependencies.
>             graph[svc].append(dep)
>             in_degree[dep] += 1'''
>
> new_section = '''    for svc, deps in deps_map.items():
>         for dep in deps:
>             # Fixed: edge direction is correct; dependencies point to dependents
>             graph[dep].append(svc)
>             in_degree[svc] += 1'''
>
> content = content.replace(old_section, new_section)
>
> # Bug 4: Fix weight mapping
> content = content.replace('weight_map = {"high": 1, "medium": 1, "low": 1}', 'weight_map = {"high": 3, "medium": 2, "low": 1}')
>
> # Bug 5: Fix critical services check - only check high-criticality services
> old_critical_section = '''    # BUG-5: checks ALL services instead of only \'high\'-criticality ones
>     critical_ok = all(
>         statuses[s["name"]]["status"] == "healthy"
>         for s in services
>     )'''
>
> new_critical_section = '''    # Fixed: only check high-criticality services
>     critical_ok = all(
>         statuses[s["name"]]["status"] == "healthy"
>         for s in services
>         if s["criticality"] == "high"
>     )'''
>
> content = content.replace(old_critical_section, new_critical_section)
>
> # Write the fixed content back
> with open('/app/validator.py', 'w') as f:
>     f.write(content)
>
> print("Fixed all bugs in validator.py")
> EOF
root@22c9b5817594:/app#
