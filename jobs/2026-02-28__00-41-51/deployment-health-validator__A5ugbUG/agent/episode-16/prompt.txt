New Terminal Output:

root@7f535f315d6d:/app# cat > fix_validator.py << 'EOF'
> #!/usr/bin/env python3
> import re
>
> # Read the original file
> with open('/app/validator.py', 'r') as f:
>     content = f.read()
>
> # Fix 1: Health endpoint - replace hardcoded /health with dynamic endpoint
> content = re.sub(
>     r'f"http://127\.0\.0\.1:\{service\[\'port\'\]\}/health"',
>     'f"http://127.0.0.1:{service[\"port\"]}{service[\"health_endpoint\"]}"',
>     content
> )
>
> # Fix 2: Weight mapping - fix the criticality weights
> content = re.sub(
>     r'weight_map = \{"high": 1, "medium": 1, "low": 1\}',
>     'weight_map = {"high": 3, "medium": 2, "low": 1}',
>     content
> )
>
> # Fix 3: Dependency direction - fix the startup order logic
> # Replace the problematic dependency mapping
> content = re.sub(
>     r'for svc, deps in deps_map\.items\(\):\s*for dep in deps:\s*graph\[svc\]\.append\(dep\)\s*in_degree\[dep\] \+= 1',
>     '''for svc, deps in deps_map.items():
>         for dep in deps:
>             graph[dep].append(svc)
>             in_degree[svc] += 1''',
>     content,
>     flags=re.MULTILINE | re.DOTALL
> )
>
> # Fix 4: Critical services check - only check HIGH criticality services
> content = re.sub(
>     r'critical_ok = all\(\s*statuses\[s\["name"\]\]\["status"\] == "healthy"\s*for s in services\)',
>     'critical_ok = all(\n        statuses[s["name"]]["status"] == "healthy"\n        for s in services if s["criticality"] == "high"\n    )',
>     content
> )
>
> # Write the fixed content back
> with open('/app/validator.py', 'w') as f:
>     f.write(content)
>
> print("Fixed validator.py")
> EOF
root@7f535f315d6d:/app#
