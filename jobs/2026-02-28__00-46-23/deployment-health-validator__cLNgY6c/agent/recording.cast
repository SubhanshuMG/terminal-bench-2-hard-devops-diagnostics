{"version": 2, "width": 160, "height": 40, "timestamp": 1772219802, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.001616, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[0.985524, "i", "clear\r"]
[0.985853, "o", "clear\r\n\u001b[?2004l\r"]
[0.987614, "o", "\u001b[H\u001b[J\u001b[3J"]
[0.987765, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[2.524964, "i", "ls -la\n"]
[2.52573, "o", "ls -la\r\n\u001b[?2004l\r"]
[2.527285, "o", "total 32\r\ndrwxr-xr-x 1 root root 4096 Feb 27 19:11 .\r\ndrwxr-xr-x 1 root root 4096 Feb 27 19:16 ..\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10 Dockerfile\r\n-rw-r--r-- 1 root root  812 Feb 27 18:52 deployment_manifest.yaml\r\n-rw-r--r-- 1 root root 3096 Feb 27 18:52 mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53 requirements.txt\r\n-rw-r--r-- 1 root root 6072 Feb 27 19:05 validator.py\r\n"]
[2.527548, "o", "\u001b[?2004h"]
[2.527658, "o", "root@a5f76d8b05e3:/app# "]
[4.054547, "i", "cat deployment_manifest.yaml\n"]
[4.055595, "o", "cat deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[4.056184, "o", "deployment:\r\n  name: \"production-stack\"\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n      criticality: \"high\"\r\n\r\n    - name: \"cache-service\"\r\n      port: 8083\r\n      health_endpoint: \"/ping\"\r\n      dependencies: []\r\n      criticality: \"medium\"\r\n\r\n    - name: \"worker-service\"\r\n      port: 8084\r\n      health_endpoint: \"/status\"\r\n      dependencies:\r\n        - \"api-gateway\"\r\n        - \"cache-service\"\r\n      criticality: \"low\"\r\n\r\n    - name: \"notification-service\"\r\n      port: 8085\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"worker-service\"\r\n      criticality: \"low\"\r\n"]
[4.056358, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[5.371481, "i", "cat validator.py\n"]
[5.372824, "o", "cat validator.py\r\n\u001b[?2004l\r"]
[5.373569, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    return config[\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"\r\n    Probe a single service and return its health record.\r\n    HTTP 200 -> healthy; anything else -> unhealthy.\r\n    \"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}/health\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        return {\r\n            \"status\": \"healthy\" if resp.status_code == 200 else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\n# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality s"]
[5.373603, "o", "ervice is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\ndef main():\r\n    manifest_path = \"/app/deployment_manifest.yaml\"\r\n    output_path   = \"/app/deployment_report.json\"\r\n\r\n    print(\"Loading deployment manifest ...\")\r\n    services = load_services(manifest_path)\r\n\r\n    print(\"Checking service health ...\")\r\n    statuses = {}\r\n    for svc in services:\r\n        result = check_health(svc)\r\n        statuses[svc[\"name\"]] = result\r\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\r\n    print(\"Computing startup order ...\")\r\n    startup_order = compute_startup_order(services)\r\n    print(f\"  {' -> '.join(startup_order)}\")\r\n\r\n    print(\"Computing readiness score ...\")\r\n    score = compute_readiness_score(services, statuses)\r\n    print(f\"  score = {score:.4f}\")\r\n\r\n    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\r\n    report = {\r\n        \"deployment_name\":           \"production-stack\",\r\n        \"overall_status\":            overall_status,\r\n        \"readiness_score\":           score,\r\n        \"service_statuses\":          statuses,\r\n        \"startup_order\":             startup_order,\r\n        \"critical_services_healthy\": critical_ok,\r\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n    }\r\n\r\n    with open(output_path, \"w\") as f:\r\n        json.dump(report, f, indent=2)\r\n\r\n    print(f\"\\nReport written to {output_path}\")\r\n    print(f\"Overall status : {overall_status}\")\r\n    print(f\"Readiness score: {score}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n"]
[5.373692, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[6.931981, "i", "cp validator.py validator.py.backup\n"]
[6.932802, "o", "cp validator.py validator.py.backup\r\n\u001b[?2004l\r"]
[6.936464, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[11.64981, "i", "cat > validator.py << 'EOF'\n#!/usr/bin/env python3\n\"\"\"\nDeployment Health Validator\n===========================\nReads deployment_manifest.yaml, probes each service's health endpoint,\ncomputes a weighted readiness score, determines a valid startup ordering,\nand writes a deployment readiness report to /app/deployment_report.json.\n\"\"\"\n\nimport json\nimport yaml\nimport requests\nfrom datetime import datetime, timezone\nfrom collections import deque\n\n\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\n\ndef load_services(manifest_path: str) -> list:\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\n    with open(manifest_path) as f:\n        config = yaml.safe_load(f)\n    return config[\"services\"]\n\n\n# ── 2. Health check ───────────────────────────────────────────────────────────\n\ndef check_health(service: dict) -> dict:\n    \"\"\"\n    Probe a single service and return its health record.\n    HTTP 200 -> healthy; anything else -> unhealthy.\n    \"\"\"\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\n    try:\n        resp = requests.get(url, timeout=5)\n        return {\n            \"status\": \"healthy\" if resp.status_code == 200 else \"unhealthy\",\n            \"http_status\": resp.status_code,\n            \"criticality\": service[\"criticality\"],\n        }\n    except requests.exceptions.RequestException:\n        return {\n            \"status\": \"unhealthy\",\n            \"http_status\": 0,\n            \"criticality\": service[\"criticality\"],\n        }\n\n\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\n\ndef compute_startup_order(services: list) -> list:\n    \"\"\"\n    Return a topologically sorted startup order using Kahn's algorithm.\n    Dependencies must start before the services that depend on them.\n    \"\"\"\n    names = [s[\"name\"] for s in services]\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\n\n    graph     = {n: [] for n in names}\n    in_degree = {n: 0 for n in names}\n\n    for svc, deps in deps_map.items():\n        for dep in deps:\n            graph[dep].append(svc)\n            in_degree[svc] += 1\n\n    queue = deque(n for n in names if in_degree[n] == 0)\n    order = []\n    while queue:\n        node = queue.popleft()\n        order.append(node)\n        for neighbor in graph[node]:\n            in_degree[neighbor] -= 1\n            if in_degree[neighbor] == 0:\n                queue.append(neighbor)\n    return order\n\n\n# ── 4. Readiness score ────────────────────────────────────────────────────────\n\ndef compute_readiness_score(services: list, statuses: dict) -> float:\n    \"\"\"\n    Compute the weighted fraction of healthy services.\n    Criticality weights: high=3, medium=2, low=1.\n    \"\"\"\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\n\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\n    healthy = sum(\n        weight_map[s[\"criticality\"]]\n        for s in services\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\n    )\n    return round(healthy / total, 4) if total else 0.0\n\n\n# ── 5. Overall status ─────────────────────────────────────────────────────────\n\ndef determine_status(services: list, statuses: dict, score: float):\n    \"\"\"\n    Returns (overall_status, critical_services_healthy).\n\n    Status rules:\n      'healthy'   -- critical_services_healthy AND score >= 0.95\n      'degraded'  -- critical_services_healthy AND score < 0.95\n      'critical'  -- any high-criticality service is unhealthy\n      'not_ready' -- score < 0.70\n  "]
[11.650823, "i", "  \"\"\"\n    critical_ok = all(\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\n        for s in services\n        if s[\"criticality\"] == \"high\"\n    )\n\n    if not critical_ok:\n        return \"critical\", critical_ok\n    if score >= 0.95:\n        return \"healthy\", critical_ok\n    if score >= 0.70:\n        return \"degraded\", critical_ok\n    return \"not_ready\", critical_ok\n\n\n# ── main ──────────────────────────────────────────────────────────────────────\n\ndef main():\n    manifest_path = \"/app/deployment_manifest.yaml\"\n    output_path   = \"/app/deployment_report.json\"\n\n    print(\"Loading deployment manifest ...\")\n    services = load_services(manifest_path)\n\n    print(\"Checking service health ...\")\n    statuses = {}\n    for svc in services:\n        result = check_health(svc)\n        statuses[svc[\"name\"]] = result\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\n\n    print(\"Computing startup order ...\")\n    startup_order = compute_startup_order(services)\n    print(f\"  {' -> '.join(startup_order)}\")\n\n    print(\"Computing readiness score ...\")\n    score = compute_readiness_score(services, statuses)\n    print(f\"  score = {score:.4f}\")\n\n    overall_status, critical_ok = determine_status(services, statuses, score)\n\n    report = {\n        \"deployment_name\":           \"production-stack\",\n        \"overall_status\":            overall_status,\n        \"readiness_score\":           score,\n        \"service_statuses\":          statuses,\n        \"startup_order\":             startup_order,\n        \"critical_services_healthy\": critical_ok,\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\n    }\n\n    with open(output_path, \"w\") as f:\n        json.dump(report, f, indent=2)\n\n    print(f\"\\nReport written to {output_path}\")\n    print(f\"Overall status : {overall_status}\")\n    print(f\"Readiness score: {score}\")\n\n\nif __name__ == \"__main__\":\n    main()\nEOF\n"]
[11.652646, "o", "cat > validator.py << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> #!/usr/bin/env python3\r\n\u001b[?2004l\r\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> Deployment Health Validator\r\n\u001b[?2004l\r\u001b[?2004h> ===========================\r\n\u001b[?2004l\r\u001b[?2004h> Reads deployment_manifest.yaml, probes each service's health endpoint,\r\n\u001b[?2004l\r\u001b[?2004h> computes a weighted readiness score, determines a valid startup ordering,\r\n\u001b[?2004l\r\u001b[?2004h> and writes a deployment readiness report to /app/deployment_report.json.\r\n\u001b[?2004l\r\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> import json\r\n\u001b[?2004l\r\u001b[?2004h> import yaml\r\n\u001b[?2004l\r\u001b[?2004h> import requests\r\n\u001b[?2004l\r\r\n\r\n#\u001b[?2004h> from datetime import datetime, timezone\r\n\u001b[?2004l\r\u001b[?2004h> from collections import deque\r\n\u001b[?2004l\r──────"]
[11.652864, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.653082, "o", "# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\u001b[?2004l\r"]
[11.653167, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> def load_services(manifest_path: str) -> list:\r\n\u001b[?2004l\r"]
[11.653276, "o", "\u001b[?2004h> "]
[11.653353, "o", "    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.653436, "o", "    with open(manifest_path) as f:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.653533, "o", "        config = yaml.safe_load(f)\r\n\u001b[?2004l\rking service h\u001b[?2004h>     return config[\"services\"]\r\n\u001b[?2004l\r"]
[11.653584, "o", "ealth ...\")\r\n    statuses = {}\r\n"]
[11.653699, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.654326, "o", "# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.654398, "o", "def check_health(service: dict) -> dict:\r\n\u001b[?2004l\r...\")\r\n    startup_or\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\rder = co"]
[11.654412, "o", "\u001b[?2004h> "]
[11.654482, "o", "    Probe a single service and return its health record.\r\n\u001b[?2004l\r(\u001b[?2004h> "]
[11.654614, "o", "    HTTP 200 -> healthy; anything else -> unhealthy.\r\n\u001b[?2004l\rs sco\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\rre ...\")"]
[11.654658, "o", "\u001b[?2004h> "]
[11.654778, "o", "    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n\u001b[?2004l\re\u001b[?2004h"]
[11.654862, "o", ">     try:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.654941, "o", "        resp = requests.get(url, timeout=5)\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.655004, "o", ">         return {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.655134, "o", "            \"status\": \"healthy\" if resp.status_code == 200 else \"unhealthy\",\r\n\u001b[?2004l\rnt_name\":         \u001b[?2004h> "]
[11.655153, "o", "            \"http_status\": resp.status_code,\r\n\u001b[?2004l\r_status\u001b[?2004h> "]
[11.655319, "o", "            \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r\u001b[?2004h>     except requests.exceptions.RequestException:\r\n\u001b[?2004l\r"]
[11.655333, "o", "\u001b[?2004h> "]
[11.655456, "o", "        return {\r\n\u001b[?2004l\r\u001b[?2004h>             \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.655499, "o", "            \"http_status\": 0,\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.655656, "o", "> "]
[11.655829, "o", "            \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r \u001b[?2004h> "]
[11.655939, "o", "# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\u001b[?2004l\rnt(f\"Overa\u001b[?2004h> \r\n"]
[11.655974, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[11.656058, "o", "def compute_startup_order(services: list) -> list:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r"]
[11.656079, "o", "\u001b[?2004h> "]
[11.656188, "o", "    Return a topologically sorted startup order using Kahn's algorithm.\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.656272, "o", "    Dependencies must start before the services that depend on them.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r"]
[11.656297, "o", "\u001b[?2004h"]
[11.656317, "o", "> "]
[11.656391, "o", "    names = [s[\"name\"] for s in services]\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.656486, "o", "    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.656513, "o", "    graph     = {n: [] for n in names}\r\n\u001b[?2004l\r"]
[11.656528, "o", "\u001b[?2004h> "]
[11.656657, "o", "    in_degree = {n: 0 for n in names}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.656687, "o", "    for svc, deps in deps_map.items():\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.656754, "o", "        for dep in deps:\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.656776, "o", "> "]
[11.656846, "o", "            graph[dep].append(svc)\r\n\u001b[?2004l\r\u001b[?2004h>             in_degree[svc] += 1\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[11.656864, "o", "\u001b[?2004h> "]
[11.656969, "o", "    queue = deque(n for n in names if in_degree[n] == 0)\r\n\u001b[?2004l\r\u001b[?2004h>     order = []\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.65705, "o", "    while queue:\r\n\u001b[?2004l\r\u001b[?2004h>         node = queue.popleft()\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657146, "o", "        order.append(node)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657156, "o", "        for neighbor in graph[node]:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657232, "o", "            in_degree[neighbor] -= 1\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657271, "o", "            if in_degree[neighbor] == 0:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657384, "o", "                queue.append(neighbor)\r\n\u001b[?2004l\r\u001b[?2004h>     return order\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657533, "o", "# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n"]
[11.65761, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[11.657673, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n\u001b[?2004l\r"]
[11.657719, "o", "\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.65774, "o", "    Compute the weighted fraction of healthy services.\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657809, "o", "    Criticality weights: high=3, medium=2, low=1.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657867, "o", "    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.657903, "o", "    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.657911, "o", "> "]
[11.657996, "o", "    healthy = sum(\r\n\u001b[?2004l\r\u001b[?2004h>         weight_map[s[\"criticality\"]]\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.65826, "o", ">         for s in services\r\n\u001b[?2004l\r"]
[11.658438, "o", "\u001b[?2004h>         if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r\u001b[?2004h>     return round(healthy / total, 4) if total else 0.0\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.65867, "o", "# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.658901, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.65902, "o", "    Returns (overall_status, critical_services_healthy).\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     Status rules:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.659163, "o", "      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.659208, "o", "> "]
[11.659376, "o", "      'degraded'  -- critical_services_healthy AND score < 0.95\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.659413, "o", "      'critical'  -- any high-criticality service is unhealthy\r\n\u001b[?2004l\r\u001b[?2004h>       'not_ready' -- score < 0.70\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     critical_ok = all(\r\n\u001b[?2004l\r"]
[11.659591, "o", "\u001b[?2004h>         statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>         for s in services\r\n\u001b[?2004l\r\u001b[?2004h>         if s[\"criticality\"] == \"high\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r"]
[11.659621, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.659773, "o", "    if not critical_ok:\r\n\u001b[?2004l\r\u001b[?2004h>         return \"critical\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h>     if score >= 0.95:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.659788, "o", "        return \"healthy\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h>     if score >= 0.70:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.659974, "o", "        return \"degraded\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h>     return \"not_ready\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660073, "o", "# ── main ──────────────────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n"]
[11.660087, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[11.660163, "o", "def main():\r\n\u001b[?2004l\r\u001b[?2004h>     manifest_path = \"/app/deployment_manifest.yaml\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[11.660222, "o", ">     output_path   = \"/app/deployment_report.json\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660286, "o", "    print(\"Loading deployment manifest ...\")\r\n\u001b[?2004l\r\u001b[?2004h>     services = load_services(manifest_path)\r\n\u001b[?2004l\r"]
[11.660415, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     print(\"Checking service health ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660505, "o", "    statuses = {}\r\n\u001b[?2004l\r\u001b[?2004h>     for svc in services:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.66057, "o", "        result = check_health(svc)\r\n\u001b[?2004l\r\u001b[?2004h>         statuses[svc[\"name\"]] = result\r\n\u001b[?2004l\r"]
[11.660625, "o", "\u001b[?2004h> "]
[11.660702, "o", "        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660765, "o", "    print(\"Computing startup order ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660822, "o", "    startup_order = compute_startup_order(services)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660893, "o", "    print(f\"  {' -> '.join(startup_order)}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     print(\"Computing readiness score ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660919, "o", "    score = compute_readiness_score(services, statuses)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.660984, "o", "    print(f\"  score = {score:.4f}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[11.661048, "o", "\u001b[?2004h> "]
[11.66111, "o", "    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     report = {\r\n\u001b[?2004l\r"]
[11.661177, "o", "\u001b[?2004h> "]
[11.66126, "o", "        \"deployment_name\":           \"production-stack\",\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661275, "o", "        \"overall_status\":            overall_status,\r\n\u001b[?2004l\r"]
[11.661322, "o", "\u001b[?2004h>         \"readiness_score\":           score,"]
[11.661345, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661416, "o", "        \"service_statuses\":          statuses,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661469, "o", "        \"startup_order\":             startup_order,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.66149, "o", "        \"critical_services_healthy\": critical_ok,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661595, "o", "        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n\u001b[?2004l\r\u001b[?2004h>     }\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661659, "o", "    with open(output_path, \"w\") as f:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661712, "o", "        json.dump(report, f, indent=2)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[11.661787, "o", "    print(f\"\\nReport written to {output_path}\")\r\n\u001b[?2004l\r\u001b[?2004h>     print(f\"Overall status : {overall_status}\")\r\n"]
[11.661851, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[11.661869, "o", "    print(f\"Readiness score: {score}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> if __name__ == \"__main__\":\r\n\u001b[?2004l\r"]
[11.662025, "o", "\u001b[?2004h>     main()\r\n\u001b[?2004l\r\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[11.663524, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[14.477247, "i", "python3 -c \"\nimport re\n\n# Read the current file\nwith open('validator.py', 'r') as f:\n    content = f.read()\n\n# Fix 1: Use correct health endpoint\ncontent = re.sub(\n    r\\\"url = f\\\"http://127\\.0\\.0\\.1:\\{service\\['port'\\]\\}/health\\\"\\\",\n    r\\\"url = f\\\"http://127.0.0.1:\\{service['port']\\}\\{service['health_endpoint']}\\\"\\\",\n    content\n)\n\n# Fix 2: Fix weight mapping\ncontent = re.sub(\n    r\\\"weight_map = \\{\\\"high\\\": 1, \\\"medium\\\": 1, \\\"low\\\": 1\\}\\\",\n    r\\\"weight_map = {\\\"high\\\": 3, \\\"medium\\\": 2, \\\"low\\\": 1}\\\",\n    content\n)\n\n# Fix 3: Fix topological sort (swap the dependency direction)\ncontent = re.sub(\n    r\\\"for svc, deps in deps_map\\.items\\(\\):\\s+for dep in deps:\\s+graph\\[svc\\]\\.append\\(dep\\)\\s+in_degree\\[dep\\] \\+= 1\\\",\n    r\\\"for svc, deps in deps_map.items():\\n        for dep in deps:\\n            graph[dep].append(svc)\\n            in_degree[svc] += 1\\\",\n    content,\n    flags=re.MULTILINE | re.DOTALL\n)\n\n# Fix 4: Fix critical services check\ncontent = re.sub(\n    r\\\"critical_ok = all\\(\\s*statuses\\[s\\[\\\"name\\\"\\]\\]\\[\\\"status\\\"\\] == \\\"healthy\\\"\\s+for s in services\\s*\\)\\\",\n    r\\\"critical_ok = all(\\n        statuses[s[\\\"name\\\"]][\\\"status\\\"] == \\\"healthy\\\"\\n        for s in services\\n        if s[\\\"criticality\\\"] == \\\"high\\\"\\n    )\\\",\n    content\n)\n\n# Write the fixed content\nwith open('validator.py', 'w') as f:\n    f.write(content)\n\"\n"]
[14.477628, "o", "python3 -c \"\r\n\u001b[?2004l\r"]
[14.47771, "o", "\u001b[?2004h"]
[14.477817, "o", "> import re\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Read the current file\r\n\u001b[?2004l\r"]
[14.477851, "o", "\u001b[?2004h> "]
[14.477958, "o", "with open('validator.py', 'r') as f:\r\n\u001b[?2004l\r\u001b[?2004h>     content = f.read()\r\n\u001b[?2004l\r"]
[14.477968, "o", "\u001b[?2004h"]
[14.477981, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[14.478018, "o", "> "]
[14.479998, "o", "# Fix 1: Use correct health endpoint\r\n\u001b[?2004l\r\u001b[?2004h> content = re.sub(\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"url = f\\\"http://127\\.0\\.0\\.1:\\{service\\['port'\\]\\}/health\\\"\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"url = f\\\"http://127.0.0.1:\\{service['port']\\}\\{service['health_endpoint']}\\\"\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     content\r\n\u001b[?2004l\r\u001b[?2004h> )\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Fix 2: Fix weight mapping\r\n\u001b[?2004l\r\u001b[?2004h> content = re.sub(\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"weight_map = \\{\\\"high\\\": 1, \\\"medium\\\": 1, \\\"low\\\": 1\\}\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"weight_map = {\\\"high\\\": 3, \\\"medium\\\": 2, \\\"low\\\": 1}\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     content\r\n\u001b[?2004l\r\u001b[?2004h> )\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Fix 3: Fix topological sort (swap the dependency direction)\r\n\u001b[?2004l\r\u001b[?2004h> content = re.sub(\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"for svc, deps in deps_map\\.items\\(\\):\\s+for dep in deps:\\s+graph\\[svc\\]\\.append\\(dep\\)\\s+in_degree\\[dep\\] \\+= 1\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"for svc, deps in deps_map.items():\\n        for dep in deps:\\n            graph[dep].append(svc)\\n            in_degree[svc] += 1\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     content,\r\n\u001b[?2004l\r\u001b[?2004h>     flags=re.MULTILINE | re.DOTALL\r\n\u001b[?2004l\r\u001b[?2004h> )\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Fix 4: Fix critical services check\r\n\u001b[?2004l\r\u001b[?2004h> content = re.sub(\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"critical_ok = all\\(\\s*statuses\\[s\\[\\\"name\\\"\\]\\]\\[\\\"status\\\"\\] == \\\"healthy\\\"\\s+for s in services\\s*\\)\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     r\\\"critical_ok = all(\\n        statuses[s[\\\"name\\\"]][\\\"status\\\"] == \\\"healthy\\\"\\n        for s in services\\n        if s[\\\"criticality\\\"] == \\\"high\\\"\\n    )\\\",\r\n\u001b[?2004l\r\u001b[?2004h>     content\r\n\u001b[?2004l\r\u001b[?2004h> )\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Write the fixed content\r\n\u001b[?2004l\r\u001b[?2004h> with open('validator.py', 'w') as f:\r\n\u001b[?2004l\r\u001b[?2004h>     f.write(content)\r\n\u001b[?2004l\r\u001b[?2004h> \"\r\n\u001b[?2004l\r"]
[14.487367, "o", "  File \"<string>\", line 9\r\n    content = re.sub(\r\n                    ^\r\nSyntaxError: '(' was never closed\r\n"]
[14.48864, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[17.027803, "i", "sed -i \"s|url = f\\\"http://127.0.0.1:{service\\['port'\\]}/health\\\"|url = f\\\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\\\"|\" validator.py\n"]
[17.029137, "o", "sed -i \"s|url = f\\\"http://127.0.0.1:{service\\['port'\\]}/health\\\"|url = f\\\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\\\"|\" validator.py\r\n\u001b[?2004l\r"]
[17.031511, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[18.367456, "i", "grep -n \"health_endpoint\" validator.py\n"]
[18.367942, "o", "grep -n \"health_endpoint\" validator.py\r\n\u001b[?2004l\r"]
[18.369466, "o", "33:    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n"]
[18.369902, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[20.024541, "i", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' validator.py\n"]
[20.03095, "o", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' validator.py\r\n\u001b[?2004l\r"]
[20.034046, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[21.217545, "i", "grep -A 10 -B 2 \"for svc, deps in deps_map.items\" validator.py\n"]
[21.217969, "o", "grep -A 10 -B 2 \"for svc, deps in deps_map.items\" validator.py\r\n\u001b[?2004l\r"]
[21.218744, "o", "    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[dep].append(svc)\r\n            in_degree[svc] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n"]
[21.218962, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[22.940558, "i", "grep -A 5 -B 2 \"critical_ok = all\" validator.py\n"]
[22.965746, "o", "grep -A 5 -B 2 \"critical_ok = all\" validator.py\r\n\u001b[?2004l\r"]
[22.982945, "o", "      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n        if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[24.201634, "i", "python3 validator.py\n"]
[24.201836, "o", "python3 validator.py\r\n\u001b[?2004l\r"]
[24.294421, "o", "Loading deployment manifest ...\r\n"]
[24.296215, "o", "Traceback (most recent call last):\r\n  File \"/app/validator.py\", line 169, in <module>\r\n    main()\r\n"]
[24.296325, "o", "  File \"/app/validator.py\", line 131, in main\r\n    services = load_services(manifest_path)\r\n"]
[24.296847, "o", "               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/app/validator.py\", line 23, in load_services\r\n    return config[\"services\"]\r\n           ~~~~~~^^^^^^^^^^^^\r\nKeyError: 'services'\r\n"]
[24.308221, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[28.452738, "i", "head -15 deployment_manifest.yaml\n"]
[28.45483, "o", "head -15 deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[28.455025, "o", "deployment:\r\n  name: \"production-stack\"\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n"]
[28.455505, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[29.527443, "i", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' validator.py\n"]
[29.527762, "o", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' validator.py\r\n\u001b[?2004l\r"]
[29.529742, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[30.562869, "i", "python3 validator.py\n"]
[30.563171, "o", "python3 validator.py\r\n\u001b[?2004l\r"]
[30.653461, "o", "Loading deployment manifest ...\r\n"]
[30.654441, "o", "Checking service health ...\r\n"]
[30.655402, "o", "  auth-service              unhealthy  (HTTP 0)\r\n"]
[30.655681, "o", "  api-gateway               unhealthy  (HTTP 0)\r\n"]
[30.656023, "o", "  cache-service             unhealthy  (HTTP 0)\r\n"]
[30.656978, "o", "  worker-service            unhealthy  (HTTP 0)\r\n"]
[30.657507, "o", "  notification-service      unhealthy  (HTTP 0)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[30.657533, "o", "  score = 0.0000\r\n"]
[30.658172, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.0\r\n"]
[30.669809, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[34.571855, "i", "ps aux | grep mock\n"]
[34.572225, "o", "ps aux | grep mock\r\n\u001b[?2004l\r"]
[34.573421, "o", "bash: ps: command not found\r\n"]
[34.574333, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[35.621389, "i", "curl -v http://localhost:8081/health\n"]
[35.621957, "o", "curl -v http://localhost:8081/health\r\n\u001b[?2004l\r"]
[35.628393, "o", "* Host localhost:8081 was resolved.\r\n* IPv6: ::1\r\n* IPv4: 127.0.0.1\r\n*   Trying [::1]:8081...\r\n"]
[35.628507, "o", "* connect to ::1 port 8081 from ::1 port 54268 failed: Connection refused\r\n*   Trying 127.0.0.1:8081...\r\n* connect to 127.0.0.1 port 8081 from 127.0.0.1 port 42130 failed: Connection refused\r\n* Failed to connect to localhost port 8081 after 0 ms: Could not connect to server\r\n* closing connection #0\r\ncu"]
[35.628707, "o", "rl: (7) Failed to connect to localhost port 8081 after 0 ms: Could not connect to server\r\n"]
[35.629434, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[38.696872, "i", "head -20 mock_services.py\n"]
[38.697868, "o", "head -20 mock_services.py\r\n\u001b[?2004l\r"]
[38.698166, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nMock service health endpoints for the deployment stack.\r\n\r\nServices:\r\n  auth-service        -> port 8081  /health  -> 200\r\n  api-gateway         -> port 8082  /health  -> 200\r\n  cache-service       -> port 8083  /ping    -> 200\r\n  worker-service      -> port 8084  /status  -> 503  (degraded)\r\n  notification-service-> port 8085  /health  -> 200\r\n\"\"\"\r\n\r\nimport threading\r\nfrom flask import Flask, jsonify\r\n\r\nimport logging\r\nlog = logging.getLogger(\"werkzeug\")\r\nlog.setLevel(logging.ERROR)\r\n\r\n# ── auth-service ──────────────────────────────────────────────────────────────\r\n"]
[38.698333, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[40.039827, "i", "python3 mock_services.py &\n"]
[40.040114, "o", "python3 mock_services.py &\r\n\u001b[?2004l\r"]
[40.040195, "o", "[1] 878\r\n"]
[40.040232, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[40.147739, "o", "  started  auth-service         /health  -> http://0.0.0.0:8081\r\n"]
[40.147909, "o", " * Serving Flask app 'auth-service'\r\n * Debug mode: off\r\n"]
[40.148036, "o", "  started  api-gateway          /health  -> http://0.0.0.0:8082\r\n"]
[40.148297, "o", " * Serving Flask app 'api-gateway'\r\n"]
[40.148345, "o", " * Debug mode: off\r\n"]
[40.148453, "o", "  started  cache-service        /ping    -> http://0.0.0.0:8083\r\n"]
[40.148798, "o", " * Serving Flask app 'cache-service'\r\n"]
[40.148967, "o", " * Debug mode: off\r\n"]
[40.149067, "o", " * Serving Flask app 'worker-service'\r\n"]
[40.149238, "o", "  started  worker-service       /status  -> http://0.0.0.0:8084\r\n"]
[40.150122, "o", " * Debug mode: off\r\n"]
[40.150187, "o", "  started  notification-service /health  -> http://0.0.0.0:8085\r\n"]
[40.15041, "o", "All mock services running. Ctrl-C to stop.\r\n"]
[40.150626, "o", " * Serving Flask app 'notification-service'\r\n"]
[40.150695, "o", " * Debug mode: off\r\n"]
[43.403023, "i", "python3 validator.py\n"]
[43.403254, "o", "python3 validator.py\r\n"]
[43.403402, "o", "\u001b[?2004l\r"]
[43.471092, "o", "Loading deployment manifest ...\r\n"]
[43.472019, "o", "Checking service health ...\r\n"]
[43.474662, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[43.475675, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[43.476474, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[43.477338, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[43.478127, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[43.478148, "o", "  score = 0.9000\r\n"]
[43.478328, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[43.488844, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[47.835545, "i", "cat deployment_report.json\n"]
[47.835924, "o", "cat deployment_report.json\r\n\u001b[?2004l\r"]
[47.836643, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"degraded\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 503,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T19:17:25.977485+00:00\"\r\n}"]
[47.836822, "o", "\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[50.029723, "i", "echo \"Validator fixed successfully! The deployment report shows:\"\necho \"- Overall status: degraded (correct - all high services healthy, score < 0.95)\"\necho \"- Readiness score: 0.9 (correct - 4/5 services healthy with weights)\"\necho \"- Critical services healthy: true (correct - auth-service and api-gateway are healthy)\"\necho \"- Startup order: correct topological sort\"\n"]
[50.030978, "o", "echo \"Validator fixed successfully! The deployment report shows:\"\r\n\u001b[?2004l\rValidator fixed successfully! The deployment report shows:\r\n\u001b[?2004hroot@a5f76d8b05e3:/app# echo \"- Overall status: degraded (correct - all high services healthy, score < 0.95)\"\r\n\u001b[?2004l\r- Overall status: degraded (correct - all high services healthy, score < 0.95)\r\n\u001b[?2004hroot@a5f76d8b05e3:/app# echo \"- Readiness score: 0.9 (correct - 4/5 services healthy with weights)\"\r\n\u001b[?2004l\r- Readiness score: 0.9 (correct - 4/5 services healthy with weights)\r\n\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[50.031148, "o", "echo \"- Critical services healthy: true (correct - auth-service and api-gateway are healthy)\"\r\n\u001b[?2004l\r- Critical services healthy: true (correct - auth-service and api-gateway are healthy)\r\n\u001b[?2004hroot@a5f76d8b05e3:/app# "]
[50.0312, "o", "echo \"- Startup order: correct topological sort\"\r\n\u001b[?2004l\r- Startup order: correct topological sort\r\n\u001b[?2004hroot@a5f76d8b05e3:/app# "]
