{"version": 2, "width": 160, "height": 40, "timestamp": 1772220906, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.001639, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[0.969811, "i", "clear\r"]
[0.970027, "o", "clear\r\n\u001b[?2004l\r"]
[0.97057, "o", "\u001b[H\u001b[J\u001b[3J"]
[0.971071, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[2.468095, "i", "ls -la\n"]
[2.468348, "o", "ls -la\r\n\u001b[?2004l\r"]
[2.469879, "o", "total 32\r\n"]
[2.46997, "o", "drwxr-xr-x 1 root root 4096 Feb 27 19:22 .\r\ndrwxr-xr-x 1 root root 4096 Feb 27 19:35 ..\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10 Dockerfile\r\n-rw-r--r-- 1 root root 2068 Feb 27 19:22 deployment_manifest.yaml\r\n-rw-r--r-- 1 root root 3096 Feb 27 18:52 mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53 requirements.txt\r\n-rw-r--r-- 1 root root 6135 Feb 27 19:22 validator.py\r\n"]
[2.470306, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[3.474674, "i", "cat deployment_manifest.yaml\n"]
[3.475022, "o", "cat deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[3.476231, "o", "# ─────────────────────────────────────────────────────────────────────────────\r\n# deployment_manifest.yaml\r\n#\r\n# Deployment descriptor for the production stack.\r\n#\r\n# Schema notes:\r\n#   • The top-level 'services' block is a legacy v1 monitoring registry read\r\n#     by the external health-dashboard and alert-manager sidecar.  It is NOT\r\n#     the authoritative list for deployment ordering or health validation.\r\n#   • The authoritative service definitions live under 'deployment.services'.\r\n# ─────────────────────────────────────────────────────────────────────────────\r\n\r\n# Legacy monitoring-registry endpoint  (consumed by alert-manager, not by the validator)\r\nservices:\r\n  - name: \"metrics-collector\"\r\n    port: 9091\r\n    health_endpoint: \"/metrics\"\r\n    dependencies: []\r\n    criticality: \"low\"\r\n\r\n# ── Authoritative deployment configuration ────────────────────────────────────\r\ndeployment:\r\n  name: \"production-stack\"\r\n\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n      criticality: \"high\"\r\n\r\n    - name: \"cache-service\"\r\n      port: 8083\r\n      health_endpoint: \"/ping\"\r\n      dependencies: []\r\n      criticality: \"medium\"\r\n\r\n    - name: \"worker-service\"\r\n      port: 8084\r\n      health_endpoint: \"/status\"\r\n      dependencies:\r\n        - \"api-gateway\"\r\n        - \"cache-service\"\r\n      criticality: \"low\"\r\n\r\n    - name: \"notification-service\"\r\n      port: 8085\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"worker-service\"\r\n      criticality: \"low\"\r\n"]
[3.47635, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[4.61574, "i", "curl http://localhost:8081/health\n"]
[4.615999, "o", "curl http://localhost:8081/health\r\n\u001b[?2004l\r"]
[4.622921, "o", "curl: (7) Failed to connect to localhost port 8081 after 0 ms: Could not connect to server\r\n"]
[4.623397, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[5.682503, "i", "python /app/mock_services.py &\n"]
[5.683055, "o", "python /app/mock_services.py &\r\n"]
[5.683091, "o", "\u001b[?2004l\r[1] 590\r\n\u001b[?2004hroot@517c6a54f599:/app# "]
[5.778204, "o", " * Serving Flask app 'auth-service'\r\n * Debug mode: off\r\n"]
[5.778373, "o", "  started  auth-service         /health  -> http://0.0.0.0:8081\r\n"]
[5.778574, "o", " * Serving Flask app 'api-gateway'\r\n * Debug mode: off\r\n"]
[5.778724, "o", "  started  api-gateway          /health  -> http://0.0.0.0:8082\r\n"]
[5.778971, "o", " * Serving Flask app 'cache-service'\r\n"]
[5.779141, "o", "  started  cache-service        /ping    -> http://0.0.0.0:8083\r\n"]
[5.779362, "o", " * Debug mode: off\r\n"]
[5.779904, "o", "  started  worker-service       /status  -> http://0.0.0.0:8084\r\n"]
[5.78019, "o", " * Serving Flask app 'worker-service'\r\n"]
[5.78048, "o", "  started  notification-service /health  -> http://0.0.0.0:8085\r\nAll mock services running. Ctrl-C to stop.\r\n"]
[5.780939, "o", " * Debug mode: off\r\n"]
[5.781181, "o", " * Serving Flask app 'notification-service'\r\n"]
[5.781411, "o", " * Debug mode: off\r\n"]
[7.760555, "i", "curl http://localhost:8081/health\n"]
[7.761048, "o", "curl http://localhost:8081/health\r\n\u001b[?2004l\r"]
[7.766515, "o", "{\"status\":\"ok\",\"version\":\"2.1.0\"}\r\n"]
[7.766882, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[8.720181, "i", "cat validator.py\n"]
[8.72058, "o", "cat validator.py\r\n\u001b[?2004l\r"]
[8.721491, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"\r\n    Probe a single service and return its health record.\r\n    HTTP 200 -> healthy; anything else -> unhealthy.\r\n    \"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}/health\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        return {\r\n            \"status\": \"healthy\" if resp.status_code == 200 else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\n# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healt"]
[8.721581, "o", "hy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\ndef main():\r\n    manifest_path = \"/app/deployment_manifest.yaml\"\r\n    output_path   = \"/app/deployment_report.json\"\r\n\r\n    print(\"Loading deployment manifest ...\")\r\n    services = load_services(manifest_path)\r\n\r\n    print(\"Checking service health ...\")\r\n    statuses = {}\r\n    for svc in services:\r\n        result = check_health(svc)\r\n        statuses[svc[\"name\"]] = result\r\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\r\n    print(\"Computing startup order ...\")\r\n    startup_order = compute_startup_order(services)\r\n    print(f\"  {' -> '.join(startup_order)}\")\r\n\r\n    print(\"Computing readiness score ...\")\r\n    score = compute_readiness_score(services, statuses)\r\n    print(f\"  score = {score:.4f}\")\r\n\r\n    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\r\n    report = {\r\n        \"deployment_name\":           \"production-stack\",\r\n        \"overall_status\":            overall_status,\r\n        \"readiness_score\":           score,\r\n        \"service_statuses\":          statuses,\r\n        \"startup_order\":             startup_order,\r\n        \"critical_services_healthy\": critical_ok,\r\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n    }\r\n\r\n    with open(output_path, \"w\") as f:\r\n        json.dump(report, f, indent=2)\r\n\r\n    print(f\"\\nReport written to {output_path}\")\r\n    print(f\"Overall status : {overall_status}\")\r\n    print(f\"Readiness score: {score}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n\u001b[?2004hroot@517c6a54f599:/app# "]
[10.206602, "i", "cp validator.py validator.py.backup\n"]
[10.207055, "o", "cp validator.py validator.py.backup\r\n\u001b[?2004l\r"]
[10.209835, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[11.363824, "i", "sed -i \"s/return config\\[\\\"services\\\"\\]/return config['deployment']['services']/\" validator.py\n"]
[11.364759, "o", "sed -i \"s/return config\\[\\\"services\\\"\\]/return config['deployment']['services']/\" validator.py\r\n\u001b[?2004l\r"]
[11.367008, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[12.562595, "i", "sed -i \"s/url = f\\\"http:\\/\\/127\\.0\\.0\\.1:{service\\['port'\\]}\\/health\\\"/url = f\\\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\\\"/\" validator.py\n"]
[12.563015, "o", "sed -i \"s/url = f\\\"http:\\/\\/127\\.0\\.0\\.1:{service\\['port'\\]}\\/health\\\"/url = f\\\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\\\"/\" validator.py\r\n\u001b[?2004l\r"]
[12.563885, "o", "sed: -e expression #1, char 76: unknown option to `s'\r\n"]
[12.564012, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[13.683948, "i", "grep -n \"url = f\\\"http://127.0.0.1:\" validator.py\n"]
[13.684215, "o", "grep -n \"url = f\\\"http://127.0.0.1:\" validator.py\r\n\u001b[?2004l\r"]
[13.685547, "o", "34:    url = f\"http://127.0.0.1:{service['port']}/health\"\r\n"]
[13.685742, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[14.710907, "i", "sed -i \"34s|/health|{service['health_endpoint']}|\" validator.py\n"]
[14.711116, "o", "sed -i \"34s|/health|{service['health_endpoint']}|\" validator.py\r\n\u001b[?2004l\r"]
[14.711946, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[15.792718, "i", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' validator.py\n"]
[15.793625, "o", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' validator.py\r\n\u001b[?2004l\r"]
[15.795578, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[16.777176, "i", "sed -i 's/critical_ok = all(/critical_ok = all(/' validator.py\n"]
[16.777396, "o", "sed -i 's/critical_ok = all(/critical_ok = all(/' validator.py\r\n\u001b[?2004l\r"]
[16.778155, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[17.780594, "i", "grep -A 10 \"def determine_status\" validator.py\n"]
[17.780904, "o", "grep -A 10 \"def determine_status\" validator.py\r\n\u001b[?2004l\r"]
[17.781589, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n\u001b[?2004hroot@517c6a54f599:/app# "]
[18.783987, "i", "grep -A 15 \"critical_ok = all(\" validator.py\n"]
[18.78416, "o", "grep -A 15 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[18.784823, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n"]
[18.784893, "o", "        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\n"]
[18.78506, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[20.061259, "i", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' validator.py\n"]
[20.061638, "o", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' validator.py\r\n\u001b[?2004l\r"]
[20.062644, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[21.18851, "i", "grep -A 5 \"def load_services\" validator.py\n"]
[21.18886, "o", "grep -A 5 \"def load_services\" validator.py\r\n\u001b[?2004l\r"]
[21.189601, "o", "def load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config['deployment']['services']\r\n"]
[21.189833, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[22.17641, "i", "grep -A 5 \"def check_health\" validator.py\n"]
[22.176847, "o", "grep -A 5 \"def check_health\" validator.py\r\n\u001b[?2004l\r"]
[22.177259, "o", "def check_health(service: dict) -> dict:\r\n    \"\"\"\r\n    Probe a single service and return its health record.\r\n    HTTP 200 -> healthy; anything else -> unhealthy.\r\n    \"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n"]
[22.177586, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[23.193292, "i", "grep -A 2 \"weight_map = {\" validator.py\n"]
[23.193573, "o", "grep -A 2 \"weight_map = {\" validator.py\r\n\u001b[?2004l\r"]
[23.194481, "o", "    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n"]
[23.194554, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[24.216001, "i", "grep -A 10 \"def compute_readiness_score\" validator.py\n"]
[24.216313, "o", "grep -A 10 \"def compute_readiness_score\" validator.py\r\n\u001b[?2004l\r"]
[24.216923, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n"]
[24.216984, "o", "    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n"]
[24.217171, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[25.187027, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\n"]
[25.18733, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[25.18872, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[26.160255, "i", "grep -A 8 \"def compute_readiness_score\" validator.py\n"]
[26.16046, "o", "grep -A 8 \"def compute_readiness_score\" validator.py\r\n"]
[26.160836, "o", "\u001b[?2004l\r"]
[26.161922, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n"]
[26.162213, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[27.160845, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\" for s in services/for s in services/' validator.py\n"]
[27.161116, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\" for s in services/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[27.162108, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[28.122972, "i", "grep -A 5 \"total   = \" validator.py\n"]
[28.123176, "o", "grep -A 5 \"total   = \" validator.py"]
[28.123257, "o", "\r\n\u001b[?2004l\r"]
[28.124261, "o", "    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n"]
[28.124544, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[29.190256, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"/for s in services/' validator.py\n"]
[29.192353, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"/for s in services/' validator.py"]
[29.192631, "o", "\r\n\u001b[?2004l\r"]
[29.195082, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[30.245082, "i", "grep -A 5 \"total   = \" validator.py\n"]
[30.246369, "o", "grep -A 5 \"total   = \" validator.py\r\n\u001b[?2004l\r"]
[30.247687, "o", "    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n"]
[30.247922, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[31.248168, "i", "grep -A 5 \"critical_ok = all(\" validator.py\n"]
[31.248575, "o", "grep -A 5 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[31.249195, "o", "    critical_ok = all(\r\n"]
[31.249525, "o", "        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n\u001b[?2004hroot@517c6a54f599:/app# "]
[32.296093, "i", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\n"]
[32.296541, "o", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\r\n\u001b[?2004l\r"]
[32.298077, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[33.231097, "i", "grep -A 5 \"critical_ok = all(\" validator.py\n"]
[33.231372, "o", "grep -A 5 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[33.232105, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[33.232303, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[34.418223, "i", "python /app/validator.py\n"]
[34.41852, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[34.489639, "o", "Loading deployment manifest ...\r\n"]
[34.490922, "o", "Checking service health ...\r\n"]
[34.495882, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[34.496909, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[34.497923, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[34.498705, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[34.499425, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service"]
[34.499481, "o", "\r\n"]
[34.499615, "o", "Computing readiness score ...\r\n  score = 0.6000\r\n"]
[34.499663, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : not_ready\r\nReadiness score: 0.6\r\n"]
[34.507925, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[37.712756, "i", "cat /app/deployment_report.json\n"]
[37.712942, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[37.71344, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"not_ready\",\r\n  \"readiness_score\": 0.6,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 503,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"notification-service\",\r\n    \"worker-service\",\r\n    \"api-gateway\",\r\n    \"auth-service\",\r\n    \"cache-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T19:35:41.225874+00:00\"\r\n}"]
[37.713575, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[39.302992, "i", "grep -A 20 \"def compute_startup_order\" validator.py\n"]
[39.303943, "o", "grep -A 20 \"def compute_startup_order\" validator.py\r\n\u001b[?2004l\r"]
[39.304731, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n"]
[39.304778, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[40.735117, "i", "grep -A 30 \"for svc, deps in deps_map.items():\" validator.py\n"]
[40.735579, "o", "grep -A 30 \"for svc, deps in deps_map.items():\" validator.py\r\n\u001b[?2004l\r"]
[40.736157, "o", "    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n"]
[40.736421, "o", "\u001b[?2004h"]
[40.736638, "o", "root@517c6a54f599:/app# "]
[42.072172, "i", "sed -i 's/graph\\[svc\\]\\.append(dep);/graph[dep].append(svc);/' validator.py\n"]
[42.072682, "o", "sed -i 's/graph\\[svc\\]\\.append(dep);/graph[dep].append(svc);/' validator.py\r\n\u001b[?2004l\r"]
[42.074223, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[43.319602, "i", "grep -A 10 \"for svc, deps in deps_map.items():\" validator.py\n"]
[43.320052, "o", "grep -A 10 \"for svc, deps in deps_map.items():\" validator.py"]
[43.320086, "o", "\r\n\u001b[?2004l\r"]
[43.320676, "o", "    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n"]
[43.321014, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[44.624463, "i", "sed -i 's/graph\\[svc\\]\\.append(dep)/graph[dep].append(svc)/' validator.py\n"]
[44.624689, "o", "sed -i 's/graph\\[svc\\]\\.append(dep)/graph[dep].append(svc)/' validator.py\r\n\u001b[?2004l\r"]
[44.625893, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[45.813844, "i", "grep -A 3 \"for svc, deps in deps_map.items():\" validator.py\n"]
[45.814135, "o", "grep -A 3 \"for svc, deps in deps_map.items():\" validator.py\r\n\u001b[?2004l\r"]
[45.815057, "o", "    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[dep].append(svc)\r\n            in_degree[dep] += 1\r\n"]
[45.81522, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[47.056538, "i", "grep -A 10 \"def compute_readiness_score\" validator.py\n"]
[47.056726, "o", "grep -A 10 \"def compute_readiness_score\" validator.py\r\n\u001b[?2004l\r"]
[47.057453, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n"]
[47.057639, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[48.614494, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\n"]
[48.615075, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[48.617305, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[49.894341, "i", "grep -A 5 \"healthy = sum\" validator.py\n"]
[49.894643, "o", "grep -A 5 \"healthy = sum\" validator.py\r\n\u001b[?2004l\r"]
[49.895082, "o", "    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n"]
[49.895434, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[51.174872, "i", "python /app/validator.py\n"]
[51.175046, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[51.241337, "o", "Loading deployment manifest ...\r\n"]
[51.242636, "o", "Checking service health ...\r\n"]
[51.246612, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[51.247563, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[51.248486, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[51.24955, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[51.250453, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  notification-service\r\nComputing readiness score ...\r\n"]
[51.250514, "o", "  score = 0.9000\r\n"]
[51.250656, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.9\r\n"]
[51.259368, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[54.633924, "i", "cat /app/deployment_report.json\n"]
[54.637706, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"critical\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 503,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": false,\r\n  \"timestamp\": \"2026-02-27T19:35:57.976881+00:00\"\r\n}\u001b[?2004hroot@517c6a54f599:/app# "]
[56.433918, "i", "grep -A 25 \"def compute_startup_order\" validator.py\n"]
[56.434354, "o", "grep -A 25 \"def compute_startup_order\" validator.py\r\n\u001b[?2004l\r"]
[56.43575, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[dep].append(svc)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n"]
[56.435986, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[58.258771, "i", "sed -i 's/in_degree\\[dep\\] += 1/in_degree[svc] += 1/' validator.py\n"]
[58.26003, "o", "sed -i 's/in_degree\\[dep\\] += 1/in_degree[svc] += 1/' validator.py\r\n"]
[58.260161, "o", "\u001b[?2004l\r"]
[58.264477, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[59.615211, "i", "python /app/validator.py\n"]
[59.615688, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[59.763129, "o", "Loading deployment manifest ...\r\n"]
[59.764719, "o", "Checking service health ...\r\n"]
[59.770331, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[59.771492, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[59.772771, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[59.77382, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[59.774759, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n"]
[59.774996, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.9\r\n"]
[59.786358, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[63.348605, "i", "grep -A 10 \"def determine_status\" validator.py\n"]
[63.35005, "o", "grep -A 10 \"def determine_status\" validator.py\r\n\u001b[?2004l\r"]
[63.351753, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n"]
[63.351926, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[64.670936, "i", "grep -A 15 \"critical_ok = all(\" validator.py\n"]
[64.671292, "o", "grep -A 15 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[64.671794, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\n"]
[64.672347, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[66.286315, "i", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\n"]
[66.28687, "o", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\r\n\u001b[?2004l\r"]
[66.288455, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[67.698646, "i", "grep -A 5 \"critical_ok = all(\" validator.py\n"]
[67.699086, "o", "grep -A 5 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[67.700072, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[67.700384, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[69.22606, "i", "python /app/validator.py\n"]
[69.226648, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[69.311495, "o", "Loading deployment manifest ...\r\n"]
[69.313033, "o", "Checking service health ...\r\n"]
[69.317536, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[69.318626, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[69.319433, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[69.320134, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[69.321326, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 0.6000\r\n"]
[69.321564, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : not_ready\r\nReadiness score: 0.6\r\n"]
[69.331245, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[72.593986, "i", "grep -A 5 \"healthy = sum\" validator.py\n"]
[72.598298, "o", "grep -A 5 \"healthy = sum\" validator.py\r\n\u001b[?2004l\r    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\u001b[?2004hroot@517c6a54f599:/app# "]
[74.274678, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\n"]
[74.275447, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[74.277649, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[75.623121, "i", "grep -A 5 \"healthy = sum\" validator.py\n"]
[75.623328, "o", "grep -A 5 \"healthy = sum\" validator.py\r\n\u001b[?2004l\r"]
[75.624041, "o", "    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n"]
[75.624076, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[77.413331, "i", "python /app/validator.py\n"]
[77.413509, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[77.492965, "o", "Loading deployment manifest ...\r\n"]
[77.494216, "o", "Checking service health ...\r\n"]
[77.49862, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[77.499555, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[77.500232, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[77.500929, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[77.501496, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[77.501593, "o", "  score = 0.9000\r\n"]
[77.501695, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.9\r\n"]
[77.511085, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[81.076087, "i", "cat /app/deployment_report.json\n"]
[81.076334, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[81.077076, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"critical\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 503,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": false,\r\n  \"timestamp\": \"2026-02-27T19:36:24.228662+00:00\"\r\n}"]
[81.077125, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[82.674887, "i", "grep -A 8 \"critical_ok = all(\" validator.py\n"]
[82.675042, "o", "grep -A 8 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[82.675596, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n"]
[82.675902, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[85.490909, "i", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\n"]
[85.491164, "o", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\r\n\u001b[?2004l\r"]
[85.492498, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[87.132128, "i", "grep -A 5 \"critical_ok = all(\" validator.py\n"]
[87.132368, "o", "grep -A 5 \"critical_ok = all(\" validator.py"]
[87.132429, "o", "\r\n\u001b[?2004l\r"]
[87.133116, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[87.133327, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[88.634852, "i", "python /app/validator.py\n"]
[88.635021, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[88.699552, "o", "Loading deployment manifest ...\r\n"]
[88.700677, "o", "Checking service health ...\r\n"]
[88.702172, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[88.703048, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[88.703768, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[88.704444, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[88.705102, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 0.6000\r\n"]
[88.7053, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : not_ready\r\nReadiness score: 0.6\r\n"]
[88.71478, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[91.993685, "i", "grep -A 5 \"healthy = sum\" validator.py\n"]
[91.996528, "o", "grep -A 5 \"healthy = sum\" validator.py\r\n\u001b[?2004l\r"]
[91.997454, "o", "    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n"]
[91.997596, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[93.768437, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\n"]
[93.768676, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[93.770355, "o", "\u001b[?2004h"]
[93.770414, "o", "root@517c6a54f599:/app# "]
[95.122436, "i", "grep -A 5 \"healthy = sum\" validator.py\n"]
[95.122618, "o", "grep -A 5 \"healthy = sum\" validator.py\r\n\u001b[?2004l\r"]
[95.123601, "o", "    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n"]
[95.124022, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[96.530698, "i", "python /app/validator.py\n"]
[96.530815, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[96.599031, "o", "Loading deployment manifest ...\r\n"]
[96.600369, "o", "Checking service health ...\r\n"]
[96.604467, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[96.605507, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[96.606312, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[96.607117, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[96.607752, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n"]
[96.607915, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.9\r\n"]
[96.616871, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[100.035253, "i", "cat /app/deployment_report.json\n"]
[100.035569, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[100.036756, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"critical\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 503,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": false,\r\n  \"timestamp\": \"2026-02-27T19:36:43.335217+00:00\"\r\n}"]
[100.03698, "o", "\u001b[?2004h"]
[100.037097, "o", "root@517c6a54f599:/app# "]
[101.54711, "i", "grep -A 5 \"critical_ok = all(\" validator.py\n"]
[101.547528, "o", "grep -A 5 \"critical_ok = all(\" validator.py\r\n\u001b[?2004l\r"]
[101.548112, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[101.548411, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[103.14867, "i", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\n"]
[103.149419, "o", "sed -i 's/for s in services$/for s in services if s[\"criticality\"] == \"high\"/' validator.py\r\n\u001b[?2004l\r"]
[103.15098, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[105.977908, "i", "python /app/validator.py\n"]
[105.978497, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[106.05979, "o", "Loading deployment manifest ...\r\n"]
[106.061176, "o", "Checking service health ...\r\n"]
[106.064224, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[106.065033, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[106.065855, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[106.066564, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[106.067195, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[106.067304, "o", "  score = 0.6000\r\n"]
[106.067409, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : not_ready\r\nReadiness score: 0.6\r\n"]
[106.077156, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[119.232806, "i", "cat > validator_fixed.py << 'EOF'\n#!/usr/bin/env python3\n\"\"\"\nDeployment Health Validator\n===========================\nReads deployment_manifest.yaml, probes each service's health endpoint,\ncomputes a weighted readiness score, determines a valid startup ordering,\nand writes a deployment readiness report to /app/deployment_report.json.\n\"\"\"\n\nimport json\nimport yaml\nimport requests\nfrom datetime import datetime, timezone\nfrom collections import deque\n\n\ndef load_services(manifest_path: str) -> list:\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\n    with open(manifest_path) as f:\n        config = yaml.safe_load(f)\n    return config['deployment']['services']\n\n\ndef check_health(service: dict) -> dict:\n    \"\"\"\n    Probe a single service and return its health record.\n    HTTP 200 -> healthy; anything else -> unhealthy.\n    \"\"\"\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\n    try:\n        resp = requests.get(url, timeout=5)\n        return {\n            \"status\": \"healthy\" if resp.status_code == 200 else \"unhealthy\",\n            \"http_status\": resp.status_code,\n            \"criticality\": service[\"criticality\"],\n        }\n    except requests.exceptions.RequestException:\n        return {\n            \"status\": \"unhealthy\",\n            \"http_status\": 0,\n            \"criticality\": service[\"criticality\"],\n        }\n\n\ndef compute_startup_order(services: list) -> list:\n    \"\"\"\n    Return a topologically sorted startup order using Kahn's algorithm.\n    Dependencies must start before the services that depend on them.\n    \"\"\"\n    names = [s[\"name\"] for s in services]\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\n\n    graph = {n: [] for n in names}\n    in_degree = {n: 0 for n in names}\n\n    for svc, deps in deps_map.items():\n        for dep in deps:\n            graph[dep].append(svc)\n            in_degree[svc] += 1\n\n    queue = deque(n for n in names if in_degree[n] == 0)\n    order = []\n    while queue:\n        node = queue.popleft()\n        order.append(node)\n        for neighbor in graph[node]:\n            in_degree[neighbor] -= 1\n            if in_degree[neighbor] == 0:\n                queue.append(neighbor)\n    return order\n\n\ndef compute_readiness_score(services: list, statuses: dict) -> float:\n    \"\"\"\n    Compute the weighted fraction of healthy services.\n    Criticality weights: high=3, medium=2, low=1.\n    \"\"\"\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\n\n    total = sum(weight_map[s[\"criticality\"]] for s in services)\n    healthy = sum(\n        weight_map[s[\"criticality\"]]\n        for s in services\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\n    )\n    return round(healthy / total, 4) if total else 0.0\n\n\ndef determine_status(services: list, statuses: dict, score: float):\n    \"\"\"\n    Returns (overall_status, critical_services_healthy).\n\n    Status rules:\n      'healthy'   -- critical_services_healthy AND score >= 0.95\n      'degraded'  -- critical_services_healthy AND score < 0.95\n      'critical'  -- any high-criticality service is unhealthy\n      'not_ready' -- score < 0.70\n    \"\"\"\n    critical_ok = all(\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\n        for s in services if s[\"criticality\"] == \"high\"\n    )\n\n    if not critical_ok:\n        return \"critical\", critical_ok\n    if score >= 0.95:\n        return \"healthy\", critical_ok\n    if score >= 0.70:\n        return \"degraded\", critical_ok\n    return \"not_ready\", critical_ok\n\n\ndef main():\n    manifest_path = \"/app/deployment_manifest.yaml\"\n    output_path = \"/app/deployment_report.json\"\n\n    print(\"Loading deployment manifest ...\")\n    services = load_services(manifest_path)\n\n    print(\"Checking service health ...\")\n    statuses = {}\n    for svc in services:\n        result = check_health(svc)\n        statuses[svc[\"name\"]] = result\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\n\n    print(\"Computing startup order ...\")\n    startup_order = compute_startup_order(services)\n    print(f\"  {' -> '.join(startup_order)}\")\n\n    print(\"Computing readine"]
[119.23289, "i", "ss score ...\")\n    score = compute_readiness_score(services, statuses)\n    print(f\"  score = {score:.4f}\")\n\n    overall_status, critical_ok = determine_status(services, statuses, score)\n\n    report = {\n        \"deployment_name\": \"production-stack\",\n        \"overall_status\": overall_status,\n        \"readiness_score\": score,\n        \"service_statuses\": statuses,\n        \"startup_order\": startup_order,\n        \"critical_services_healthy\": critical_ok,\n        \"timestamp\": datetime.now(timezone.utc).isoformat(),\n    }\n\n    with open(output_path, \"w\") as f:\n        json.dump(report, f, indent=2)\n\n    print(f\"\\nReport written to {output_path}\")\n    print(f\"Overall status : {overall_status}\")\n    print(f\"Readiness score: {score}\")\n\n\nif __name__ == \"__main__\":\n    main()\nEOF\n"]
[119.233205, "o", "cat > validator_fixed.py << 'EOF'\r\n\u001b[?2004l\r"]
[119.233238, "o", "\u001b[?2004h> "]
[119.233332, "o", "#!/usr/bin/env python3\r\n\u001b[?2004l\r\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23339, "o", "Deployment Health Validator\r\n\u001b[?2004l\rrint(f\"  scor\u001b[?2004h> "]
[119.233495, "o", "===========================\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.233582, "o", "Reads deployment_manifest.yaml, probes each service's health endpoint,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.233745, "o", "computes a weighted readiness score, determines a valid startup ordering,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.233842, "o", "and writes a deployment readiness report to /app/deployment_report.json.\r\n\u001b[?2004l\r\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.233913, "o", "import json\r\n\u001b[?2004l\r\u001b[?2004h> import yaml\r\n\u001b[?2004l\r\u001b[?2004h> import requests\r\n\u001b[?2004l\r: statuses,\r\n        \"startup_\u001b[?2004h> "]
[119.234016, "o", "from datetime import datetime, timezone\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.234161, "o", "from collections import deque\r\n\u001b[?2004l\rhy\": critical_o\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.234418, "o", "def load_services(manifest_path: str) -> list:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     with open(manifest_path) as f:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.235113, "o", "        config = yaml.safe_load(f)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23514, "o", "    return config['deployment']['services']\r\n\u001b[?2004l\r"]
[119.235344, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.236455, "o", "def check_health(service: dict) -> dict:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     Probe a single service and return its health record.\r\n\u001b[?2004l\r\u001b[?2004h>     HTTP 200 -> healthy; anything else -> unhealthy.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n\u001b[?2004l\r\u001b[?2004h>     try:\r\n\u001b[?2004l\r\u001b[?2004h>         resp = requests.get(url, timeout=5)\r\n\u001b[?2004l\r\u001b[?2004h>         return {\r\n\u001b[?2004l\r\u001b[?2004h>             \"status\": \"healthy\" if resp.status_code == 200 else \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h>             \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h>             \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r\u001b[?2004h>     except requests.exceptions.RequestException:\r\n\u001b[?2004l\r\u001b[?2004h>         return {\r\n\u001b[?2004l\r\u001b[?2004h>             \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h>             \"http_status\": 0,\r\n\u001b[?2004l\r\u001b[?2004h>             \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> def compute_startup_order(services: list) -> list:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     Return a topologically sorted startup order using Kahn's algorithm.\r\n\u001b[?2004l\r\u001b[?2004h>     Dependencies must start before the services that depend on them.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     names = [s[\"name\"] for s in services]\r\n\u001b[?2004l\r\u001b[?2004h>     deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     graph = {n: [] for n in names}\r\n\u001b[?2004l\r\u001b[?2004h>     in_degree = {n: 0 for n in names}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.236539, "o", "    for svc, deps in deps_map.items():\r\n\u001b[?2004l\r\u001b[?2004h>         for dep in deps:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.236874, "o", "            graph[dep].append(svc)\r\n\u001b[?2004l\r\u001b[?2004h>             in_degree[svc] += 1\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     queue = deque(n for n in names if in_degree[n] == 0)\r\n\u001b[?2004l\r\u001b[?2004h>     order = []\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23696, "o", "    while queue:\r\n\u001b[?2004l\r\u001b[?2004h>         node = queue.popleft()\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.237164, "o", "        order.append(node)\r\n\u001b[?2004l\r\u001b[?2004h>         for neighbor in graph[node]:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.237216, "o", "            in_degree[neighbor] -= 1\r\n\u001b[?2004l\r"]
[119.237359, "o", "\u001b[?2004h>             if in_degree[neighbor] == 0:\r\n\u001b[?2004l\r\u001b[?2004h>                 queue.append(neighbor)\r\n\u001b[?2004l\r\u001b[?2004h>     return order\r\n\u001b[?2004l\r"]
[119.237448, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> def compute_readiness_score(services: list, statuses: dict) -> float:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.237624, "o", "    \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     Compute the weighted fraction of healthy services.\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.237692, "o", "    Criticality weights: high=3, medium=2, low=1.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.237709, "o", "    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[119.237746, "o", "> "]
[119.237889, "o", "    total = sum(weight_map[s[\"criticality\"]] for s in services)\r\n\u001b[?2004l\r\u001b[?2004h>     healthy = sum(\r\n\u001b[?2004l\r\u001b[?2004h>         weight_map[s[\"criticality\"]]\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23791, "o", "        for s in services\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238124, "o", "        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r\u001b[?2004h>     return round(healthy / total, 4) if total else 0.0\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23816, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.238339, "o", ">     Returns (overall_status, critical_services_healthy).\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238389, "o", "    Status rules:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238445, "o", "      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23852, "o", "      'degraded'  -- critical_services_healthy AND score < 0.95\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.238556, "o", ">       'critical'  -- any high-criticality service is unhealthy\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238569, "o", "      'not_ready' -- score < 0.70\r\n\u001b[?2004l\r"]
[119.238635, "o", "\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r"]
[119.238657, "o", "\u001b[?2004h>     critical_ok = all(\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238715, "o", "        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23876, "o", "        for s in services if s[\"criticality\"] == \"high\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r"]
[119.238803, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     if not critical_ok:\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.238859, "o", ">         return \"critical\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238905, "o", "    if score >= 0.95:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238926, "o", "        return \"healthy\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238981, "o", "    if score >= 0.70:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.238998, "o", "        return \"degraded\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239065, "o", "    return \"not_ready\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239121, "o", "def main():\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239168, "o", "    manifest_path = \"/app/deployment_manifest.yaml\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239225, "o", "    output_path = \"/app/deployment_report.json\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23925, "o", "    print(\"Loading deployment manifest ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239333, "o", "    services = load_services(manifest_path)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239364, "o", "    print(\"Checking service health ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239395, "o", "    statuses = {}\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239449, "o", "    for svc in services:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239492, "o", "        result = check_health(svc)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239557, "o", "        statuses[svc[\"name\"]] = result\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239618, "o", "        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239676, "o", "    print(\"Computing startup order ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239712, "o", "    startup_order = compute_startup_order(services)\r\n\u001b[?2004l\r"]
[119.239767, "o", "\u001b[?2004h> "]
[119.239814, "o", "    print(f\"  {' -> '.join(startup_order)}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239856, "o", "    print(\"Computing readiness score ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239906, "o", "    score = compute_readiness_score(services, statuses)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.23994, "o", "    print(f\"  score = {score:.4f}\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.239961, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.240032, "o", "    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[119.240048, "o", ">     report = {\r\n\u001b[?2004l\r"]
[119.240118, "o", "\u001b[?2004h>         \"deployment_name\": \"production-stack\",\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.24016, "o", "        \"overall_status\": overall_status,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.240209, "o", "        \"readiness_score\": score,\r\n\u001b[?2004l\r\u001b[?2004h>         \"service_statuses\": statuses,\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.240219, "o", "> "]
[119.240311, "o", "        \"startup_order\": startup_order,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.240368, "o", "        \"critical_services_healthy\": critical_ok,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.240421, "o", "        \"timestamp\": datetime.now(timezone.utc).isoformat(),\r\n\u001b[?2004l\r\u001b[?2004h>     }\r\n\u001b[?2004l\r"]
[119.240446, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.24052, "o", "    with open(output_path, \"w\") as f:\r\n\u001b[?2004l\r\u001b[?2004h>         json.dump(report, f, indent=2)\r\n\u001b[?2004l\r"]
[119.240534, "o", "\u001b[?2004h> \r\n"]
[119.240606, "o", "\u001b[?2004l\r\u001b[?2004h>     print(f\"\\nReport written to {output_path}\")\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.240622, "o", "> "]
[119.240637, "o", "    print(f\"Overall status : {overall_status}\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[119.240741, "o", "    print(f\"Readiness score: {score}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[119.240792, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> if __name__ == \"__main__\":\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.240829, "o", ">     main()\r\n\u001b[?2004l\r\u001b[?2004h"]
[119.240885, "o", "> EOF\r\n\u001b[?2004l\r"]
[119.241672, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[121.973669, "i", "python /app/validator_fixed.py\n"]
[121.974333, "o", "python /app/validator_fixed.py\r\n\u001b[?2004l\r"]
[122.047027, "o", "Loading deployment manifest ...\r\n"]
[122.048327, "o", "Checking service health ...\r\n"]
[122.050101, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[122.051002, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[122.051597, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[122.052151, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[122.052743, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\n"]
[122.052803, "o", "Computing readiness score ...\r\n  score = 0.9000\r\n"]
[122.053016, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[122.064816, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[126.39861, "i", "cat /app/deployment_report.json\n"]
[126.399303, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[126.39986, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"degraded\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 503,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T19:37:08.780034+00:00\"\r\n}"]
[126.40011, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[128.398234, "i", "mv validator_fixed.py validator.py\n"]
[128.398443, "o", "mv validator_fixed.py validator.py\r\n\u001b[?2004l\r"]
[128.399901, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
[129.887543, "i", "python /app/validator.py\n"]
[129.887872, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[129.953941, "o", "Loading deployment manifest ...\r\n"]
[129.955607, "o", "Checking service health ...\r\n"]
[129.958463, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[129.959474, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[129.960472, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[129.961316, "o", "  worker-service            unhealthy  (HTTP 503)\r\n"]
[129.962113, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n"]
[129.962364, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[129.972503, "o", "\u001b[?2004hroot@517c6a54f599:/app# "]
