Hit:1 http://deb.debian.org/debian trixie InRelease
Hit:2 http://deb.debian.org/debian trixie-updates InRelease
Hit:3 http://deb.debian.org/debian-security trixie-security InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
curl is already the newest version (8.14.1-2+deb13u2).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
downloading uv 0.9.7 aarch64-unknown-linux-gnu
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
everything's installed!

To add $HOME/.local/bin to your PATH, either restart your shell or run:

    source $HOME/.local/bin/env (sh, bash, zsh)
    source $HOME/.local/bin/env.fish (fish)
Downloading pygments (1.2MiB)
 Downloading pygments
Installed 6 packages in 6ms
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.1, pluggy-1.6.0
rootdir: /tests
plugins: json-ctrf-0.3.5
collected 18 items

../tests/test_outputs.py .......F..F.F.....                              [100%]

=================================== FAILURES ===================================
________________________ test_worker_service_unhealthy _________________________

report = {'critical_services_healthy': True, 'deployment_name': 'production-stack', 'overall_status': 'healthy', 'readiness_score': 1.0, ...}

    def test_worker_service_unhealthy(report):
        """worker-service returns HTTP 200 but with status='degraded' in body; must be reported unhealthy."""
        svc = report["service_statuses"]["worker-service"]
>       assert svc["status"] == "unhealthy", (
            "worker-service reports {'status': 'degraded'} in its JSON body. "
            "Despite HTTP 200, a 'degraded' body status means the service is unhealthy."
        )
E       AssertionError: worker-service reports {'status': 'degraded'} in its JSON body. Despite HTTP 200, a 'degraded' body status means the service is unhealthy.
E       assert 'healthy' == 'unhealthy'
E         
E         - unhealthy
E         ? --
E         + healthy

/tests/test_outputs.py:93: AssertionError
_____________________________ test_readiness_score _____________________________

report = {'critical_services_healthy': True, 'deployment_name': 'production-stack', 'overall_status': 'healthy', 'readiness_score': 1.0, ...}

    def test_readiness_score(report):
        """
        Weighted score with high=3, medium=2, low=1:
          healthy:  auth(3) + api-gateway(3) + cache(2) + notification(1) = 9
          total:    9 + worker(1) = 10
          score:    9/10 = 0.9
        """
>       assert abs(report["readiness_score"] - 0.9) < 0.001, (
            f"Expected readiness_score ~0.9, got {report['readiness_score']}. "
            "Check criticality weights: high=3, medium=2, low=1."
        )
E       AssertionError: Expected readiness_score ~0.9, got 1.0. Check criticality weights: high=3, medium=2, low=1.
E       assert 0.09999999999999998 < 0.001
E        +  where 0.09999999999999998 = abs((1.0 - 0.9))

/tests/test_outputs.py:132: AssertionError
_________________________ test_overall_status_degraded _________________________

report = {'critical_services_healthy': True, 'deployment_name': 'production-stack', 'overall_status': 'healthy', 'readiness_score': 1.0, ...}

    def test_overall_status_degraded(report):
        """
        All high-criticality services are healthy but score (0.9) < 0.95,
        so overall_status must be 'degraded'.
        """
>       assert report["overall_status"] == "degraded", (
            f"Expected overall_status='degraded', got '{report['overall_status']}'. "
            "Rules: critical_services_healthy=True + score<0.95 -> 'degraded'."
        )
E       AssertionError: Expected overall_status='degraded', got 'healthy'. Rules: critical_services_healthy=True + score<0.95 -> 'degraded'.
E       assert 'healthy' == 'degraded'
E         
E         - degraded
E         + healthy

/tests/test_outputs.py:159: AssertionError
==================================== PASSES ====================================
=========================== short test summary info ============================
PASSED ../tests/test_outputs.py::test_report_file_exists
PASSED ../tests/test_outputs.py::test_report_top_level_keys
PASSED ../tests/test_outputs.py::test_deployment_name
PASSED ../tests/test_outputs.py::test_all_five_services_present
PASSED ../tests/test_outputs.py::test_auth_service_healthy
PASSED ../tests/test_outputs.py::test_api_gateway_healthy
PASSED ../tests/test_outputs.py::test_cache_service_healthy
PASSED ../tests/test_outputs.py::test_notification_service_healthy
PASSED ../tests/test_outputs.py::test_service_criticality_values
PASSED ../tests/test_outputs.py::test_critical_services_healthy
PASSED ../tests/test_outputs.py::test_startup_order_has_all_services
PASSED ../tests/test_outputs.py::test_startup_order_auth_before_gateway
PASSED ../tests/test_outputs.py::test_startup_order_cache_before_gateway
PASSED ../tests/test_outputs.py::test_startup_order_gateway_before_worker
PASSED ../tests/test_outputs.py::test_startup_order_worker_before_notification
FAILED ../tests/test_outputs.py::test_worker_service_unhealthy - AssertionErr...
FAILED ../tests/test_outputs.py::test_readiness_score - AssertionError: Expec...
FAILED ../tests/test_outputs.py::test_overall_status_degraded - AssertionErro...
========================= 3 failed, 15 passed in 0.02s =========================
