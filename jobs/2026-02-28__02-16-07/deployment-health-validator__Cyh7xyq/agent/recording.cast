{"version": 2, "width": 160, "height": 40, "timestamp": 1772225188, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.002035, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[0.974796, "i", "clear\r"]
[0.974997, "o", "clear\r\n\u001b[?2004l\r"]
[0.97547, "o", "\u001b[H\u001b[J\u001b[3J"]
[0.975609, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[2.447909, "i", "ls -la\n"]
[2.448487, "o", "ls -la\r\n\u001b[?2004l\r"]
[2.449297, "o", "total 32\r\ndrwxr-xr-x 1 root root 4096 Feb 27 20:15 .\r\ndrwxr-xr-x 1 root root 4096 Feb 27 20:46 ..\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10 Dockerfile\r\n-rw-r--r-- 1 root root 2068 Feb 27 19:22 deployment_manifest.yaml\r\n-rw-r--r-- 1 root root 3183 Feb 27 20:15 mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53 requirements.txt\r\n-rw-r--r-- 1 root root 6119 Feb 27 20:15 validator.py\r\n"]
[2.449776, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[3.513325, "i", "cat deployment_manifest.yaml\n"]
[3.513706, "o", "cat deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[3.514879, "o", "# ─────────────────────────────────────────────────────────────────────────────\r\n# deployment_manifest.yaml\r\n#\r\n# Deployment descriptor for the production stack.\r\n#\r\n# Schema notes:\r\n#   • The top-level 'services' block is a legacy v1 monitoring registry read\r\n#     by the external health-dashboard and alert-manager sidecar.  It is NOT\r\n#     the authoritative list for deployment ordering or health validation.\r\n#   • The authoritative service definitions live under 'deployment.services'.\r\n# ─────────────────────────────────────────────────────────────────────────────\r\n\r\n# Legacy monitoring-registry endpoint  (consumed by alert-manager, not by the validator)\r\nservices:\r\n  - name: \"metrics-collector\"\r\n    port: 9091\r\n    health_endpoint: \"/metrics\"\r\n    dependencies: []\r\n    criticality: \"low\"\r\n\r\n# ── Authoritative deployment configuration ────────────────────────────────────\r\ndeployment:\r\n  name: \"production-stack\"\r\n\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n      criticality: \"high\"\r\n\r\n    - name: \"cache-service\"\r\n      port: 8083\r\n      health_endpoint: \"/ping\"\r\n      dependencies: []\r\n      criticality: \"medium\"\r\n\r\n    - name: \"worker-service\"\r\n      port: 8084\r\n      health_endpoint: \"/status\"\r\n      dependencies:\r\n        - \"api-gateway\"\r\n        - \"cache-service\"\r\n      criticality: \"low\"\r\n\r\n    - name: \"notification-service\"\r\n      port: 8085\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"worker-service\"\r\n      criticality: \"low\"\r\n"]
[3.514965, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[4.665618, "i", "curl http://localhost:8081/health\n"]
[4.665801, "o", "curl http://localhost:8081/health\r\n\u001b[?2004l\r"]
[4.670715, "o", "curl: (7) Failed to connect to localhost port 8081 after 0 ms: Could not connect to server\r\n"]
[4.671136, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[6.611069, "i", "python3 mock_services.py &\n"]
[6.611294, "o", "python3 mock_services.py &\r\n\u001b[?2004l\r"]
[6.611397, "o", "[1] 590\r\n\u001b[?2004h"]
[6.611715, "o", "root@eb68a1250306:/app# "]
[6.694123, "o", "  started  auth-service         /health  -> http://0.0.0.0:8081\r\n"]
[6.694405, "o", " * Serving Flask app 'auth-service'\r\n"]
[6.694455, "o", " * Debug mode: off\r\n"]
[6.694623, "o", " * Serving Flask app 'api-gateway'\r\n"]
[6.694683, "o", "  started  api-gateway          /health  -> http://0.0.0.0:8082\r\n"]
[6.694967, "o", " * Debug mode: off\r\n"]
[6.69517, "o", " * Serving Flask app 'cache-service'\r\n"]
[6.695241, "o", "  started  cache-service        /ping    -> http://0.0.0.0:8083\r\n"]
[6.695273, "o", " * Debug mode: off\r\n"]
[6.696007, "o", "  started  worker-service       /status  -> http://0.0.0.0:8084\r\n"]
[6.696333, "o", " * Serving Flask app 'worker-service'\r\n * Debug mode: off\r\n"]
[6.696613, "o", "  started  notification-service /health  -> http://0.0.0.0:8085\r\nAll mock services running. Ctrl-C to stop.\r\n"]
[6.696969, "o", " * Serving Flask app 'notification-service'\r\n"]
[6.69702, "o", " * Debug mode: off\r\n"]
[8.825113, "i", "curl http://localhost:8081/health\n"]
[8.830131, "o", "curl http://localhost:8081/health\r\n\u001b[?2004l\r"]
[8.840297, "o", "{\"status\":\"ok\",\"version\":\"2.1.0\"}\r\n"]
[8.840862, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[10.780387, "i", "curl http://localhost:8083/ping\n"]
[10.780604, "o", "curl http://localhost:8083/ping"]
[10.780851, "o", "\r\n\u001b[?2004l\r"]
[10.788341, "o", "pong"]
[10.788997, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[12.642987, "i", "cat validator.py\n"]
[12.643329, "o", "cat validator.py\r\n\u001b[?2004l\r"]
[12.645402, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\n# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.9"]
[12.645435, "o", "5\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\ndef main():\r\n    manifest_path = \"/app/deployment_manifest.yaml\"\r\n    output_path   = \"/app/deployment_report.json\"\r\n\r\n    print(\"Loading deployment manifest ...\")\r\n    services = load_services(manifest_path)\r\n\r\n    print(\"Checking service health ...\")\r\n    statuses = {}\r\n    for svc in services:\r\n        result = check_health(svc)\r\n        statuses[svc[\"name\"]] = result\r\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\r\n    print(\"Computing startup order ...\")\r\n    startup_order = compute_startup_order(services)\r\n    print(f\"  {' -> '.join(startup_order)}\")\r\n\r\n    print(\"Computing readiness score ...\")\r\n    score = compute_readiness_score(services, statuses)\r\n    print(f\"  score = {score:.4f}\")\r\n\r\n    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\r\n    report = {\r\n        \"deployment_name\":           \"production-stack\",\r\n        \"overall_status\":            overall_status,\r\n        \"readiness_score\":           score,\r\n        \"service_statuses\":          statuses,\r\n        \"startup_order\":             startup_order,\r\n        \"critical_services_healthy\": critical_ok,\r\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n    }\r\n\r\n    with open(output_path, \"w\") as f:\r\n        json.dump(report, f, indent=2)\r\n\r\n    print(f\"\\nReport written to {output_path}\")\r\n    print(f\"Overall status : {overall_status}\")\r\n    print(f\"Readiness score: {score}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n"]
[12.645858, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[14.48501, "i", "python validator.py\n"]
[14.485319, "o", "python validator.py\r\n\u001b[?2004l\r"]
[14.56642, "o", "Loading deployment manifest ...\r\n"]
[14.567759, "o", "Checking service health ...\r\n"]
[14.568595, "o", "  metrics-collector         unhealthy  (HTTP 0)\r\nComputing startup order ...\r\n  metrics-collector\r\nComputing readiness score ...\r\n  score = 0.0000\r\n"]
[14.569609, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.0\r\n"]
[14.579541, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[18.373688, "i", "cp validator.py validator.py.backup\n"]
[18.373926, "o", "cp validator.py validator.py.backup\r\n\u001b[?2004l\r"]
[18.37629, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[19.703373, "i", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' validator.py\n"]
[19.704398, "o", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' validator.py\r\n\u001b[?2004l\r"]
[19.705801, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[20.880489, "i", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' validator.py\n"]
[20.880912, "o", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' validator.py\r\n\u001b[?2004l\r"]
[20.882278, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[22.062285, "i", "sed -i 's/critical_ok = all(/critical_ok = all(/; s/for s in services/for s in services/' validator.py\n"]
[22.062565, "o", "sed -i 's/critical_ok = all(/critical_ok = all(/; s/for s in services/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[22.063729, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[23.127348, "i", "grep -A 5 \"critical_ok = all\" validator.py\n"]
[23.127629, "o", "grep -A 5 \"critical_ok = all\" validator.py\r\n\u001b[?2004l\r"]
[23.128608, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[23.128773, "o", "\u001b[?2004h"]
[23.128894, "o", "root@eb68a1250306:/app# "]
[24.161265, "i", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' validator.py\n"]
[24.161783, "o", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' validator.py\r\n\u001b[?2004l\r"]
[24.163086, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[25.284082, "i", "grep -A 15 \"def check_health\" validator.py\n"]
[25.28434, "o", "grep -A 15 \"def check_health\" validator.py\r\n\u001b[?2004l\r"]
[25.285234, "o", "def check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n"]
[25.285434, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[27.679184, "i", "cat > /tmp/new_check_health.py << 'EOF'\ndef check_health(service: dict) -> dict:\n    \"\"\"Probe a single service and return its health record.\"\"\"\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\n    try:\n        resp = requests.get(url, timeout=5)\n        \n        # For non-200 responses, service is unhealthy\n        if resp.status_code != 200:\n            return {\n                \"status\": \"unhealthy\",\n                \"http_status\": resp.status_code,\n                \"criticality\": service[\"criticality\"],\n            }\n        \n        # Try to parse as JSON\n        try:\n            data = resp.json()\n            # For JSON responses, check if status indicates operational state\n            # Common operational states: 'ok', 'healthy', 'up', 'running'\n            operational_states = ['ok', 'healthy', 'up', 'running']\n            json_status = data.get('status', '').lower()\n            healthy = json_status in operational_states\n        except (ValueError, json.JSONDecodeError):\n            # For non-JSON responses, HTTP 200 is sufficient\n            healthy = True\n        \n        return {\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\n            \"http_status\": resp.status_code,\n            \"criticality\": service[\"criticality\"],\n        }\n    except requests.exceptions.RequestException:\n        return {\n            \"status\": \"unhealthy\",\n            \"http_status\": 0,\n            \"criticality\": service[\"criticality\"],\n        }\nEOF\n"]
[27.679544, "o", "cat > /tmp/new_check_health.py << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> def check_health(service: dict) -> dict:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.679666, "o", "    \"\"\"Probe a single service and return its health record.\"\"\"\r\n\u001b[?2004l\r"]
[27.679949, "o", "\u001b[?2004h>     url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n\u001b[?2004l\r\u001b[?2004h>     try:\r\n\u001b[?2004l\r\u001b[?2004h>         resp = requests.get(url, timeout=5)\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680017, "o", "        # For non-200 responses, service is unhealthy\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680078, "o", "        if resp.status_code != 200:\r\n\u001b[?2004l\r\u001b[?2004h>             return {\r\n\u001b[?2004l\r\u001b[?2004h"]
[27.680099, "o", "> "]
[27.680234, "o", "                \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h>                 \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680296, "o", "                \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680313, "o", "            }\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680388, "o", "        \r\n\u001b[?2004l\r\u001b[?2004h>         # Try to parse as JSON\r\n\u001b[?2004l\r\u001b[?2004h"]
[27.680403, "o", "> "]
[27.680416, "o", "        try:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680491, "o", "            data = resp.json()\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680535, "o", "            # For JSON responses, check if status indicates operational state\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680671, "o", "            # Common operational states: 'ok', 'healthy', 'up', 'running'\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680754, "o", "            operational_states = ['ok', 'healthy', 'up', 'running']\r\n\u001b[?2004l\r\u001b[?2004h>             json_status = data.get('status', '').lower()\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.68083, "o", "            healthy = json_status in operational_states\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.680919, "o", "        except (ValueError, json.JSONDecodeError):\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.681033, "o", "            # For non-JSON responses, HTTP 200 is sufficient\r\n\u001b[?2004l\r\u001b[?2004h>             healthy = True\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r"]
[27.68116, "o", "\u001b[?2004h>         return {\r\n\u001b[?2004l\r\u001b[?2004h>             \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.681284, "o", "            \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h>             \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.68171, "o", "        }\r\n\u001b[?2004l\r\u001b[?2004h> "]
[27.681751, "o", "    except requests.exceptions.RequestException:\r\n\u001b[?2004l\r\u001b[?2004h>         return {\r\n\u001b[?2004l\r\u001b[?2004h>             \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h>             \"http_status\": 0,\r\n\u001b[?2004l\r\u001b[?2004h>             \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[27.682615, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[28.817614, "i", "sed -i '/import json/a import json' validator.py\n"]
[28.81819, "o", "sed -i '/import json/a import json' validator.py\r\n\u001b[?2004l\r"]
[28.819311, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[29.793406, "i", "grep -n \"def check_health\" validator.py\n"]
[29.793642, "o", "grep -n \"def check_health\" validator.py\r\n\u001b[?2004l\r"]
[29.794369, "o", "30:def check_health(service: dict) -> dict:\r\n"]
[29.794721, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[30.908006, "i", "sed -n '30,50p' validator.py | grep -n \"return\\|def \\|^[[:space:]]*$\" | head -10\n"]
[30.908261, "o", "sed -n '30,50p' validator.py | grep -n \"return\\|def \\|^[[:space:]]*$\" | head -10\r\n\u001b[?2004l\r"]
[30.910653, "o", "1:def check_health(service: dict) -> dict:\r\n2:    \"\"\"Probe a single service and return its health record.\"\"\"\r\n7:        return {\r\n13:        return {\r\n18:\r\n19:\r\n21:\r\n"]
[30.910838, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[31.921788, "i", "sed -n '30,60p' validator.py\n"]
[31.921951, "o", "sed -n '30,60p' validator.py\r\n\u001b[?2004l\r"]
[31.922684, "o", "def check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services if s[\"criticality\"] == \"high\"]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services if s[\"criticality\"] == \"high\"}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n"]
[31.922848, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[34.406162, "i", "sed -i '30,48c\\ndef check_health(service: dict) -> dict:\\n    \"\"\"Probe a single service and return its health record.\"\"\"\\n    url = f\"http://127.0.0.1:{service[\\'port\\']}{service[\\'health_endpoint\\']}\"\\n    try:\\n        resp = requests.get(url, timeout=5)\\n        \\n        # For non-200 responses, service is unhealthy\\n        if resp.status_code != 200:\\n            return {\\n                \"status\": \"unhealthy\",\\n                \"http_status\": resp.status_code,\\n                \"criticality\": service[\"criticality\"],\\n            }\\n        \\n        # Try to parse as JSON\\n        try:\\n            data = resp.json()\\n            # For JSON responses, check if status indicates operational state\\n            # Common operational states: \\'ok\\', \\'healthy\\', \\'up\\', \\'running\\'\\n            operational_states = [\\'ok\\', \\'healthy\\', \\'up\\', \\'running\\']\\n            json_status = data.get(\\'status\\', \\'\\').lower()\\n            healthy = json_status in operational_states\\n        except (ValueError, json.JSONDecodeError):\\n            # For non-JSON responses, HTTP 200 is sufficient\\n            healthy = True\\n        \\n        return {\\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\\n            \"http_status\": resp.status_code,\\n            \"criticality\": service[\"criticality\"],\\n        }\\n    except requests.exceptions.RequestException:\\n        return {\\n            \"status\": \"unhealthy\",\\n            \"http_status\": 0,\\n            \"criticality\": service[\"criticality\"],\\n        }' validator.py\n"]
[34.407853, "o", "sed -i '30,48c\\ndef check_health(service: dict) -> dict:\\n    \"\"\"Probe a single service and return its health record.\"\"\"\\n    url = f\"http://127.0.0.1:{service[\\'port\\']}{service[\\'health_endpoint\\']}\"\\n    try:\\n        resp = requests.get(url, timeout=5)\\n        \\n        # For non-200 responses, service is unhealthy\\n        if resp.status_code != 200:\\n            return {\\n                \"status\": \"unhealthy\",\\n                \"http_status\": resp.status_code,\\n                \"criticality\": service[\"criticality\"],\\n            }\\n        \\n        # Try to parse as JSON\\n        try:\\n            data = resp.json()\\n            # For JSON responses, check if status indicates operational state\\n            # Common operational states: \\'ok\\', \\'healthy\\', \\'up\\', \\'running\\'\\n            operational_states = [\\'ok\\', \\'healthy\\', \\'up\\', \\'running\\']\\n            json_status = data.get(\\'status\\', \\'\\').lower()\\n            healthy = json_status in operational_states\\n        except (ValueError, json.JS"]
[34.407952, "o", "ONDecodeError):\\n            # For non-JSON responses, HTTP 200 is sufficient\\n            healthy = True\\n        \\n        return {\\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\\n            \"http_status\": resp.status_code,\\n            \"criticality\": service[\"criticality\"],\\n        }\\n    except requests.exceptions.RequestException:\\n        return {\\n            \"status\": \"unhealthy\",\\n            \"http_status\": 0,\\n            \"criticality\": service[\"criticality\"],\\n        }' validator.py\r\n\u001b[?2004l\r"]
[34.408009, "o", "\u001b[?2004h> "]
[35.498845, "i", "C-c\n"]
[35.499128, "o", "C-c\r\n\u001b[?2004l\r\u001b[?2004h> "]
[37.679096, "i", "\n"]
[37.679935, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[38.886554, "i", "exit\n"]
[38.886756, "o", "exit\r\n\u001b[?2004l\r\u001b[?2004h> "]
[39.857348, "i", "C-c\n"]
[39.857542, "o", "C-c\r\n\u001b[?2004l\r\u001b[?2004h"]
[39.857642, "o", "> "]
[40.806109, "i", "C-d\n"]
[40.80641, "o", "C-d\r\n\u001b[?2004l\r\u001b[?2004h> "]
[41.835117, "i", "pwd\n"]
[41.83526, "o", "pwd\r\n\u001b[?2004l\r\u001b[?2004h> "]
[42.89257, "i", "bash\n"]
[42.89277, "o", "bash\r\n\u001b[?2004l\r\u001b[?2004h> "]
[44.052397, "i", "\n"]
[44.052898, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[45.085412, "i", "C-cC-cC-c\n"]
[45.085667, "o", "C-cC-cC-c\r\n\u001b[?2004l\r\u001b[?2004h> "]
[46.410252, "i", "ls\n"]
[46.41046, "o", "ls\r\n\u001b[?2004l\r\u001b[?2004h> "]
[47.474382, "i", "root@\n"]
[47.474921, "o", "root@\r\n\u001b[?2004l\r\u001b[?2004h> "]
[48.69831, "i", "root@eb68a1250306:/app#\n"]
[48.698562, "o", "root@eb68a1250306:/app#\r\n"]
[48.698583, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[50.015339, "i", "C-z\n"]
[50.015665, "o", "C-z\r\n\u001b[?2004l\r\u001b[?2004h> "]
[51.277393, "i", "EOF\n"]
[51.277525, "o", "EOF\r\n\u001b[?2004l\r"]
[51.277545, "o", "\u001b[?2004h> "]
[52.726258, "i", "echo test\n"]
[52.726433, "o", "echo test\r\n\u001b[?2004l\r\u001b[?2004h> "]
[54.033002, "i", "C-c\necho 'done'\n"]
[54.033358, "o", "C-c\r\n\u001b[?2004l\r\u001b[?2004h> "]
[54.033644, "o", "echo 'done'\r\n\u001b[?2004l\r\u001b[?2004h> "]
[58.692158, "i", "exit 0\n"]
[58.692489, "o", "exit 0\r\n\u001b[?2004l\r\u001b[?2004h> "]
[64.776038, "i", "C-dC-c\n"]
[64.776656, "o", "C-dC-c\r\n\u001b[?2004l\r\u001b[?2004h> "]
[66.35527, "i", "kill -9 $$\n"]
[66.355478, "o", "kill -9 $$\r\n\u001b[?2004l\r\u001b[?2004h"]
[66.355556, "o", "> "]
[67.730132, "i", "stty sane\n"]
[67.730558, "o", "stty sane\r\n\u001b[?2004l\r\u001b[?2004h> "]
[70.117663, "i", "reset\n"]
[70.119409, "o", "reset\r\n\u001b[?2004l\r\u001b[?2004h> "]
[71.187101, "i", "C-j\n"]
[71.187346, "o", "C-j\r\n\u001b[?2004l\r"]
[71.187485, "o", "\u001b[?2004h"]
[71.187609, "o", "> "]
[72.965943, "i", "C-c\n"]
[72.96641, "o", "C-c\r\n\u001b[?2004l\r\u001b[?2004h> "]
[74.854372, "i", "C-m\n"]
[74.85534, "o", "C-m\r\n\u001b[?2004l\r\u001b[?2004h> "]
[76.119878, "i", "C-o\n"]
[76.120124, "o", "C-o\r\n\u001b[?2004l\r\u001b[?2004h> "]
[77.365868, "i", "C-t\n"]
[77.366087, "o", "C-t\r\n\u001b[?2004l\r\u001b[?2004h> "]
[78.688246, "i", "C-u\n"]
[78.688591, "o", "C-u\r\n\u001b[?2004l\r\u001b[?2004h> "]
[79.855371, "i", "C-v\n"]
[79.855593, "o", "C-v\r\n\u001b[?2004l\r"]
[79.855609, "o", "\u001b[?2004h> "]
[81.716939, "i", "C-w\n"]
[81.717065, "o", "C-w\r\n\u001b[?2004l\r"]
[81.71721, "o", "\u001b[?2004h> "]
[83.292727, "i", "C-x\n"]
[83.293019, "o", "C-x\r\n\u001b[?2004l\r"]
[83.293047, "o", "\u001b[?2004h> "]
[84.754599, "i", "C-y\n"]
[84.754772, "o", "C-y\r\n\u001b[?2004l\r\u001b[?2004h> "]
[86.279356, "i", "C-z\n"]
[86.279496, "o", "C-z\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.763404, "i", "cat > /app/validator_fixed.py << 'EOF'\n#!/usr/bin/env python3\n\"\"\"\nDeployment Health Validator\n===========================\nReads deployment_manifest.yaml, probes each service's health endpoint,\ncomputes a weighted readiness score, determines a valid startup ordering,\nand writes a deployment readiness report to /app/deployment_report.json.\n\"\"\"\n\nimport json\nimport yaml\nimport requests\nfrom datetime import datetime, timezone\nfrom collections import deque\n\n\ndef load_services(manifest_path: str) -> list:\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\n    with open(manifest_path) as f:\n        config = yaml.safe_load(f)\n    return config[\"deployment\"][\"services\"]\n\n\ndef check_health(service: dict) -> dict:\n    \"\"\"Probe a single service and return its health record.\"\"\"\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\n    try:\n        resp = requests.get(url, timeout=5)\n        \n        # For non-200 responses, service is unhealthy\n        if resp.status_code != 200:\n            return {\n                \"status\": \"unhealthy\",\n                \"http_status\": resp.status_code,\n                \"criticality\": service[\"criticality\"],\n            }\n        \n        # Try to parse as JSON\n        try:\n            data = resp.json()\n            # For JSON responses, check if status indicates operational state\n            operational_states = ['ok', 'healthy', 'up', 'running']\n            json_status = data.get('status', '').lower()\n            healthy = json_status in operational_states\n        except (ValueError, json.JSONDecodeError):\n            # For non-JSON responses, HTTP 200 is sufficient\n            healthy = True\n        \n        return {\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\n            \"http_status\": resp.status_code,\n            \"criticality\": service[\"criticality\"],\n        }\n    except requests.exceptions.RequestException:\n        return {\n            \"status\": \"unhealthy\",\n            \"http_status\": 0,\n            \"criticality\": service[\"criticality\"],\n        }\n\n\ndef compute_startup_order(services: list) -> list:\n    \"\"\"\n    Return a topologically sorted startup order using Kahn's algorithm.\n    Dependencies must start before the services that depend on them.\n    \"\"\"\n    names = [s[\"name\"] for s in services]\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\n\n    graph     = {n: [] for n in names}\n    in_degree = {n: 0 for n in names}\n\n    for svc, deps in deps_map.items():\n        for dep in deps:\n            graph[dep].append(svc)\n            in_degree[svc] += 1\n\n    queue = deque(n for n in names if in_degree[n] == 0)\n    order = []\n    while queue:\n        node = queue.popleft()\n        order.append(node)\n        for neighbor in graph[node]:\n            in_degree[neighbor] -= 1\n            if in_degree[neighbor] == 0:\n                queue.append(neighbor)\n    return order\n\n\ndef compute_readiness_score(services: list, statuses: dict) -> float:\n    \"\"\"\n    Compute the weighted fraction of healthy services.\n    Criticality weights: high=3, medium=2, low=1.\n    \"\"\"\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\n\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\n    healthy = sum(\n        weight_map[s[\"criticality\"]]\n        for s in services\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\n    )\n    return round(healthy / total, 4) if total else 0.0\n\n\ndef determine_status(services: list, statuses: dict, score: float):\n    \"\"\"\n    Returns (overall_status, critical_services_healthy).\n\n    Status rules:\n      'healthy'   -- critical_services_healthy AND score >= 0.95\n      'degraded'  -- critical_services_healthy AND score < 0.95\n      'critical'  -- any high-criticality service is unhealthy\n      'not_ready' -- score < 0.70\n    \"\"\"\n    critical_ok = all(\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\n        for s in services\n        if s[\"criticality\"] == \"high\"\n    )\n\n    if not critical_ok:\n        return \"critical\", critical_ok\n    if score >= 0.95:\n        return \"healthy\", critical_ok\n    if score"]
[97.763716, "i", " >= 0.70:\n        return \"degraded\", critical_ok\n    return \"not_ready\", critical_ok\n\n\ndef main():\n    manifest_path = \"/app/deployment_manifest.yaml\"\n    output_path   = \"/app/deployment_report.json\"\n\n    print(\"Loading deployment manifest ...\")\n    services = load_services(manifest_path)\n\n    print(\"Checking service health ...\")\n    statuses = {}\n    for svc in services:\n        result = check_health(svc)\n        statuses[svc[\"name\"]] = result\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\n\n    print(\"Computing startup order ...\")\n    startup_order = compute_startup_order(services)\n    print(f\"  {' -> '.join(startup_order)}\")\n\n    print(\"Computing readiness score ...\")\n    score = compute_readiness_score(services, statuses)\n    print(f\"  score = {score:.4f}\")\n\n    overall_status, critical_ok = determine_status(services, statuses, score)\n\n    report = {\n        \"deployment_name\":           \"production-stack\",\n        \"overall_status\":            overall_status,\n        \"readiness_score\":           score,\n        \"service_statuses\":          statuses,\n        \"startup_order\":             startup_order,\n        \"critical_services_healthy\": critical_ok,\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\n    }\n\n    with open(output_path, \"w\") as f:\n        json.dump(report, f, indent=2)\n\n    print(f\"\\nReport written to {output_path}\")\n    print(f\"Overall status : {overall_status}\")\n    print(f\"Readiness score: {score}\")\n\n\nif __name__ == \"__main__\":\n    main()\nEOF\n"]
[97.765369, "o", "cat > /app/validator_fixed.py << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> #!/usr/bin/env python3\r\n\u001b[?2004l\rbash: !/usr/bin/env: event not found\r\n\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_r"]
[97.765884, "o", "sed: -e expression #1, char 1497: unknown command: `C'\r\n"]
[97.766222, "o", "\u001b[?2004hroot@eb68a1250306:/app# Deployment Health Validator\r\n\u001b[?2004l\ready\", critical_ok\r\n\r\n\r\ndef mai"]
[97.76664, "o", "bash: Deployment: command not found\r\n"]
[97.76682, "o", "\u001b[?2004hroot@eb68a1250306:/app# ===========================\r\n\u001b[?2004l\r"]
[97.767182, "o", "bash: ===========================: command not found\r\n"]
[97.767463, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.767547, "o", "Reads deployment_manifest.yaml, probes each service's health endpoint,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.767786, "o", "computes a weighted readiness score, determines a valid startup ordering,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.767868, "o", "and writes a deployment readiness report to /app/deployment_report.json.\r\n\u001b[?2004l\ra\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> import json\r\n\u001b[?2004l\r\u001b[?2004h> import yaml\r\n\u001b[?2004l\r"]
[97.768088, "o", "\u001b[?2004h> import requests\r\n\u001b[?2004l\r\u001b[?2004h> from datetime import datetime, timezone\r\n\u001b[?2004l\r\u001b[?2004h> from collections import deque\r\n\u001b[?2004l\r  \u001b[?2004h> \r\n\u001b[?2004l\r "]
[97.768187, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r \u001b[?2004h> "]
[97.76824, "o", "def load_services(manifest_path: str) -> list:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.76834, "o", "    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n\u001b[?2004l\rp \u001b[?2004h> "]
[97.768397, "o", "    with open(manifest_path) as f:\r\n\u001b[?2004l\rm"]
[97.76841, "o", "\u001b[?2004h> "]
[97.768482, "o", "        config = yaml.safe_load(f)\r\n\u001b[?2004l\r"]
[97.76855, "o", "\u001b[?2004h>     return config[\"deployment\"][\"services\"]\r\n\u001b[?2004l\r"]
[97.768574, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.76862, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.768715, "o", "def check_health(service: dict) -> dict:\r\n\u001b[?2004l\rcore ...\")\r\n    \u001b[?2004h> "]
[97.76959, "o", "    \"\"\"Probe a single service and return its health record.\"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n\u001b[?2004l\r\u001b[?2004h>     try:\r\n\u001b[?2004l\r\u001b[?2004h>         resp = requests.get(url, timeout=5)\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r\u001b[?2004h>         # For non-200 responses, service is unhealthy\r\n\u001b[?2004l\r\u001b[?2004h>         if resp.status_code != 200:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.769675, "o", "            return {\r\n\u001b[?2004l\r"]
[97.769731, "o", "\u001b[?2004h>                 \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h"]
[97.769771, "o", "> "]
[97.769807, "o", "                \"http_status\": resp.status_code,\r\n\u001b[?2004l\r"]
[97.769883, "o", "\u001b[?2004h> "]
[97.769939, "o", "                \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\rcal_s\u001b[?2004h> "]
[97.769958, "o", "            }\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.770046, "o", "        \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.770071, "o", "        # Try to parse as JSON\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.770198, "o", "        try:\r\n\u001b[?2004l\r"]
[97.770242, "o", "\u001b[?2004h>             data = resp.json()\r\n\u001b[?2004l\r datetime.now(timezone.utc).iso\u001b[?2004h> "]
[97.770406, "o", "            # For JSON responses, check if status indicates operational state\r\n\u001b[?2004l\r    json.dump(repor\u001b[?2004h> "]
[97.770469, "o", "            operational_states = ['ok', 'healthy', 'up', 'running']\r\n\u001b[?2004l\r\r\n   \u001b[?2004h"]
[97.77048, "o", "> "]
[97.770613, "o", "            json_status = data.get('status', '').lower()\r\n\u001b[?2004l\rf\"\u001b[?2004h> "]
[97.770722, "o", "            healthy = json_status in operational_states\r\n\u001b[?2004l\r_\":\r\n\u001b[?2004h> "]
[97.770852, "o", "        except (ValueError, json.JSONDecodeError):\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.770965, "o", "            # For non-JSON responses, HTTP 200 is sufficient\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.771125, "o", "            healthy = True\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.771165, "o", "        return {\r\n\u001b[?2004l\r\u001b[?2004h"]
[97.771266, "o", ">             \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n\u001b[?2004l\r"]
[97.771348, "o", "\u001b[?2004h> "]
[97.771431, "o", "            \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.77153, "o", "            \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.771579, "o", "        }\r\n\u001b[?2004l\r"]
[97.771666, "o", "\u001b[?2004h> "]
[97.771687, "o", "    except requests.exceptions.RequestException:\r\n\u001b[?2004l\r\u001b[?2004h>         return {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.77173, "o", "            \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.771791, "o", "            \"http_status\": 0,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.771831, "o", "            \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n"]
[97.771846, "o", "\u001b[?2004l\r"]
[97.771914, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.771983, "o", "def compute_startup_order(services: list) -> list:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.772076, "o", "    Return a topologically sorted startup order using Kahn's algorithm.\r\n\u001b[?2004l\r"]
[97.772436, "o", "bash: Reads: command not found\r\n"]
[97.772613, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.77272, "o", "    Dependencies must start before the services that depend on them.\r\n\u001b[?2004l\r"]
[97.772924, "o", "bash: Dependencies: command not found\r\n"]
[97.773076, "o", "\u001b[?2004hroot@eb68a1250306:/app#     \"\"\"\r\n\u001b[?2004l\r"]
[97.773096, "o", "\u001b[?2004h> "]
[97.77316, "o", "    names = [s[\"name\"] for s in services]\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773245, "o", "    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773332, "o", "    graph     = {n: [] for n in names}\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773356, "o", "    in_degree = {n: 0 for n in names}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773463, "o", "    for svc, deps in deps_map.items():\r\n\u001b[?2004l\r\u001b[?2004h>         for dep in deps:\r\n\u001b[?2004l\r\u001b[?2004h>             graph[dep].append(svc)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773528, "o", "            in_degree[svc] += 1\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773625, "o", "    queue = deque(n for n in names if in_degree[n] == 0)\r\n\u001b[?2004l\r\u001b[?2004h>     order = []\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773644, "o", "    while queue:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773708, "o", "        node = queue.popleft()\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773767, "o", "        order.append(node)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773789, "o", "        for neighbor in graph[node]:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773872, "o", "            in_degree[neighbor] -= 1\r\n\u001b[?2004l\r\u001b[?2004h>             if in_degree[neighbor] == 0:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.773979, "o", "                queue.append(neighbor)\r\n\u001b[?2004l\r\u001b[?2004h>     return order\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.774018, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.774115, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r"]
[97.774458, "o", "bash: $'\\n    names = [s[name] for s in services]\\n    deps_map = {s[name]: s.get(dependencies, []) for s in services}\\n\\n    graph     = {n: [] for n in names}\\n    in_degree = {n: 0 for n in names}\\n\\n    for svc, deps in deps_map.items():\\n        for dep in deps:\\n            graph[dep].append(svc)\\n            in_degree[svc] += 1\\n\\n    queue = deque(n for n in names if in_degree[n] == 0)\\n    order = []\\n    while queue:\\n        node = queue.popleft()\\n        order.append(node)\\n        for neighbor in graph[node]:\\n            in_degree[neighbor] -= 1\\n            if in_degree[neighbor] == 0:\\n                queue.append(neighbor)\\n    return order\\n\\n\\ndef compute_readiness_score(services: list, statuses: dict) -> float:\\n    ': command not found\r\n"]
[97.774626, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.774685, "o", "    Compute the weighted fraction of healthy services.\r\n\u001b[?2004l\r"]
[97.77492, "o", "bash: Compute: command not found\r\n"]
[97.775072, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.775121, "o", "    Criticality weights: high=3, medium=2, low=1.\r\n\u001b[?2004l\r"]
[97.775422, "o", "bash: Criticality: command not found\r\n"]
[97.775649, "o", "\u001b[?2004hroot@eb68a1250306:/app#     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.775757, "o", "    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.775827, "o", "    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n\u001b[?2004l\r\u001b[?2004h>     healthy = sum(\r\n\u001b[?2004l\r\u001b[?2004h>         weight_map[s[\"criticality\"]]\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.775849, "o", "        for s in services\r\n\u001b[?2004l\r"]
[97.77586, "o", "\u001b[?2004h> "]
[97.775937, "o", "        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.776027, "o", "    return round(healthy / total, 4) if total else 0.0\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.776098, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r"]
[97.776324, "o", "bash: \r\n    weight_map = {high: 3, medium: 2, low: 1}\r\n\r\n    total   = sum(weight_map[s[criticality]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[criticality]]\r\n        for s in services\r\n        if statuses[s[name]][status] == healthy\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    : File name too long\r\n"]
[97.776417, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.77648, "o", "    Returns (overall_status, critical_services_healthy).\r\n\u001b[?2004l\rbash: syntax error near unexpected token `overall_status,'\r\n"]
[97.77652, "o", "\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r\u001b[?2004hroot@eb68a1250306:/app# "]
[97.776529, "o", "    Status rules:\r\n\u001b[?2004l\r"]
[97.776728, "o", "bash: Status: command not found\r\n"]
[97.776853, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.776956, "o", "      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n\u001b[?2004l\r"]
[97.777318, "o", "bash: healthy: command not found\r\n"]
[97.777438, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.777528, "o", "      'degraded'  -- critical_services_healthy AND score < 0.95\r\n\u001b[?2004l\r"]
[97.777768, "o", "bash: 0.95: No such file or directory\r\n"]
[97.777866, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.777913, "o", "      'critical'  -- any high-criticality service is unhealthy\r\n\u001b[?2004l\r"]
[97.778118, "o", "bash: critical: command not found\r\n"]
[97.778236, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.778301, "o", "      'not_ready' -- score < 0.70\r\n\u001b[?2004l\r"]
[97.778585, "o", "bash: 0.70: No such file or directory\r\n"]
[97.778686, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.778704, "o", "    \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.778748, "o", "    critical_ok = all(\r\n"]
[97.77877, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[97.778817, "o", "        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>         for s in services\r\n"]
[97.778841, "o", "\u001b[?2004l\r\u001b[?2004h"]
[97.778855, "o", "> "]
[97.778916, "o", "        if s[\"criticality\"] == \"high\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[97.778948, "o", "\u001b[?2004h> "]
[97.778994, "o", "    if not critical_ok:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779011, "o", "        return \"critical\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779039, "o", "    if score >= 0.95:\r\n\u001b[?2004l\r\u001b[?2004h"]
[97.779079, "o", ">         return \"healthy\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h"]
[97.779124, "o", ">     if score >= 0.70:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.77918, "o", "        return \"degraded\", critical_ok\r\n\u001b[?2004l\r"]
[97.779227, "o", "\u001b[?2004h> "]
[97.779247, "o", "    return \"not_ready\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[97.779309, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> def main():\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779362, "o", "    manifest_path = \"/app/deployment_manifest.yaml\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779424, "o", "    output_path   = \"/app/deployment_report.json\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[97.779474, "o", "> "]
[97.779532, "o", "    print(\"Loading deployment manifest ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779613, "o", "    services = load_services(manifest_path)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779674, "o", "    print(\"Checking service health ...\")\r\n\u001b[?2004l\r\u001b[?2004h>     statuses = {}\r\n\u001b[?2004l\r\u001b[?2004h"]
[97.779696, "o", "> "]
[97.779739, "o", "    for svc in services:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779792, "o", "        result = check_health(svc)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.77985, "o", "        statuses[svc[\"name\"]] = result\r\n\u001b[?2004l\r\u001b[?2004h> "]
[97.779907, "o", "        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `('\r\n\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r"]
[97.779928, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.779999, "o", "    print(\"Computing startup order ...\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `\"Computing startup order ...\"'\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[97.780062, "o", "    startup_order = compute_startup_order(services)\r\n\u001b[?2004l\rbash: syntax error near unexpected token `('\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[97.780123, "o", "    print(f\"  {' -> '.join(startup_order)}\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `f\"  {' -> '.join(startup_order)}\"'\r\n\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r\u001b[?2004hroot@eb68a1250306:/app# "]
[97.780207, "o", "    print(\"Computing readiness score ...\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `\"Computing readiness score ...\"'\r\n\u001b[?2004h"]
[97.780271, "o", "root@eb68a1250306:/app# "]
[97.78029, "o", "    score = compute_readiness_score(services, statuses)\r\n\u001b[?2004l\rbash: syntax error near unexpected token `('\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[97.78034, "o", "    print(f\"  score = {score:.4f}\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `f\"  score = {score:.4f}\"'\r\n\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r\u001b[?2004hroot@eb68a1250306:/app# "]
[97.780426, "o", "    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\u001b[?2004l\rbash: syntax error near unexpected token `('\r\n\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r\u001b[?2004hroot@eb68a1250306:/app# "]
[97.78048, "o", "    report = {\r\n\u001b[?2004l\r"]
[97.780735, "o", "bash: report: command not found\r\n"]
[97.780867, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.780937, "o", "        \"deployment_name\":           \"production-stack\",\r\n\u001b[?2004l\r"]
[97.781112, "o", "bash: deployment_name:: command not found\r\n"]
[97.781251, "o", "\u001b[?2004hroot@eb68a1250306:/app#         \"overall_status\":            overall_status,\r\n\u001b[?2004l\r"]
[97.781485, "o", "bash: overall_status:: command not found\r\n"]
[97.781565, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.781739, "o", "        \"readiness_score\":           score,\r\n\u001b[?2004l\r"]
[97.781814, "o", "bash: readiness_score:: command not found\r\n"]
[97.781876, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.781971, "o", "        \"service_statuses\":          statuses,\r\n\u001b[?2004l\r"]
[97.782194, "o", "bash: service_statuses:: command not found\r\n"]
[97.782314, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.7824, "o", "        \"startup_order\":             startup_order,\r\n\u001b[?2004l\r"]
[97.782544, "o", "bash: startup_order:: command not found\r\n"]
[97.782658, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.782708, "o", "        \"critical_services_healthy\": critical_ok,\r\n\u001b[?2004l\r"]
[97.78291, "o", "bash: critical_services_healthy:: command not found\r\n"]
[97.783024, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.783121, "o", "        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n\u001b[?2004l\rbash: syntax error near unexpected token `('\r\n\u001b[?2004hroot@eb68a1250306:/app#     }\r\n\u001b[?2004l\rbash: syntax error near unexpected token `}'\r\n"]
[97.783131, "o", "\u001b[?2004hroot@eb68a1250306:/app# \r\n"]
[97.783154, "o", "\u001b[?2004l\r"]
[97.783165, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.783222, "o", "    with open(output_path, \"w\") as f:\r\n\u001b[?2004l\rbash: syntax error near unexpected token `('\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[97.783265, "o", "        json.dump(report, f, indent=2)\r\n\u001b[?2004l\rbash: syntax error near unexpected token `report,'\r\n"]
[97.783316, "o", "\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r"]
[97.783331, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[97.783388, "o", "    print(f\"\\nReport written to {output_path}\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `f\"\\nReport written to {output_path}\"'\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[97.78343, "o", "    print(f\"Overall status : {overall_status}\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `f\"Overall status : {overall_status}\"'\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[97.783473, "o", "    print(f\"Readiness score: {score}\")\r\n\u001b[?2004l\rbash: syntax error near unexpected token `f\"Readiness score: {score}\"'\r\n\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r"]
[97.783594, "o", "\u001b[?2004hroot@eb68a1250306:/app# \r\n\u001b[?2004l\r\u001b[?2004hroot@eb68a1250306:/app# if __name__ == \"__main__\":\r\n\u001b[?2004l\r\u001b[?2004h>     main()\r\n\u001b[?2004l\r\u001b[?2004h"]
[97.78361, "o", "> EOF\r\n\u001b[?2004l\rbash: syntax error near unexpected token `EOF'\r\n"]
[97.783656, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[100.487684, "i", "ls -la\n"]
[100.487972, "o", "ls -la\r\n\u001b[?2004l\r"]
[100.489308, "o", "total 44\r\ndrwxr-xr-x 1 root root 4096 Feb 27 20:48  .\r\ndrwxr-xr-x 1 root root 4096 Feb 27 20:46  ..\r\n-rw-r--r-- 1 root root    0 Feb 27 20:48 '='\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10  Dockerfile\r\n-rw-r--r-- 1 root root 2068 Feb 27 19:22  deployment_manifest.yaml\r\n-rw-r--r-- 1 root root  382 Feb 27 20:46  deployment_report.json\r\n-rw-r--r-- 1 root root 3183 Feb 27 20:15  mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53  requirements.txt\r\n-rw-r--r-- 1 root root 6295 Feb 27 20:46  validator.py\r\n-rw-r--r-- 1 root root 6119 Feb 27 20:46  validator.py.backup\r\n"]
[100.489543, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[102.019686, "i", "head -50 validator.py\n"]
[102.020014, "o", "head -50 validator.py\r\n\u001b[?2004l\r"]
[102.020812, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"deployment\"][\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\n"]
[102.021229, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[103.995592, "i", "sed -i '/^import json$/d' validator.py\n"]
[103.995942, "o", "sed -i '/^import json$/d' validator.py\r\n\u001b[?2004l\r"]
[103.997215, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[105.391144, "i", "grep -n \"def check_health\" validator.py\n"]
[105.39155, "o", "grep -n \"def check_health\" validator.py\r\n\u001b[?2004l\r"]
[105.392298, "o", "28:def check_health(service: dict) -> dict:"]
[105.392355, "o", "\r\n"]
[105.392611, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[107.257538, "i", "sed -n '28,50p' validator.py\n"]
[107.257787, "o", "sed -n '28,50p' validator.py\r\n\u001b[?2004l\r"]
[107.258755, "o", "def check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n"]
[107.259057, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[111.097123, "i", "cat > /tmp/new_check_health.py << 'EOF'\ndef check_health(service: dict) -> dict:\n    \"\"\"Probe a single service and return its health record.\"\"\"\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\n    try:\n        resp = requests.get(url, timeout=5)\n        \n        # For non-200 responses, service is unhealthy\n        if resp.status_code != 200:\n            return {\n                \"status\": \"unhealthy\",\n                \"http_status\": resp.status_code,\n                \"criticality\": service[\"criticality\"],\n            }\n        \n        # Try to parse as JSON\n        try:\n            data = resp.json()\n            # For JSON responses, check if status indicates operational state\n            operational_states = ['ok', 'healthy', 'up', 'running']\n            json_status = data.get('status', '').lower()\n            healthy = json_status in operational_states\n        except (ValueError, json.JSONDecodeError):\n            # For non-JSON responses, HTTP 200 is sufficient\n            healthy = True\n        \n        return {\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\n            \"http_status\": resp.status_code,\n            \"criticality\": service[\"criticality\"],\n        }\n    except requests.exceptions.RequestException:\n        return {\n            \"status\": \"unhealthy\",\n            \"http_status\": 0,\n            \"criticality\": service[\"criticality\"],\n        }\nEOF\n"]
[111.097601, "o", "cat > /tmp/new_check_health.py << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.097645, "o", "def check_health(service: dict) -> dict:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.097724, "o", "    \"\"\"Probe a single service and return its health record.\"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.098115, "o", "    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n\u001b[?2004l\r\u001b[?2004h>     try:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.098183, "o", "        resp = requests.get(url, timeout=5)\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r"]
[111.098222, "o", "\u001b[?2004h> "]
[111.098473, "o", "        # For non-200 responses, service is unhealthy\r\n\u001b[?2004l\r\u001b[?2004h>         if resp.status_code != 200:\r\n\u001b[?2004l\r\u001b[?2004h>             return {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.09859, "o", "                \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h"]
[111.098604, "o", "> "]
[111.098822, "o", "                \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.098857, "o", "                \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>             }\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.098978, "o", "        \r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.099035, "o", "        # Try to parse as JSON\r\n\u001b[?2004l\r\u001b[?2004h"]
[111.09905, "o", "> "]
[111.099089, "o", "        try:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.099175, "o", "            data = resp.json()\r\n\u001b[?2004l\r"]
[111.09921, "o", "\u001b[?2004h> "]
[111.099352, "o", "            # For JSON responses, check if status indicates operational state\r\n\u001b[?2004l\r"]
[111.099388, "o", "\u001b[?2004h"]
[111.099563, "o", "> "]
[111.09975, "o", "            operational_states = ['ok', 'healthy', 'up', 'running']\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.099851, "o", "            json_status = data.get('status', '').lower()\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.099938, "o", "            healthy = json_status in operational_states\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100085, "o", "        except (ValueError, json.JSONDecodeError):\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100132, "o", "            # For non-JSON responses, HTTP 200 is sufficient\r\n\u001b[?2004l\r"]
[111.100189, "o", "\u001b[?2004h>             healthy = True\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100203, "o", "        \r\n\u001b[?2004l\r"]
[111.100293, "o", "\u001b[?2004h> "]
[111.100306, "o", "        return {\r\n\u001b[?2004l\r"]
[111.10037, "o", "\u001b[?2004h> "]
[111.100417, "o", "            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h"]
[111.100468, "o", "> "]
[111.100604, "o", "            \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h>             \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100662, "o", "        }\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100744, "o", "    except requests.exceptions.RequestException:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100783, "o", "        return {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.100902, "o", "            \"status\": \"unhealthy\",\r\n\u001b[?2004l\r\u001b[?2004h>             \"http_status\": 0,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[111.101167, "o", "            \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[111.101987, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[112.744149, "i", "sed -i '28,46d' validator.py\n"]
[112.745021, "o", "sed -i '28,46d' validator.py\r\n\u001b[?2004l\r"]
[112.746206, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[114.093637, "i", "sed -i '27r /tmp/new_check_health.py' validator.py\n"]
[114.093995, "o", "sed -i '27r /tmp/new_check_health.py' validator.py\r\n\u001b[?2004l\r"]
[114.09528, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[115.643432, "i", "grep -A 10 \"def compute_readiness_score\" validator.py\n"]
[115.643656, "o", "grep -A 10 \"def compute_readiness_score\" validator.py\r\n\u001b[?2004l\r"]
[115.644386, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n"]
[115.644584, "o", "    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n"]
[115.64473, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[117.342276, "i", "grep -A 15 \"def determine_status\" validator.py\n"]
[117.343366, "o", "grep -A 15 \"def determine_status\" validator.py\r\n\u001b[?2004l\r"]
[117.344588, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:"]
[117.344612, "o", "\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[117.34477, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[119.323931, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\n"]
[119.324183, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[119.326975, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[120.732144, "i", "python validator.py\n"]
[120.73235, "o", "python validator.py\r\n\u001b[?2004l\r"]
[120.808352, "o", "Loading deployment manifest ...\r\n"]
[120.810212, "o", "Checking service health ...\r\n"]
[120.814942, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[120.81638, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[120.817777, "o", "Traceback (most recent call last):\r\n  File \"/usr/local/lib/python3.12/site-packages/requests/models.py\", line 974, in json\r\n"]
[120.818336, "o", "    return complexjson.loads(self.text, **kwargs)\r\n"]
[120.818363, "o", "           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/__init__.py\", line 346, in loads\r\n"]
[120.81851, "o", "    return _default_decoder.decode(s)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/decoder.py\", line 338, in decode\r\n"]
[120.818905, "o", "    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/decoder.py\", line 356, in raw_decode\r\n"]
[120.819058, "o", "    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\njson.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 44, in check_health\r\n"]
[120.819152, "o", "    data = resp.json()\r\n           ^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/site-packages/requests/models.py\", line 978, in json\r\n"]
[120.819331, "o", "    raise RequestsJSONDecodeError(e.msg, e.doc, e.pos)\r\nrequests.exceptions.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 183, in <module>\r\n    main()\r\n  File \"/app/validator.py\", line 150, in main\r\n    result = check_health(svc)\r\n             ^^^^^^^^^^^^^^^^^\r\n  File \"/app/validator.py\", line 49, in check_health\r\n    except (ValueError, json.JSONDecodeError):\r\n                        ^^^^\r\n"]
[120.81942, "o", "NameError: name 'json' is not defined. Did you forget to import 'json'?\r\n"]
[120.831796, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[126.069747, "i", "sed -i 's/except (ValueError, json.JSONDecodeError):/except (ValueError, json.decoder.JSONDecodeError):/' validator.py\n"]
[126.07145, "o", "sed -i 's/except (ValueError, json.JSONDecodeError):/except (ValueError, json.decoder.JSONDecodeError):/' validator.py\r\n\u001b[?2004l\r"]
[126.073437, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[127.359214, "i", "python validator.py\n"]
[127.359474, "o", "python validator.py\r\n\u001b[?2004l\r"]
[127.448526, "o", "Loading deployment manifest ...\r\n"]
[127.449794, "o", "Checking service health ...\r\n"]
[127.452947, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[127.453833, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[127.454515, "o", "Traceback (most recent call last):\r\n  File \"/usr/local/lib/python3.12/site-packages/requests/models.py\", line 974, in json\r\n"]
[127.454683, "o", "    return complexjson.loads(self.text, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/__init__.py\", line 346, in loads\r\n"]
[127.454777, "o", "    return _default_decoder.decode(s)\r\n"]
[127.454891, "o", "           ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/decoder.py\", line 338, in decode\r\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/decoder.py\", line 356, in raw_decode\r\n"]
[127.455014, "o", "    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\njson.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 44, in check_health\r\n    data = resp.json()\r\n           ^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/site-packages/requests/models.py\", line 978, in json\r\n"]
[127.455177, "o", "    raise RequestsJSONDecodeError(e.msg, e.doc, e.pos)\r\nrequests.exceptions.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 183, in <module>\r\n"]
[127.455259, "o", "    main()\r\n  File \"/app/validator.py\", line 150, in main\r\n"]
[127.455333, "o", "    result = check_health(svc)\r\n             ^^^^^^^^^^^^^^^^^\r\n  File \"/app/validator.py\", line 49, in check_health\r\n"]
[127.455384, "o", "    except (ValueError, json.decoder.JSONDecodeError):\r\n                        ^^^^\r\nNameError: name 'json' is not defined. Did you forget to import 'json'?\r\n"]
[127.463854, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[132.010213, "i", "grep -A 10 \"except.*JSONDecodeError\" validator.py\n"]
[132.0116, "o", "grep -A 10 \"except.*JSONDecodeError\" validator.py\r\n\u001b[?2004l\r"]
[132.013269, "o", "        except (ValueError, json.decoder.JSONDecodeError):\r\n            # For non-JSON responses, HTTP 200 is sufficient\r\n            healthy = True\r\n        \r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n"]
[132.013681, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[134.027492, "i", "sed -i 's/except (ValueError, json.decoder.JSONDecodeError):/except (ValueError, json.decoder.JSONDecodeError, requests.exceptions.JSONDecodeError):/' validator.py\n"]
[134.027878, "o", "sed -i 's/except (ValueError, json.decoder.JSONDecodeError):/except (ValueError, json.decoder.JSONDecodeError, requests.exceptions.JSONDecodeError):/' validator.py\r\n\u001b[?2004l\r"]
[134.029699, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[135.592481, "i", "python validator.py\n"]
[135.59279, "o", "python validator.py\r\n\u001b[?2004l\r"]
[135.665891, "o", "Loading deployment manifest ...\r\n"]
[135.667129, "o", "Checking service health ...\r\n"]
[135.67108, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[135.671924, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[135.672769, "o", "Traceback (most recent call last):\r\n  File \"/usr/local/lib/python3.12/site-packages/requests/models.py\", line 974, in json\r\n"]
[135.672981, "o", "    return complexjson.loads(self.text, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/__init__.py\", line 346, in loads\r\n"]
[135.673056, "o", "    return _default_decoder.decode(s)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/decoder.py\", line 338, in decode\r\n"]
[135.673164, "o", "    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/json/decoder.py\", line 356, in raw_decode\r\n"]
[135.673188, "o", "    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\njson.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 44, in check_health\r\n"]
[135.673244, "o", "    data = resp.json()\r\n           ^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.12/site-packages/requests/models.py\", line 978, in json\r\n"]
[135.673404, "o", "    raise RequestsJSONDecodeError(e.msg, e.doc, e.pos)\r\nrequests.exceptions.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 183, in <module>\r\n"]
[135.673536, "o", "    main()\r\n  File \"/app/validator.py\", line 150, in main\r\n    result = check_health(svc)\r\n"]
[135.673559, "o", "             ^^^^^^^^^^^^^^^^^\r\n  File \"/app/validator.py\", line 49, in check_health\r\n"]
[135.673665, "o", "    except (ValueError, json.decoder.JSONDecodeError, requests.exceptions.JSONDecodeError):\r\n                        ^^^^\r\nNameError: name 'json' is not defined. Did you forget to import 'json'?\r\n"]
[135.681915, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[140.208607, "i", "sed -n '40,55p' validator.py\n"]
[140.209623, "o", "sed -n '40,55p' validator.py\r\n\u001b[?2004l\r"]
[140.210795, "o", "            }\r\n        \r\n        # Try to parse as JSON\r\n        try:\r\n            data = resp.json()\r\n            # For JSON responses, check if status indicates operational state\r\n            operational_states = ['ok', 'healthy', 'up', 'running']\r\n            json_status = data.get('status', '').lower()\r\n            healthy = json_status in operational_states\r\n        except (ValueError, json.decoder.JSONDecodeError, requests.exceptions.JSONDecodeError):\r\n            # For non-JSON responses, HTTP 200 is sufficient\r\n            healthy = True\r\n        \r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n"]
[140.211195, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[142.027275, "i", "sed -i 's/except (ValueError, json.decoder.JSONDecodeError, requests.exceptions.JSONDecodeError):/except (ValueError, requests.exceptions.JSONDecodeError):/' validator.py\n"]
[142.027643, "o", "sed -i 's/except (ValueError, json.decoder.JSONDecodeError, requests.exceptions.JSONDecodeError):/except (ValueError, requests.exceptions.JSONDecodeError):/' validator.py\r\n\u001b[?2004l\r"]
[142.028667, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[143.467555, "i", "python validator.py\n"]
[143.467856, "o", "python validator.py\r\n\u001b[?2004l\r"]
[143.532742, "o", "Loading deployment manifest ...\r\n"]
[143.534104, "o", "Checking service health ...\r\n"]
[143.535613, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[143.536337, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[143.537062, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[143.537864, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[143.53849, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n"]
[143.538513, "o", "Traceback (most recent call last):\r\n  File \"/app/validator.py\", line 183, in <module>\r\n"]
[143.538581, "o", "    main()\r\n  File \"/app/validator.py\", line 155, in main\r\n"]
[143.538633, "o", "    startup_order = compute_startup_order(services)\r\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/app/validator.py\", line 80, in compute_startup_order\r\n"]
[143.538715, "o", "    in_degree[dep] += 1\r\n    ~~~~~~~~~^^^^^\r\nKeyError: 'cache-service'\r\n"]
[143.549273, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[148.259068, "i", "grep -A 25 \"def compute_startup_order\" validator.py\n"]
[148.259319, "o", "grep -A 25 \"def compute_startup_order\" validator.py\r\n\u001b[?2004l\r"]
[148.260073, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services if s[\"criticality\"] == \"high\"]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services if s[\"criticality\"] == \"high\"}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n"]
[148.260305, "o", "\u001b[?2004h"]
[148.260491, "o", "root@eb68a1250306:/app# "]
[150.349719, "i", "sed -i 's/\\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/[s[\"name\"] for s in services]/' validator.py\n"]
[150.35019, "o", "sed -i 's/\\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/[s[\"name\"] for s in services]/' validator.py\r\n\u001b[?2004l\r"]
[150.351727, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[152.026489, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\n"]
[152.027008, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' validator.py\r\n\u001b[?2004l\r"]
[152.028384, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[153.839426, "i", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' validator.py\n"]
[153.839791, "o", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' validator.py\r\n\u001b[?2004l\r"]
[153.840809, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[155.422768, "i", "python validator.py\n"]
[155.423039, "o", "python validator.py\r\n\u001b[?2004l\r"]
[155.501542, "o", "Loading deployment manifest ...\r\n"]
[155.502794, "o", "Checking service health ...\r\n"]
[155.506133, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[155.507112, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[155.507925, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[155.508612, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[155.509299, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  api-gateway -> worker-service -> notification-service -> auth-service -> cache-service\r\n"]
[155.509321, "o", "Computing readiness score ...\r\n  score = 1.5000\r\n"]
[155.509455, "o", "Traceback (most recent call last):\r\n  File \"/app/validator.py\", line 183, in <module>\r\n"]
[155.509527, "o", "    main()\r\n  File \"/app/validator.py\", line 175, in main\r\n"]
[155.509609, "o", "    json.dump(report, f, indent=2)\r\n    ^^^^\r\nNameError: name 'json' is not defined. Did you forget to import 'json'?\r\n"]
[155.518783, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[160.126737, "i", "sed -i '1i import json' validator.py\n"]
[160.12728, "o", "sed -i '1i import json' validator.py\r\n\u001b[?2004l\r"]
[160.128369, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[161.689561, "i", "python validator.py\n"]
[161.689694, "o", "python validator.py\r\n\u001b[?2004l\r"]
[161.74797, "o", "Loading deployment manifest ...\r\n"]
[161.74922, "o", "Checking service health ...\r\n"]
[161.750504, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[161.751215, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[161.751812, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[161.752329, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[161.753115, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  api-gateway -> worker-service -> notification-service -> auth-service -> cache-service\r\nComputing readiness score ...\r\n  score = 1.5000\r\n"]
[161.753243, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 1.5\r\n"]
[161.762054, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[166.332866, "i", "cat deployment_report.json\n"]
[166.333113, "o", "cat deployment_report.json\r\n\u001b[?2004l\r"]
[166.333816, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"critical\",\r\n  \"readiness_score\": 1.5,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\",\r\n    \"auth-service\",\r\n    \"cache-service\"\r\n  ],\r\n  \"critical_services_healthy\": false,\r\n  \"timestamp\": \"2026-02-27T20:49:10.131817+00:00\"\r\n}"]
[166.334033, "o", "\u001b[?2004h"]
[166.334099, "o", "root@eb68a1250306:/app# "]
[169.985162, "i", "grep -A 10 \"def compute_readiness_score\" validator.py\n"]
[169.985553, "o", "grep -A 10 \"def compute_readiness_score\" validator.py\r\n\u001b[?2004l\r"]
[169.986391, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
[171.882203, "i", "sed -i 's/if s\\[\"criticality\"\\] == \"high\"$//' validator.py\n"]
[171.882495, "o", "sed -i 's/if s\\[\"criticality\"\\] == \"high\"$//' validator.py\r\n\u001b[?2004l\r"]
[171.8837, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[173.258446, "i", "python validator.py\n"]
[173.258708, "o", "python validator.py\r\n\u001b[?2004l\r"]
[173.314867, "o", "Loading deployment manifest ...\r\n"]
[173.316027, "o", "Checking service health ...\r\n"]
[173.317333, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[173.318341, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[173.319245, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[173.320051, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[173.320775, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  api-gateway -> worker-service -> notification-service -> auth-service -> cache-service\r\nComputing readiness score ...\r\n"]
[173.320793, "o", "  score = 1.5000\r\n"]
[173.320991, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 1.5\r\n"]
[173.330061, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[177.665296, "i", "sed -n '86,105p' validator.py\n"]
[177.665445, "o", "sed -n '86,105p' validator.py\r\n\u001b[?2004l\r"]
[177.666247, "o", "        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n"]
[177.666422, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[179.296843, "i", "grep -n \"if s\\[\\\"criticality\\\"\\] == \\\"high\\\"\" validator.py\n"]
[179.297994, "o", "grep -n \"if s\\[\\\"criticality\\\"\\] == \\\"high\\\"\" validator.py\r\n\u001b[?2004l\r"]
[179.298858, "o", "73:    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services if s[\"criticality\"] == \"high\"}\r\n104:    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n"]
[179.299134, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[181.305461, "i", "sed -i '73s/if s\\[\"criticality\"\\] == \"high\"//' validator.py\n"]
[181.305742, "o", "sed -i '73s/if s\\[\"criticality\"\\] == \"high\"//' validator.py\r\n\u001b[?2004l\r"]
[181.307072, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[182.872419, "i", "sed -i '104s/if s\\[\"criticality\"\\] == \"high\"//' validator.py\n"]
[182.872711, "o", "sed -i '104s/if s\\[\"criticality\"\\] == \"high\"//' validator.py\r\n\u001b[?2004l\r"]
[182.873856, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[184.634433, "i", "python validator.py\n"]
[184.634805, "o", "python validator.py\r\n\u001b[?2004l\r"]
[184.691441, "o", "Loading deployment manifest ...\r\n"]
[184.692778, "o", "Checking service health ...\r\n"]
[184.694591, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[184.695359, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[184.696084, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[184.696738, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[184.697512, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ..."]
[184.697533, "o", "\r\n"]
[184.697642, "o", "  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n"]
[184.697753, "o", "\r\nReport written to /app/deployment_report.json\r\n"]
[184.697783, "o", "Overall status : critical\r\nReadiness score: 0.9\r\n"]
[184.706412, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[189.794254, "i", "grep -A 10 \"critical_ok = all\" validator.py\n"]
[189.794634, "o", "grep -A 10 \"critical_ok = all\" validator.py\r\n\u001b[?2004l\r"]
[189.795565, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n"]
[189.795757, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[191.772295, "i", "sed -i '/critical_ok = all(/,/^    )/c\\    critical_ok = all(\\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\\n        for s in services\\n        if s[\"criticality\"] == \"high\"\\n    )' validator.py\n"]
[191.772737, "o", "sed -i '/critical_ok = all(/,/^    )/c\\    critical_ok = all(\\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\\n        for s in services\\n        if s[\"criticality\"] == \"high\"\\n    )' validator.py\r\n\u001b[?2004l\r"]
[191.774776, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[193.569171, "i", "python validator.py\n"]
[193.569391, "o", "python validator.py\r\n\u001b[?2004l\r"]
[193.658013, "o", "Loading deployment manifest ...\r\n"]
[193.659358, "o", "Checking service health ...\r\n"]
[193.663579, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[193.664571, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[193.66543, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[193.666159, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[193.667389, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[193.676418, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[198.599156, "i", "grep -A 30 \"def compute_startup_order\" validator.py\n"]
[198.599472, "o", "grep -A 30 \"def compute_startup_order\" validator.py\r\n\u001b[?2004l\r"]
[198.600095, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services }\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n"]
[198.600276, "o", "\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n"]
[198.60031, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[200.679932, "i", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' validator.py\n"]
[200.680925, "o", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' validator.py\r\n"]
[200.680962, "o", "\u001b[?2004l\r"]
[200.682825, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[202.421357, "i", "python validator.py\n"]
[202.421571, "o", "python validator.py\r\n\u001b[?2004l\r"]
[202.485976, "o", "Loading deployment manifest ...\r\n"]
[202.487382, "o", "Checking service health ...\r\n"]
[202.488906, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[202.4898, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[202.490536, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[202.491226, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[202.491901, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n"]
[202.492076, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[202.500877, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[207.083758, "i", "grep -A 15 \"for svc, deps in deps_map.items\" validator.py\n"]
[207.083956, "o", "grep -A 15 \"for svc, deps in deps_map.items\" validator.py\r\n\u001b[?2004l\r"]
[207.085054, "o", "    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n"]
[207.085463, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[209.069059, "i", "sed -i 's/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' validator.py\n"]
[209.069299, "o", "sed -i 's/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' validator.py\r\n\u001b[?2004l\r"]
[209.070801, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[210.866341, "i", "sed -i 's/in_degree\\[dep\\] += 1/in_degree[svc] += 1/' validator.py\n"]
[210.866586, "o", "sed -i 's/in_degree\\[dep\\] += 1/in_degree[svc] += 1/' validator.py\r\n\u001b[?2004l\r"]
[210.867769, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[212.22686, "i", "python validator.py\n"]
[212.227266, "o", "python validator.py\r\n\u001b[?2004l\r"]
[212.297596, "o", "Loading deployment manifest ...\r\n"]
[212.298852, "o", "Checking service health ...\r\n"]
[212.30052, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[212.301287, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[212.301943, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[212.30254, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[212.303129, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[212.303185, "o", "  score = 0.9000\r\n"]
[212.303306, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[212.311742, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[216.778934, "i", "cat deployment_report.json\n"]
[216.779189, "o", "cat deployment_report.json\r\n\u001b[?2004l\r"]
[216.779748, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"degraded\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T20:50:00.681681+00:00\"\r\n}"]
[216.780294, "o", "\u001b[?2004h"]
[216.780446, "o", "root@eb68a1250306:/app# "]
[220.479125, "i", "python validator.py\n"]
[220.479597, "o", "python validator.py\r\n\u001b[?2004l\r"]
[220.553742, "o", "Loading deployment manifest ...\r\n"]
[220.554904, "o", "Checking service health ...\r\n"]
[220.558632, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[220.559544, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[220.560444, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[220.561187, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[220.561929, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 0.9000\r\n"]
[220.562118, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[220.572222, "o", "\u001b[?2004hroot@eb68a1250306:/app# "]
[228.280538, "i", "echo \"Task completed successfully\"\n"]
[228.280779, "o", "echo \"Task completed successfully\""]
[228.280914, "o", "\r\n\u001b[?2004l\rTask completed successfully\r\n\u001b[?2004hroot@eb68a1250306:/app# "]
