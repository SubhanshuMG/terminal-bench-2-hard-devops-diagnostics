{"version": 2, "width": 160, "height": 40, "timestamp": 1772226971, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.001983, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[0.980426, "i", "clear\r"]
[0.980759, "o", "clear\r\n\u001b[?2004l\r"]
[0.981827, "o", "\u001b[H\u001b[J\u001b[3J\u001b[?2004hroot@2c18ab8ab423:/app# "]
[2.340602, "i", "ls -la\n"]
[2.340999, "o", "ls -la"]
[2.341142, "o", "\r\n\u001b[?2004l\r"]
[2.342521, "o", "total 32\r\ndrwxr-xr-x 1 root root 4096 Feb 27 20:15 .\r\ndrwxr-xr-x 1 root root 4096 Feb 27 21:16 ..\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10 Dockerfile\r\n-rw-r--r-- 1 root root 2068 Feb 27 19:22 deployment_manifest.yaml\r\n-rw-r--r-- 1 root root 3183 Feb 27 20:15 mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53 requirements.txt\r\n-rw-r--r-- 1 root root 6119 Feb 27 20:15 validator.py\r\n"]
[2.342551, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[3.401951, "i", "cat deployment_manifest.yaml\n"]
[3.402269, "o", "cat deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[3.402846, "o", "# ─────────────────────────────────────────────────────────────────────────────\r\n# deployment_manifest.yaml\r\n#\r\n# Deployment descriptor for the production stack.\r\n#\r\n# Schema notes:\r\n#   • The top-level 'services' block is a legacy v1 monitoring registry read\r\n#     by the external health-dashboard and alert-manager sidecar.  It is NOT\r\n#     the authoritative list for deployment ordering or health validation.\r\n#   • The authoritative service definitions live under 'deployment.services'.\r\n# ─────────────────────────────────────────────────────────────────────────────\r\n\r\n# Legacy monitoring-registry endpoint  (consumed by alert-manager, not by the validator)\r\nservices:\r\n  - name: \"metrics-collector\"\r\n    port: 9091\r\n    health_endpoint: \"/metrics\"\r\n    dependencies: []\r\n    criticality: \"low\"\r\n\r\n# ── Authoritative deployment configuration ────────────────────────────────────\r\ndeployment:\r\n  name: \"production-stack\"\r\n\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n      criticality: \"high\"\r\n\r\n    - name: \"cache-service\"\r\n      port: 8083\r\n      health_endpoint: \"/ping\"\r\n      dependencies: []\r\n      criticality: \"medium\"\r\n\r\n    - name: \"worker-service\"\r\n      port: 8084\r\n      health_endpoint: \"/status\"\r\n      dependencies:\r\n        - \"api-gateway\"\r\n        - \"cache-service\"\r\n      criticality: \"low\"\r\n\r\n    - name: \"notification-service\"\r\n      port: 8085\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"worker-service\"\r\n      criticality: \"low\"\r\n"]
[3.403063, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[4.582434, "i", "curl http://localhost:8081/health\n"]
[4.582728, "o", "curl http://localhost:8081/health\r\n\u001b[?2004l\r"]
[4.588803, "o", "curl: (7) Failed to connect to localhost port 8081 after 0 ms: Could not connect to server\r\n"]
[4.589244, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[6.562188, "i", "python /app/mock_services.py &\n"]
[6.562392, "o", "python /app/mock_services.py &\r\n\u001b[?2004l\r"]
[6.562471, "o", "[1] 592\r\n"]
[6.562569, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[6.669717, "o", "  started  auth-service         /health  -> http://0.0.0.0:8081\r\n"]
[6.669844, "o", "  started  api-gateway          /health  -> http://0.0.0.0:8082\r\n"]
[6.670203, "o", " * Serving Flask app 'auth-service'\r\n * Serving Flask app 'api-gateway'\r\n"]
[6.670297, "o", " * Debug mode: off\r\n"]
[6.67042, "o", "  started  cache-service        /ping    -> http://0.0.0.0:8083\r\n"]
[6.670517, "o", " * Debug mode: off\r\n"]
[6.670793, "o", "  started  worker-service       /status  -> http://0.0.0.0:8084\r\n"]
[6.670966, "o", "  started  notification-service /health  -> http://0.0.0.0:8085\r\n"]
[6.671181, "o", "All mock services running. Ctrl-C to stop.\r\n"]
[6.671271, "o", " * Serving Flask app 'cache-service'\r\n * Debug mode: off\r\n"]
[6.671632, "o", " * Serving Flask app 'worker-service'\r\n * Debug mode: off\r\n"]
[6.671917, "o", " * Serving Flask app 'notification-service'\r\n * Debug mode: off\r\n"]
[9.502593, "i", "curl http://localhost:8081/health\n"]
[9.502797, "o", "curl http://localhost:8081/health\r\n\u001b[?2004l\r"]
[9.50813, "o", "{\"status\":\"ok\",\"version\":\"2.1.0\"}\r\n"]
[9.508639, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[11.457594, "i", "curl http://localhost:8083/ping\n"]
[11.457807, "o", "curl http://localhost:8083/ping\r\n\u001b[?2004l\r"]
[11.462187, "o", "pong"]
[11.462566, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[13.436676, "i", "cat validator.py\n"]
[13.436877, "o", "cat validator.py\r\n\u001b[?2004l\r"]
[13.437527, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\n# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.9"]
[13.437631, "o", "5\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\ndef main():\r\n    manifest_path = \"/app/deployment_manifest.yaml\"\r\n    output_path   = \"/app/deployment_report.json\"\r\n\r\n    print(\"Loading deployment manifest ...\")\r\n    services = load_services(manifest_path)\r\n\r\n    print(\"Checking service health ...\")\r\n    statuses = {}\r\n    for svc in services:\r\n        result = check_health(svc)\r\n        statuses[svc[\"name\"]] = result\r\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\r\n    print(\"Computing startup order ...\")\r\n    startup_order = compute_startup_order(services)\r\n    print(f\"  {' -> '.join(startup_order)}\")\r\n\r\n    print(\"Computing readiness score ...\")\r\n    score = compute_readiness_score(services, statuses)\r\n    print(f\"  score = {score:.4f}\")\r\n\r\n    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\r\n    report = {\r\n        \"deployment_name\":           \"production-stack\",\r\n        \"overall_status\":            overall_status,\r\n        \"readiness_score\":           score,\r\n        \"service_statuses\":          statuses,\r\n        \"startup_order\":             startup_order,\r\n        \"critical_services_healthy\": critical_ok,\r\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n    }\r\n\r\n    with open(output_path, \"w\") as f:\r\n        json.dump(report, f, indent=2)\r\n\r\n    print(f\"\\nReport written to {output_path}\")\r\n    print(f\"Overall status : {overall_status}\")\r\n    print(f\"Readiness score: {score}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n\u001b[?2004hroot@2c18ab8ab423:/app# "]
[15.160602, "i", "python /app/validator.py\n"]
[15.160831, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[15.221765, "o", "Loading deployment manifest ...\r\n"]
[15.222926, "o", "Checking service health ...\r\n"]
[15.223546, "o", "  metrics-collector         unhealthy  (HTTP 0)\r\nComputing startup order ...\r\n  metrics-collector\r\nComputing readiness score ...\r\n  score = 0.0000\r\n"]
[15.224406, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : critical\r\nReadiness score: 0.0\r\n"]
[15.233864, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[18.241485, "i", "cp /app/validator.py /app/validator.py.backup\n"]
[18.242687, "o", "cp /app/validator.py /app/validator.py.backup\r\n\u001b[?2004l\r"]
[18.244812, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[19.301507, "i", "sed -i \"/return config\\[\\\"services\\\"\\]/c\\    return config[\\\"deployment\\\"][\\\"services\\\"]\" /app/validator.py\n"]
[19.301826, "o", "sed -i \"/return config\\[\\\"services\\\"\\]/c\\    return config[\\\"deployment\\\"][\\\"services\\\"]\" /app/validator.py\r\n\u001b[?2004l\r"]
[19.303258, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[20.360258, "i", "grep -A 2 -B 2 \"return config\" /app/validator.py\n"]
[20.360446, "o", "grep -A 2 -B 2 \"return config\" /app/validator.py\r\n\u001b[?2004l\r"]
[20.361091, "o", "        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"deployment\"][\"services\"]\r\n\r\n\r\n"]
[20.361259, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[21.349571, "i", "python /app/validator.py\n"]
[21.349703, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[21.405097, "o", "Loading deployment manifest ...\r\n"]
[21.406368, "o", "Checking service health ...\r\n"]
[21.407993, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[21.408954, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[21.409732, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[21.410653, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[21.411273, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\nComputing readiness score ...\r\n"]
[21.411375, "o", "  score = 1.0000\r\n"]
[21.411447, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[21.420038, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[24.699305, "i", "cat /app/deployment_report.json\n"]
[24.700474, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[24.701014, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"healthy\",\r\n  \"readiness_score\": 1.0,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"notification-service\",\r\n    \"worker-service\",\r\n    \"api-gateway\",\r\n    \"auth-service\",\r\n    \"cache-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T21:16:33.254991+00:00\"\r\n}"]
[24.701266, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[26.008737, "i", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' /app/validator.py\n"]
[26.009014, "o", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' /app/validator.py\r\n\u001b[?2004l\r"]
[26.010423, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[27.043002, "i", "grep -A 15 \"def compute_startup_order\" /app/validator.py\n"]
[27.043278, "o", "grep -A 15 \"def compute_startup_order\" /app/validator.py\r\n\u001b[?2004l\r"]
[27.044145, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n"]
[27.044293, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[28.842951, "i", "cat > /tmp/fix.py << 'EOF'\n# Create a new version of the compute_startup_order function\ndef compute_startup_order(services: list) -> list:\n    \"\"\"\n    Return a topologically sorted startup order using Kahn's algorithm.\n    Dependencies must start before the services that depend on them.\n    \"\"\"\n    names = [s[\"name\"] for s in services]\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\n\n    graph     = {n: [] for n in names}\n    in_degree = {n: 0 for n in names}\n\n    for svc, deps in deps_map.items():\n        for dep in deps:\n            graph[dep].append(svc)  # dep -> svc (dependency points to service)\n            in_degree[svc] += 1     # service depends on dependency\n\n    queue = deque(n for n in names if in_degree[n] == 0)\n    order = []\n    while queue:\n        node = queue.popleft()\n        order.append(node)\n        for neighbor in graph[node]:\n            in_degree[neighbor] -= 1\n            if in_degree[neighbor] == 0:\n                queue.append(neighbor)\n    return order\nEOF\n"]
[28.843359, "o", "cat > /tmp/fix.py << 'EOF'\r\n\u001b[?2004l\r"]
[28.843381, "o", "\u001b[?2004h> "]
[28.843512, "o", "# Create a new version of the compute_startup_order function\r\n\u001b[?2004l\r\u001b[?2004h> def compute_startup_order(services: list) -> list:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[28.844076, "o", ">     Return a topologically sorted startup order using Kahn's algorithm.\r\n\u001b[?2004l\r\u001b[?2004h>     Dependencies must start before the services that depend on them.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     names = [s[\"name\"] for s in services]\r\n\u001b[?2004l\r\u001b[?2004h>     deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     graph     = {n: [] for n in names}\r\n\u001b[?2004l\r\u001b[?2004h>     in_degree = {n: 0 for n in names}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     for svc, deps in deps_map.items():\r\n\u001b[?2004l\r\u001b[?2004h>         for dep in deps:\r\n\u001b[?2004l\r\u001b[?2004h>             graph[dep].append(svc)  # dep -> svc (dependency points to service)\r\n\u001b[?2004l\r\u001b[?2004h>             in_degree[svc] += 1     # service depends on dependency\r\n\u001b[?2004l\r"]
[28.844194, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     queue = deque(n for n in names if in_degree[n] == 0)\r\n\u001b[?2004l\r\u001b[?2004h>     order = []\r\n\u001b[?2004l\r"]
[28.844216, "o", "\u001b[?2004h> "]
[28.84434, "o", "    while queue:\r\n\u001b[?2004l\r\u001b[?2004h>         node = queue.popleft()\r\n\u001b[?2004l\r"]
[28.844403, "o", "\u001b[?2004h>         order.append(node)\r\n\u001b[?2004l\r\u001b[?2004h"]
[28.844479, "o", "> "]
[28.844508, "o", "        for neighbor in graph[node]:\r\n\u001b[?2004l\r\u001b[?2004h>             in_degree[neighbor] -= 1\r\n\u001b[?2004l\r\u001b[?2004h> "]
[28.84464, "o", "            if in_degree[neighbor] == 0:\r\n\u001b[?2004l\r\u001b[?2004h>                 queue.append(neighbor)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[28.844658, "o", "    return order\r\n\u001b[?2004l\r\u001b[?2004h> "]
[28.844762, "o", "EOF\r\n\u001b[?2004l\r"]
[28.845437, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[30.511705, "i", "sed -i '/def compute_startup_order/,/^    return order$/c\\ndef compute_startup_order(services: list) -> list:\\n    \"\"\"\\n    Return a topologically sorted startup order using Kahn'\\''s algorithm.\\n    Dependencies must start before the services that depend on them.\\n    \"\"\"\\n    names = [s[\"name\"] for s in services]\\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\\n\\n    graph     = {n: [] for n in names}\\n    in_degree = {n: 0 for n in names}\\n\\n    for svc, deps in deps_map.items():\\n        for dep in deps:\\n            graph[dep].append(svc)  # dep -> svc (dependency points to service)\\n            in_degree[svc] += 1     # service depends on dependency\\n\\n    queue = deque(n for n in names if in_degree[n] == 0)\\n    order = []\\n    while queue:\\n        node = queue.popleft()\\n        order.append(node)\\n        for neighbor in graph[node]:\\n            in_degree[neighbor] -= 1\\n            if in_degree[neighbor] == 0:\\n                queue.append(neighbor)\\n    return order' /app/validator.py\n"]
[30.51294, "o", "sed -i '/def compute_startup_order/,/^    return order$/c\\ndef compute_startup_order(services: list) -> list:\\n    \"\"\"\\n    Return a topologically sorted startup order using Kahn'\\''s algorithm.\\n    Dependencies must start before the services that depend on them.\\n    \"\"\"\\n    names = [s[\"name\"] for s in services]\\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\\n\\n    graph     = {n: [] for n in names}\\n    in_degree = {n: 0 for n in names}\\n\\n    for svc, deps in deps_map.items():\\n        for dep in deps:\\n            graph[dep].append(svc)  # dep -> svc (dependency points to service)\\n            in_degree[svc] += 1     # service depends on dependency\\n\\n    queue = deque(n for n in names if in_degree[n] == 0)\\n    order = []\\n    while queue:\\n        node = queue.popleft()\\n        order.append(node)\\n        for neighbor in graph[node]:\\n            in_degree[neighbor] -= 1\\n            if in_degree[neighbor] == 0:\\n                queue.append(neighbor)\\n    return order' /app"]
[30.512976, "o", "/validator.py\r\n\u001b[?2004l\r"]
[30.514156, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[31.794591, "i", "grep -A 10 \"def compute_startup_order\" /app/validator.py\n"]
[31.794782, "o", "grep -A 10 \"def compute_startup_order\" /app/validator.py\r\n\u001b[?2004l\r"]
[31.795454, "o", "ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n"]
[31.795479, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[32.796752, "i", "sed -i 's/ndef compute_startup_order/def compute_startup_order/' /app/validator.py\n"]
[32.797059, "o", "sed -i 's/ndef compute_startup_order/def compute_startup_order/' /app/validator.py\r\n\u001b[?2004l\r"]
[32.798517, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[34.039863, "i", "grep -A 5 \"def compute_startup_order\" /app/validator.py\n"]
[34.040035, "o", "grep -A 5 \"def compute_startup_order\" /app/validator.py\r\n\u001b[?2004l\r"]
[34.040651, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n"]
[34.040802, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[35.194794, "i", "python /app/validator.py\n"]
[35.194984, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[35.2635, "o", "Loading deployment manifest ...\r\n"]
[35.264738, "o", "Checking service health ...\r\n"]
[35.267499, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[35.268382, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[35.269113, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[35.269838, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[35.270634, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 1.0000\r\n"]
[35.270836, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[35.279517, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[38.565672, "i", "cat /app/deployment_report.json\n"]
[38.565925, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[38.566634, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"healthy\",\r\n  \"readiness_score\": 1.0,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T21:16:47.113933+00:00\"\r\n}"]
[38.566859, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[39.84884, "i", "grep -A 15 \"def determine_status\" /app/validator.py\n"]
[39.849189, "o", "grep -A 15 \"def determine_status\" /app/validator.py\r\n"]
[39.849247, "o", "\u001b[?2004l\r"]
[39.849687, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[39.849807, "o", "\u001b[?2004h"]
[39.849843, "o", "root@2c18ab8ab423:/app# "]
[41.161444, "i", "sed -i 's/critical_ok = all(/critical_ok = all(/' /app/validator.py\n"]
[41.16165, "o", "sed -i 's/critical_ok = all(/critical_ok = all(/' /app/validator.py\r\n\u001b[?2004l\r"]
[41.162596, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[42.34879, "i", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' /app/validator.py\n"]
[42.349093, "o", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' /app/validator.py\r\n\u001b[?2004l\r"]
[42.350041, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[43.407437, "i", "grep -A 5 \"critical_ok = all\" /app/validator.py\n"]
[43.407692, "o", "grep -A 5 \"critical_ok = all\" /app/validator.py\r\n\u001b[?2004l\r"]
[43.40833, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n    if not critical_ok:\r\n"]
[43.408608, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[44.617552, "i", "python /app/validator.py\n"]
[44.61773, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[44.681475, "o", "Loading deployment manifest ...\r\n"]
[44.682711, "o", "Checking service health ...\r\n"]
[44.684455, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[44.685395, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[44.686131, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[44.686842, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[44.687523, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\nTraceback (most recent call last):\r\n  File \"/app/validator.py\", line 167, in <module>\r\n"]
[44.687615, "o", "    main()\r\n"]
[44.687652, "o", "  File \"/app/validator.py\", line 139, in main\r\n    startup_order = compute_startup_order(services)\r\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n"]
[44.68779, "o", "  File \"/app/validator.py\", line 63, in compute_startup_order\r\n    graph[dep].append(svc)  # dep -> svc (dependency points to service)\r\n    ~~~~~^^^^^\r\nKeyError: 'cache-service'\r\n"]
[44.696404, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[48.011634, "i", "grep -A 20 \"def compute_startup_order\" /app/validator.py\n"]
[48.011858, "o", "grep -A 20 \"def compute_startup_order\" /app/validator.py\r\n\u001b[?2004l\r"]
[48.01245, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services if s[\"criticality\"] == \"high\"]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services if s[\"criticality\"] == \"high\"}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[dep].append(svc)  # dep -> svc (dependency points to service)\r\n            in_degree[svc] += 1     # service depends on dependency\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n"]
[48.012793, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[50.158983, "i", "sed -i 's/names = \\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/names = [s[\"name\"] for s in services]/' /app/validator.py\n"]
[50.159601, "o", "sed -i 's/names = \\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/names = [s[\"name\"] for s in services]/' /app/validator.py\r\n\u001b[?2004l\r"]
[50.160983, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[51.540602, "i", "sed -i 's/deps_map = {s\\[\"name\"\\]: s.get(\"dependencies\", \\[\\]) for s in services if s\\[\"criticality\"\\] == \"high\"}/deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}/' /app/validator.py\n"]
[51.540944, "o", "sed -i 's/deps_map = {s\\[\"name\"\\]: s.get(\"dependencies\", \\[\\]) for s in services if s\\[\"criticality\"\\] == \"high\"}/deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}/' /app/validator.py\r\n\u001b[?2004l\r"]
[51.542337, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[52.567794, "i", "grep -A 5 \"def compute_startup_order\" /app/validator.py\n"]
[52.567986, "o", "grep -A 5 \"def compute_startup_order\" /app/validator.py\r\n\u001b[?2004l\r"]
[52.568707, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n"]
[52.568795, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[53.578203, "i", "python /app/validator.py\n"]
[53.578527, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[53.64432, "o", "Loading deployment manifest ...\r\n"]
[53.645532, "o", "Checking service health ...\r\n"]
[53.647638, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[53.648846, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[53.649762, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[53.650446, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[53.651213, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[53.651313, "o", "  score = 1.0000\r\n"]
[53.651404, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[53.661183, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[57.246305, "i", "cat /app/deployment_report.json\n"]
[57.246657, "o", "cat /app/deployment_report.json\r\n"]
[57.246761, "o", "\u001b[?2004l\r"]
[57.24715, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"healthy\",\r\n  \"readiness_score\": 1.0,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T21:17:05.494525+00:00\"\r\n}"]
[57.24749, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[60.977545, "i", "pkill -f mock_services\n"]
[60.977918, "o", "pkill -f mock_services\r\n\u001b[?2004l\r"]
[60.978026, "o", "bash: pkill: command not found\r\n"]
[60.978204, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[63.290841, "i", "ps aux | grep mock\n"]
[63.291181, "o", "ps aux | grep mock\r\n\u001b[?2004l\r"]
[63.291536, "o", "bash: ps: command not found\r\n"]
[63.292326, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[65.076448, "i", "python /app/validator.py\n"]
[65.076645, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[65.137602, "o", "Loading deployment manifest ...\r\n"]
[65.138875, "o", "Checking service health ...\r\n"]
[65.140201, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[65.141267, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[65.142005, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[65.14275, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[65.143455, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n"]
[65.143506, "o", "  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n  score = 1.0000\r\n"]
[65.14365, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[65.152443, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[68.646251, "i", "grep -A 10 \"def compute_readiness_score\" /app/validator.py\n"]
[68.646584, "o", "grep -A 10 \"def compute_readiness_score\" /app/validator.py\r\n\u001b[?2004l\r"]
[68.647052, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n"]
[68.647295, "o", "    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n\u001b[?2004hroot@2c18ab8ab423:/app# "]
[70.626307, "i", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' /app/validator.py\n"]
[70.62665, "o", "sed -i 's/for s in services if s\\[\"criticality\"\\] == \"high\"$/for s in services/' /app/validator.py\r\n\u001b[?2004l\r"]
[70.627999, "o", "\u001b[?2004h"]
[70.628029, "o", "root@2c18ab8ab423:/app# "]
[72.086551, "i", "grep -A 12 \"def compute_readiness_score\" /app/validator.py\n"]
[72.086769, "o", "grep -A 12 \"def compute_readiness_score\" /app/validator.py\r\n\u001b[?2004l\r"]
[72.087466, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services if s[\"criticality\"] == \"high\")\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n"]
[72.087588, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[73.736651, "i", "sed -i 's/total   = sum(weight_map\\[s\\[\"criticality\"\\]\\] for s in services if s\\[\"criticality\"\\] == \"high\")/total   = sum(weight_map[s[\"criticality\"]] for s in services)/' /app/validator.py\n"]
[73.736943, "o", "sed -i 's/total   = sum(weight_map\\[s\\[\"criticality\"\\]\\] for s in services if s\\[\"criticality\"\\] == \"high\")/total   = sum(weight_map[s[\"criticality\"]] for s in services)/' /app/validator.py\r\n\u001b[?2004l\r"]
[73.738817, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[75.206638, "i", "grep -A 12 \"def compute_readiness_score\" /app/validator.py\n"]
[75.206814, "o", "grep -A 12 \"def compute_readiness_score\" /app/validator.py\r\n\u001b[?2004l\r"]
[75.207442, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n"]
[75.207671, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[76.677688, "i", "python /app/validator.py\n"]
[76.677829, "o", "python /app/validator.py\r\n\u001b[?2004l\r"]
[76.736789, "o", "Loading deployment manifest ...\r\n"]
[76.738103, "o", "Checking service health ...\r\n"]
[76.73979, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[76.740623, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[76.741294, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[76.741979, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[76.742719, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[76.742805, "o", "  score = 1.0000\r\n"]
[76.742943, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[76.752872, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
[82.365732, "i", "cat /app/deployment_report.json | python -m json.tool\n"]
[82.366204, "o", "cat /app/deployment_report.json | python -m json.tool\r\n\u001b[?2004l\r"]
[82.381347, "o", "{\r\n    \"deployment_name\": \"production-stack\",\r\n    \"overall_status\": \"healthy\",\r\n    \"readiness_score\": 1.0,\r\n    \"service_statuses\": {\r\n        \"auth-service\": {\r\n            \"status\": \"healthy\",\r\n            \"http_status\": 200,\r\n            \"criticality\": \"high\"\r\n        },\r\n        \"api-gateway\": {\r\n            \"status\": \"healthy\",\r\n            \"http_status\": 200,\r\n            \"criticality\": \"high\"\r\n        },\r\n        \"cache-service\": {\r\n            \"status\": \"healthy\",\r\n            \"http_status\": 200,\r\n            \"criticality\": \"medium\"\r\n        },\r\n        \"worker-service\": {\r\n            \"status\": \"healthy\",\r\n            \"http_status\": 200,\r\n            \"criticality\": \"low\"\r\n        },\r\n        "]
[82.381388, "o", "\"notification-service\": {\r\n            \"status\": \"healthy\",\r\n            \"http_status\": 200,\r\n            \"criticality\": \"low\"\r\n        }\r\n    },\r\n    \"startup_order\": [\r\n        \"auth-service\",\r\n        \"cache-service\",\r\n        \"api-gateway\""]
[82.38149, "o", ",\r\n        \"worker-service\",\r\n        \"notification-service\""]
[82.381537, "o", "\r\n    ],\r\n    \"critical_services_healthy\": true,\r\n    \"timestamp\": \"2026-02-27T21:17:28.586314+00:00\"\r\n}\r\n"]
[82.383948, "o", "\u001b[?2004hroot@2c18ab8ab423:/app# "]
