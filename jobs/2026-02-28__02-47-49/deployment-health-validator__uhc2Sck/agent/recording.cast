{"version": 2, "width": 160, "height": 40, "timestamp": 1772227079, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.001741, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[1.034404, "i", "clear\r"]
[1.034783, "o", "clear\r\n\u001b[?2004l\r"]
[1.035516, "o", "\u001b[H\u001b[J\u001b[3J"]
[1.035796, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[2.450355, "i", "ls -la\n"]
[2.450633, "o", "ls -la\r\n\u001b[?2004l\r"]
[2.451281, "o", "total 32\r\ndrwxr-xr-x 1 root root 4096 Feb 27 20:15 ."]
[2.451296, "o", "\r\n"]
[2.451304, "o", "drwxr-xr-x 1 root root 4096 Feb 27 21:18 ..\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10 Dockerfile\r\n-rw-r--r-- 1 root root 2068 Feb 27 19:22 deployment_manifest.yaml\r\n-rw-r--r-- 1 root root 3183 Feb 27 20:15 mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53 requirements.txt\r\n-rw-r--r-- 1 root root 6119 Feb 27 20:15 validator.py\r\n"]
[2.451541, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[3.442329, "i", "cat /app/deployment_manifest.yaml\n"]
[3.442631, "o", "cat /app/deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[3.443275, "o", "# ─────────────────────────────────────────────────────────────────────────────\r\n# deployment_manifest.yaml\r\n#\r\n# Deployment descriptor for the production stack.\r\n#\r\n# Schema notes:\r\n#   • The top-level 'services' block is a legacy v1 monitoring registry read\r\n#     by the external health-dashboard and alert-manager sidecar.  It is NOT\r\n#     the authoritative list for deployment ordering or health validation.\r\n#   • The authoritative service definitions live under 'deployment.services'.\r\n# ─────────────────────────────────────────────────────────────────────────────\r\n\r\n# Legacy monitoring-registry endpoint  (consumed by alert-manager, not by the validator)\r\nservices:\r\n  - name: \"metrics-collector\"\r\n    port: 9091\r\n    health_endpoint: \"/metrics\"\r\n    dependencies: []\r\n    criticality: \"low\"\r\n\r\n# ── Authoritative deployment configuration ────────────────────────────────────\r\ndeployment:\r\n  name: \"production-stack\"\r\n\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n      criticality: \"high\"\r\n\r\n    - name: \"cache-service\"\r\n      port: 8083\r\n      health_endpoint: \"/ping\"\r\n      dependencies: []\r\n      criticality: \"medium\"\r\n\r\n    - name: \"worker-service\"\r\n      port: 8084\r\n      health_endpoint: \"/status\"\r\n      dependencies:\r\n        - \"api-gateway\"\r\n        - \"cache-service\"\r\n      criticality: \"low\"\r\n\r\n    - name: \"notification-service\"\r\n      port: 8085\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"worker-service\"\r\n      criticality: \"low\"\r\n"]
[3.443492, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[4.491347, "i", "curl -s http://localhost:8081/health\n"]
[4.491574, "o", "curl -s http://localhost:8081/health\r\n\u001b[?2004l\r"]
[4.497226, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[6.507336, "i", "ps aux | grep mock\n"]
[6.507503, "o", "ps aux | grep mock\r\n\u001b[?2004l\r"]
[6.507937, "o", "bash: ps: command not found\r\n"]
[6.508471, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[7.501377, "i", "curl -s http://localhost:8082/health\n"]
[7.50151, "o", "curl -s http://localhost:8082/health\r\n\u001b[?2004l\r"]
[7.50589, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[9.390298, "i", "pgrep python\n"]
[9.390449, "o", "pgrep python\r\n\u001b[?2004l\r"]
[9.390738, "o", "bash: pgrep: command not found\r\n"]
[9.390831, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[10.447141, "i", "cat /app/validator.py\n"]
[10.447312, "o", "cat /app/validator.py\r\n\u001b[?2004l\r"]
[10.447884, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        healthy = resp.status_code == 200\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\n# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.9"]
[10.447952, "o", "5\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\ndef main():\r\n    manifest_path = \"/app/deployment_manifest.yaml\"\r\n    output_path   = \"/app/deployment_report.json\"\r\n\r\n    print(\"Loading deployment manifest ...\")\r\n    services = load_services(manifest_path)\r\n\r\n    print(\"Checking service health ...\")\r\n    statuses = {}\r\n    for svc in services:\r\n        result = check_health(svc)\r\n        statuses[svc[\"name\"]] = result\r\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\r\n    print(\"Computing startup order ...\")\r\n    startup_order = compute_startup_order(services)\r\n    print(f\"  {' -> '.join(startup_order)}\")\r\n\r\n    print(\"Computing readiness score ...\")\r\n    score = compute_readiness_score(services, statuses)\r\n    print(f\"  score = {score:.4f}\")\r\n\r\n    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\r\n    report = {\r\n        \"deployment_name\":           \"production-stack\",\r\n        \"overall_status\":            overall_status,\r\n        \"readiness_score\":           score,\r\n        \"service_statuses\":          statuses,\r\n        \"startup_order\":             startup_order,\r\n        \"critical_services_healthy\": critical_ok,\r\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n    }\r\n\r\n    with open(output_path, \"w\") as f:\r\n        json.dump(report, f, indent=2)\r\n\r\n    print(f\"\\nReport written to {output_path}\")\r\n    print(f\"Overall status : {overall_status}\")\r\n    print(f\"Readiness score: {score}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n\u001b[?2004hroot@d796365c4a34:/app# "]
[11.894739, "i", "python3 /app/mock_services.py &\n"]
[11.894913, "o", "python3 /app/mock_services.py &\r\n\u001b[?2004l\r"]
[11.895097, "o", "[1] 667\r\n"]
[11.895177, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[11.982976, "o", "  started  auth-service         /health  -> http://0.0.0.0:8081\r\n"]
[11.983146, "o", " * Serving Flask app 'auth-service'\r\n * Debug mode: off\r\n"]
[11.983414, "o", "  started  api-gateway          /health  -> http://0.0.0.0:8082\r\n"]
[11.983681, "o", " * Serving Flask app 'api-gateway'\r\n"]
[11.983864, "o", "  started  cache-service        /ping    -> http://0.0.0.0:8083\r\n"]
[11.984106, "o", " * Debug mode: off\r\n"]
[11.98437, "o", "  started  worker-service       /status  -> http://0.0.0.0:8084\r\n"]
[11.984527, "o", " * Serving Flask app 'cache-service'\r\n * Debug mode: off\r\n"]
[11.985408, "o", " * Serving Flask app 'worker-service'\r\n"]
[11.985633, "o", " * Serving Flask app 'notification-service'\r\n"]
[11.985819, "o", "  started  notification-service /health  -> http://0.0.0.0:8085\r\nAll mock services running. Ctrl-C to stop.\r\n"]
[11.985951, "o", " * Debug mode: off\r\n"]
[11.986174, "o", " * Debug mode: off\r\n"]
[14.1444, "i", "curl -s http://localhost:8081/health\n"]
[14.144732, "o", "curl -s http://localhost:8081/health\r\n\u001b[?2004l\r"]
[14.149149, "o", "{\"status\":\"ok\",\"version\":\"2.1.0\"}\r\n"]
[14.149571, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[16.317398, "i", "cp /app/validator.py /app/validator.py.backup\n"]
[16.317719, "o", "cp /app/validator.py /app/validator.py.backup\r\n\u001b[?2004l\r"]
[16.319358, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[17.474064, "i", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' /app/validator.py\n"]
[17.474421, "o", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' /app/validator.py\r\n\u001b[?2004l\r"]
[17.475619, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[18.540555, "i", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' /app/validator.py\n"]
[18.540894, "o", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' /app/validator.py\r\n\u001b[?2004l\r"]
[18.542103, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[19.502287, "i", "sed -i 's/critical_ok = all(/critical_ok = all(/' /app/validator.py\n"]
[19.50268, "o", "sed -i 's/critical_ok = all(/critical_ok = all(/' /app/validator.py\r\n\u001b[?2004l\r"]
[19.503553, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[20.616852, "i", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' /app/validator.py\n"]
[20.617182, "o", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' /app/validator.py\r\n\u001b[?2004l\r"]
[20.618322, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[21.618529, "i", "grep -A 10 'def determine_status' /app/validator.py\n"]
[21.618702, "o", "grep -A 10 'def determine_status' /app/validator.py\r\n\u001b[?2004l\r"]
[21.619438, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n"]
[21.619727, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[22.640551, "i", "grep -A 15 'critical_ok = all(' /app/validator.py\n"]
[22.640899, "o", "grep -A 15 'critical_ok = all(' /app/validator.py\r\n\u001b[?2004l\r"]
[22.641798, "o", "    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services if s[\"criticality\"] == \"high\"\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\n\u001b[?2004hroot@d796365c4a34:/app# "]
[23.745421, "i", "python3 /app/validator.py\n"]
[23.745616, "o", "python3 /app/validator.py\r\n\u001b[?2004l\r"]
[23.809734, "o", "Loading deployment manifest ...\r\n"]
[23.811069, "o", "Checking service health ...\r\n"]
[23.812994, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[23.813996, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[23.814861, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[23.815532, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[23.816249, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n"]
[23.816337, "o", "Traceback (most recent call last):\r\n  File \"/app/validator.py\", line 167, in <module>\r\n    main()\r\n"]
[23.816495, "o", "  File \"/app/validator.py\", line 139, in main\r\n    startup_order = compute_startup_order(services)\r\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/app/validator.py\", line 64, in compute_startup_order\r\n"]
[23.816563, "o", "    in_degree[dep] += 1\r\n    ~~~~~~~~~^^^^^\r\nKeyError: 'cache-service'\r\n"]
[23.826028, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[28.019304, "i", "sed -n '45,70p' /app/validator.py\n"]
[28.019522, "o", "sed -n '45,70p' /app/validator.py\r\n\u001b[?2004l\r"]
[28.020069, "o", "        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services if s[\"criticality\"] == \"high\"]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services if s[\"criticality\"] == \"high\"}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n"]
[28.020276, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[29.363777, "i", "sed -i 's/names = \\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/names = [s[\"name\"] for s in services]/' /app/validator.py\n"]
[29.364147, "o", "sed -i 's/names = \\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/names = [s[\"name\"] for s in services]/' /app/validator.py\r\n\u001b[?2004l\r"]
[29.365709, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[30.494387, "i", "sed -i 's/deps_map = {s\\[\"name\"\\]: s.get(\"dependencies\", \\[\\]) for s in services if s\\[\"criticality\"\\] == \"high\"}/deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}/' /app/validator.py\n"]
[30.494699, "o", "sed -i 's/deps_map = {s\\[\"name\"\\]: s.get(\"dependencies\", \\[\\]) for s in services if s\\[\"criticality\"\\] == \"high\"}/deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}/' /app/validator.py\r\n"]
[30.494818, "o", "\u001b[?2004l\r"]
[30.496056, "o", "\u001b[?2004h"]
[30.496469, "o", "root@d796365c4a34:/app# "]
[31.681519, "i", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' /app/validator.py\n"]
[31.682315, "o", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' /app/validator.py\r\n\u001b[?2004l\r"]
[31.683182, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[32.732597, "i", "sed -n '50,75p' /app/validator.py\n"]
[32.732854, "o", "sed -n '50,75p' /app/validator.py\r\n\u001b[?2004l\r"]
[32.733386, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n"]
[32.734017, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[33.929052, "i", "sed -i '65,66c\\            graph[dep].append(svc)\\n            in_degree[svc] += 1' /app/validator.py\n"]
[33.929262, "o", "sed -i '65,66c\\            graph[dep].append(svc)\\n            in_degree[svc] += 1' /app/validator.py\r\n\u001b[?2004l\r"]
[33.930402, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[34.849581, "i", "sed -n '60,70p' /app/validator.py\n"]
[34.849897, "o", "sed -n '60,70p' /app/validator.py\r\n\u001b[?2004l\r"]
[34.850775, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n"]
[34.850801, "o", "            graph[dep].append(svc)\r\n            in_degree[svc] += 1\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n"]
[34.851084, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[35.935573, "i", "sed -i '65,66d' /app/validator.py\n"]
[35.935861, "o", "sed -i '65,66d' /app/validator.py\r\n\u001b[?2004l\r"]
[35.936814, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[37.152822, "i", "sed -n '60,70p' /app/validator.py\n"]
[37.153472, "o", "sed -n '60,70p' /app/validator.py\r\n"]
[37.154039, "o", "\u001b[?2004l\r"]
[37.154878, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n"]
[37.155309, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[38.34317, "i", "sed -n '60,75p' /app/validator.py\n"]
[38.343442, "o", "sed -n '60,75p' /app/validator.py\r\n\u001b[?2004l\r"]
[38.344338, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n"]
[38.344572, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[39.462174, "i", "sed -i '65,66c\\            graph[dep].append(svc)\\n            in_degree[svc] += 1' /app/validator.py\n"]
[39.462415, "o", "sed -i '65,66c\\            graph[dep].append(svc)\\n            in_degree[svc] += 1' /app/validator.py\r\n\u001b[?2004l\r"]
[39.463486, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[40.444377, "i", "sed -n '60,70p' /app/validator.py\n"]
[40.444579, "o", "sed -n '60,70p' /app/validator.py\r\n\u001b[?2004l\r"]
[40.445378, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n            graph[dep].append(svc)\r\n            in_degree[svc] += 1\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n\u001b[?2004hroot@d796365c4a34:/app# "]
[41.699099, "i", "cp /app/validator.py.backup /app/validator.py\n"]
[41.699359, "o", "cp /app/validator.py.backup /app/validator.py\r\n\u001b[?2004l\r"]
[41.70043, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[43.100221, "i", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' /app/validator.py\n"]
[43.100611, "o", "sed -i 's/return config\\[\"services\"\\]/return config[\"deployment\"][\"services\"]/' /app/validator.py\r\n\u001b[?2004l\r"]
[43.101956, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[44.438117, "i", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' /app/validator.py\n"]
[44.438399, "o", "sed -i 's/weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}/weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}/' /app/validator.py\r\n\u001b[?2004l\r"]
[44.439416, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[45.657742, "i", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' /app/validator.py\n"]
[45.658063, "o", "sed -i 's/for s in services/for s in services if s[\"criticality\"] == \"high\"/' /app/validator.py\r\n\u001b[?2004l\r"]
[45.658956, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[47.052806, "i", "sed -i 's/names = \\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/names = [s[\"name\"] for s in services]/' /app/validator.py\n"]
[47.053263, "o", "sed -i 's/names = \\[s\\[\"name\"\\] for s in services if s\\[\"criticality\"\\] == \"high\"\\]/names = [s[\"name\"] for s in services]/' /app/validator.py\r\n\u001b[?2004l\r"]
[47.054832, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[48.166211, "i", "sed -i 's/deps_map = {s\\[\"name\"\\]: s.get(\"dependencies\", \\[\\]) for s in services if s\\[\"criticality\"\\] == \"high\"}/deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}/' /app/validator.py\n"]
[48.166624, "o", "sed -i 's/deps_map = {s\\[\"name\"\\]: s.get(\"dependencies\", \\[\\]) for s in services if s\\[\"criticality\"\\] == \"high\"}/deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}/' /app/validator.py\r\n\u001b[?2004l\r"]
[48.167749, "o", "\u001b[?2004h"]
[48.167849, "o", "root@d796365c4a34:/app# "]
[49.352552, "i", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' /app/validator.py\n"]
[49.353072, "o", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' /app/validator.py\r\n\u001b[?2004l\r"]
[49.354442, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[50.473207, "i", "python3 /app/validator.py\n"]
[50.473804, "o", "python3 /app/validator.py\r\n\u001b[?2004l\r"]
[50.551115, "o", "Loading deployment manifest ...\r\n"]
[50.55249, "o", "Checking service health ...\r\n"]
[50.55661, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[50.557476, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[50.558419, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[50.559129, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[50.559893, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\nComputing readiness score ...\r\n  score = 1.0000\r\n"]
[50.560114, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[50.568908, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[54.509004, "i", "cat /app/deployment_report.json\n"]
[54.509297, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[54.510004, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"healthy\",\r\n  \"readiness_score\": 1.0,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"notification-service\",\r\n    \"worker-service\",\r\n    \"api-gateway\",\r\n    \"auth-service\",\r\n    \"cache-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T21:18:49.690570+00:00\"\r\n}\u001b[?2004h"]
[54.510583, "o", "root@d796365c4a34:/app# "]
[57.832546, "i", "python3 /app/validator.py | grep 'Computing startup order'\n"]
[57.832873, "o", "python3 /app/validator.py | grep 'Computing startup order'\r\n\u001b[?2004l\r"]
[57.902281, "o", "Computing startup order ...\r\n"]
[57.911334, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[62.121561, "i", "python3 /app/validator.py | grep -A 1 'Computing startup order'\n"]
[62.121946, "o", "python3 /app/validator.py | grep -A 1 'Computing startup order'\r\n\u001b[?2004l\r"]
[62.188586, "o", "Computing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\n"]
[62.198337, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[66.979843, "i", "grep -A 25 'def compute_startup_order' /app/validator.py\n"]
[66.980036, "o", "grep -A 25 'def compute_startup_order' /app/validator.py\r\n"]
[66.980084, "o", "\u001b[?2004l\r"]
[66.980949, "o", "def compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n"]
[66.981143, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[69.239039, "i", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' /app/validator.py\n"]
[69.239426, "o", "sed -i 's/graph\\[svc\\].append(dep); in_degree\\[dep\\] += 1/graph[dep].append(svc); in_degree[svc] += 1/' /app/validator.py\r\n\u001b[?2004l\r"]
[69.240721, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[70.511812, "i", "python3 /app/validator.py | grep -A 1 'Computing startup order'\n"]
[70.512144, "o", "python3 /app/validator.py | grep -A 1 'Computing startup order'\r\n\u001b[?2004l\r"]
[70.575032, "o", "Computing startup order ...\r\n  notification-service -> worker-service -> api-gateway -> auth-service -> cache-service\r\n"]
[70.583873, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[74.942496, "i", "sed -n '62,68p' /app/validator.py\n"]
[74.942764, "o", "sed -n '62,68p' /app/validator.py\r\n\u001b[?2004l\r"]
[74.943631, "o", "        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n"]
[74.943784, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[76.650646, "i", "sed -i '64s/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' /app/validator.py\n"]
[76.651123, "o", "sed -i '64s/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' /app/validator.py\r\n\u001b[?2004l\r"]
[76.652144, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[77.993025, "i", "sed -i '65s/in_degree\\[dep\\] += 1/in_degree[svc] += 1/' /app/validator.py\n"]
[77.99326, "o", "sed -i '65s/in_degree\\[dep\\] += 1/in_degree[svc] += 1/' /app/validator.py\r\n\u001b[?2004l\r"]
[77.9945, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[79.217621, "i", "sed -n '62,68p' /app/validator.py\n"]
[79.217777, "o", "sed -n '62,68p' /app/validator.py\r\n\u001b[?2004l\r"]
[79.21844, "o", "        for dep in deps:\r\n"]
[79.218553, "o", "            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n\u001b[?2004hroot@d796365c4a34:/app# "]
[80.549944, "i", "sed -i '64,65c\\            graph[dep].append(svc)\\n            in_degree[svc] += 1' /app/validator.py\n"]
[80.550384, "o", "sed -i '64,65c\\            graph[dep].append(svc)\\n            in_degree[svc] += 1' /app/validator.py\r\n\u001b[?2004l\r"]
[80.551627, "o", "\u001b[?2004h"]
[80.551869, "o", "root@d796365c4a34:/app# "]
[81.674456, "i", "sed -n '62,68p' /app/validator.py\n"]
[81.674652, "o", "sed -n '62,68p' /app/validator.py\r\n\u001b[?2004l\r"]
[81.675347, "o", "        for dep in deps:\r\n            graph[svc].append(dep)\r\n            graph[dep].append(svc)\r\n            in_degree[svc] += 1\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n"]
[81.67574, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[82.993199, "i", "sed -i '64d' /app/validator.py\n"]
[82.993442, "o", "sed -i '64d' /app/validator.py\r\n\u001b[?2004l\r"]
[82.994801, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[84.249089, "i", "sed -n '62,68p' /app/validator.py\n"]
[84.249265, "o", "sed -n '62,68p' /app/validator.py\r\n\u001b[?2004l\r"]
[84.250128, "o", "        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[svc] += 1\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n"]
[84.250227, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[85.648974, "i", "sed -n '60,70p' /app/validator.py\n"]
[85.649204, "o", "sed -n '60,70p' /app/validator.py\r\n\u001b[?2004l\r"]
[85.649737, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[svc] += 1\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n"]
[85.64999, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[87.524824, "i", "sed -i '65s/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' /app/validator.py\n"]
[87.525022, "o", "sed -i '65s/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' /app/validator.py\r\n\u001b[?2004l\r"]
[87.526172, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[88.635587, "i", "sed -n '60,70p' /app/validator.py\n"]
[88.635846, "o", "sed -n '60,70p' /app/validator.py\r\n\u001b[?2004l\r"]
[88.636575, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[svc] += 1\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n"]
[88.63689, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[90.059467, "i", "grep -n 'graph\\[svc\\]' /app/validator.py\n"]
[90.059832, "o", "grep -n 'graph\\[svc\\]' /app/validator.py\r\n\u001b[?2004l\r"]
[90.060329, "o", "63:            graph[svc].append(dep)\r\n"]
[90.06049, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[91.735539, "i", "sed -i '63s/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' /app/validator.py\n"]
[91.735734, "o", "sed -i '63s/graph\\[svc\\].append(dep)/graph[dep].append(svc)/' /app/validator.py\r\n\u001b[?2004l\r"]
[91.736889, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[92.889388, "i", "sed -n '60,70p' /app/validator.py\n"]
[92.889527, "o", "sed -n '60,70p' /app/validator.py\r\n\u001b[?2004l\r"]
[92.890728, "o", "\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[dep].append(svc)\r\n            in_degree[svc] += 1\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n"]
[92.890987, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[94.523388, "i", "python3 /app/validator.py | grep -A 1 'Computing startup order'\n"]
[94.523568, "o", "python3 /app/validator.py | grep -A 1 'Computing startup order'\r\n\u001b[?2004l\r"]
[94.594359, "o", "Computing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\n"]
[94.604514, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[99.08627, "i", "python3 /app/validator.py\n"]
[99.086808, "o", "python3 /app/validator.py\r\n\u001b[?2004l\r"]
[99.159873, "o", "Loading deployment manifest ...\r\n"]
[99.16117, "o", "Checking service health ...\r\n"]
[99.163926, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[99.164879, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[99.165547, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[99.16631, "o", "  worker-service            healthy    (HTTP 200)\r\n"]
[99.167131, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[99.167227, "o", "  score = 1.0000\r\n"]
[99.167428, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : healthy\r\nReadiness score: 1.0\r\n"]
[99.175783, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
[105.108662, "i", "cat /app/deployment_report.json\n"]
[105.10892, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[105.109559, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"healthy\",\r\n  \"readiness_score\": 1.0,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T21:19:38.297848+00:00\"\r\n}"]
[105.110069, "o", "\u001b[?2004hroot@d796365c4a34:/app# "]
