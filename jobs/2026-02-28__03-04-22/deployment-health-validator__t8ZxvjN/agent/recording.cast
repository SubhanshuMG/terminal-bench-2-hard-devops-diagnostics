{"version": 2, "width": 160, "height": 40, "timestamp": 1772228072, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.002725, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[0.9975, "i", "clear\r"]
[0.997765, "o", "clear\r\n\u001b[?2004l\r"]
[0.998866, "o", "\u001b[H\u001b[J\u001b[3J"]
[0.999001, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[2.498371, "i", "ls -la /app/\n"]
[2.498762, "o", "ls -la /app/\r\n\u001b[?2004l\r"]
[2.500341, "o", "total 32\r\ndrwxr-xr-x 1 root root 4096 Feb 27 21:31 .\r\ndrwxr-xr-x 1 root root 4096 Feb 27 21:34 ..\r\n-rw-r--r-- 1 root root  698 Feb 27 19:10 Dockerfile\r\n-rw-r--r-- 1 root root 2068 Feb 27 19:22 deployment_manifest.yaml\r\n-rw-r--r-- 1 root root 3183 Feb 27 20:15 mock_services.py\r\n-rw-r--r-- 1 root root   44 Feb 27 18:53 requirements.txt\r\n-rw-r--r-- 1 root root 6490 Feb 27 21:29 validator.py\r\n"]
[2.500564, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[3.544627, "i", "cat /app/deployment_manifest.yaml\n"]
[3.544972, "o", "cat /app/deployment_manifest.yaml\r\n\u001b[?2004l\r"]
[3.545556, "o", "# ─────────────────────────────────────────────────────────────────────────────\r\n# deployment_manifest.yaml\r\n#\r\n# Deployment descriptor for the production stack.\r\n#\r\n# Schema notes:\r\n#   • The top-level 'services' block is a legacy v1 monitoring registry read\r\n#     by the external health-dashboard and alert-manager sidecar.  It is NOT\r\n#     the authoritative list for deployment ordering or health validation.\r\n#   • The authoritative service definitions live under 'deployment.services'.\r\n# ─────────────────────────────────────────────────────────────────────────────\r\n\r\n# Legacy monitoring-registry endpoint  (consumed by alert-manager, not by the validator)\r\nservices:\r\n  - name: \"metrics-collector\"\r\n    port: 9091\r\n    health_endpoint: \"/metrics\"\r\n    dependencies: []\r\n    criticality: \"low\"\r\n\r\n# ── Authoritative deployment configuration ────────────────────────────────────\r\ndeployment:\r\n  name: \"production-stack\"\r\n\r\n  services:\r\n    - name: \"auth-service\"\r\n      port: 8081\r\n      health_endpoint: \"/health\"\r\n      dependencies: []\r\n      criticality: \"high\"\r\n\r\n    - name: \"api-gateway\"\r\n      port: 8082\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"auth-service\"\r\n        - \"cache-service\"\r\n      criticality: \"high\"\r\n\r\n    - name: \"cache-service\"\r\n      port: 8083\r\n      health_endpoint: \"/ping\"\r\n      dependencies: []\r\n      criticality: \"medium\"\r\n\r\n    - name: \"worker-service\"\r\n      port: 8084\r\n      health_endpoint: \"/status\"\r\n      dependencies:\r\n        - \"api-gateway\"\r\n        - \"cache-service\"\r\n      criticality: \"low\"\r\n\r\n    - name: \"notification-service\"\r\n      port: 8085\r\n      health_endpoint: \"/health\"\r\n      dependencies:\r\n        - \"worker-service\"\r\n      criticality: \"low\"\r\n"]
[3.545739, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[4.738326, "i", "curl -s http://localhost:8081/health\n"]
[4.739436, "o", "curl -s http://localhost:8081/health\r\n\u001b[?2004l\r"]
[4.748324, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[5.845288, "i", "ps aux | grep mock\n"]
[5.84786, "o", "ps aux | grep mock\r\n\u001b[?2004l\r"]
[5.848395, "o", "bash: ps: command not found\r\n"]
[5.849102, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[6.916021, "i", "curl -s http://localhost:8081/health || echo \"8081 not responding\"\n"]
[6.916231, "o", "curl -s http://localhost:8081/health || echo \"8081 not responding\"\r\n\u001b[?2004l\r"]
[6.921521, "o", "8081 not responding\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[8.062163, "i", "curl -s http://localhost:8082/health || echo \"8082 not responding\"\n"]
[8.062472, "o", "curl -s http://localhost:8082/health || echo \"8082 not responding\"\r\n\u001b[?2004l\r"]
[8.067405, "o", "8082 not responding\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[8.967015, "i", "cat /app/mock_services.py\n"]
[8.967286, "o", "cat /app/mock_services.py\r\n\u001b[?2004l\r"]
[8.968237, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nMock service health endpoints for the deployment stack.\r\n\r\nServices:\r\n  auth-service        -> port 8081  /health  -> 200  {\"status\": \"ok\"}\r\n  api-gateway         -> port 8082  /health  -> 200  {\"status\": \"healthy\"}\r\n  cache-service       -> port 8083  /ping    -> 200  \"pong\"\r\n  worker-service      -> port 8084  /status  -> 200  {\"status\": \"degraded\"}  (overloaded)\r\n  notification-service-> port 8085  /health  -> 200  {\"status\": \"ok\"}\r\n\"\"\"\r\n\r\nimport threading\r\nfrom flask import Flask, jsonify\r\n\r\nimport logging\r\nlog = logging.getLogger(\"werkzeug\")\r\nlog.setLevel(logging.ERROR)\r\n\r\n# ── auth-service ──────────────────────────────────────────────────────────────\r\nauth_app = Flask(\"auth-service\")\r\n\r\n@auth_app.route(\"/health\")\r\ndef auth_health():\r\n    return jsonify({\"status\": \"ok\", \"version\": \"2.1.0\"}), 200\r\n\r\n\r\n# ── api-gateway ───────────────────────────────────────────────────────────────\r\ngateway_app = Flask(\"api-gateway\")\r\n\r\n@gateway_app.route(\"/health\")\r\ndef gateway_health():\r\n    return jsonify({\"status\": \"healthy\", \"uptime_seconds\": 3601}), 200\r\n\r\n\r\n# ── cache-service  (uses /ping, NOT /health) ──────────────────────────────────\r\ncache_app = Flask(\"cache-service\")\r\n\r\n@cache_app.route(\"/ping\")\r\ndef cache_ping():\r\n    return \"pong\", 200\r\n\r\n\r\n# ── worker-service  (uses /status — HTTP 200 but queue overloaded/degraded) ───\r\nworker_app = Flask(\"worker-service\")\r\n\r\n@worker_app.route(\"/status\")\r\ndef worker_status():\r\n    return jsonify({\"status\": \"degraded\", \"queue_depth\": 1482}), 200\r\n\r\n\r\n# ── notification-service ──────────────────────────────────────────────────────\r\nnotif_app = Flask(\"notification-service\")\r\n\r\n@notif_app.route(\"/health\")\r\ndef notif_health():\r\n    return jsonify({\"status\": \"ok\", \"pending_notifications\": 0}), 200\r\n\r\n\r\n# ── runner ────────────────────────────────────────────────────────────────────\r\ndef _run(app, port):\r\n    app.run(host=\"0.0.0.0\", port=port, debug=False, use_reloader=False)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    specs = [\r\n        (auth_app,    8081, \"auth-service         /health\"),\r\n        (gateway_app, 8082, \"api-gateway          /health\"),\r\n        (cache_app,   8083, \"cache-service        /ping  \"),\r\n        (worker_app,  8084, \"worker-service       /status\"),\r\n        (notif_app,   8085, \"notification-service /health\"),\r\n    ]\r\n\r\n    threads = []\r\n    for app, port, label in specs:\r\n        t = threading.Thread(target=_run, args=(app, port), daemon=True)\r\n        t.start()\r\n        threads.append(t)\r\n        print(f\"  started  {label}  -> http://0.0.0.0:{port}\")\r\n\r\n    print(\"All mock services running. Ctrl-C to stop.\")\r\n    for t in threads:\r\n        t.join()\r\n"]
[8.968352, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[10.09525, "i", "python3 /app/mock_services.py &\n"]
[10.095872, "o", "python3 /app/mock_services.py &\r\n\u001b[?2004l\r[1] 666\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[10.247841, "o", "  started  auth-service         /health  -> http://0.0.0.0:8081\r\n"]
[10.248, "o", " * Serving Flask app 'auth-service'\r\n * Debug mode: off\r\n"]
[10.248319, "o", " * Serving Flask app 'api-gateway'\r\n  started  api-gateway          /health  -> http://0.0.0.0:8082\r\n"]
[10.24861, "o", " * Debug mode: off\r\n"]
[10.248908, "o", " * Serving Flask app 'cache-service'\r\n"]
[10.24989, "o", " * Debug mode: off\r\n"]
[10.250039, "o", "  started  cache-service        /ping    -> http://0.0.0.0:8083\r\n"]
[10.250261, "o", " * Serving Flask app 'worker-service'\r\n * Debug mode: off\r\n"]
[10.250336, "o", "  started  worker-service       /status  -> http://0.0.0.0:8084\r\n"]
[10.250902, "o", "  started  notification-service /health  -> http://0.0.0.0:8085\r\n"]
[10.251081, "o", "All mock services running. Ctrl-C to stop.\r\n"]
[10.251182, "o", " * Serving Flask app 'notification-service'\r\n * Debug mode: off\r\n"]
[12.066137, "i", "curl -s http://localhost:8081/health\n"]
[12.066551, "o", "curl -s http://localhost:8081/health\r\n\u001b[?2004l\r"]
[12.070356, "o", "{\"status\":\"ok\",\"version\":\"2.1.0\"}\r\n"]
[12.070757, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[13.058505, "i", "curl -s http://localhost:8083/ping\n"]
[13.059028, "o", "curl -s http://localhost:8083/ping\r\n\u001b[?2004l\r"]
[13.064272, "o", "pong"]
[13.064781, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[14.05659, "i", "cat /app/validator.py\n"]
[14.056819, "o", "cat /app/validator.py\r\n\u001b[?2004l\r"]
[14.057551, "o", "#!/usr/bin/env python3\r\n\"\"\"\r\nDeployment Health Validator\r\n===========================\r\nReads deployment_manifest.yaml, probes each service's health endpoint,\r\ncomputes a weighted readiness score, determines a valid startup ordering,\r\nand writes a deployment readiness report to /app/deployment_report.json.\r\n\"\"\"\r\n\r\nimport json\r\nimport yaml\r\nimport requests\r\nfrom datetime import datetime, timezone\r\nfrom collections import deque\r\n\r\n\r\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\r\ndef load_services(manifest_path: str) -> list:\r\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n    with open(manifest_path) as f:\r\n        config = yaml.safe_load(f)\r\n    # Returns the top-level 'services' list from the manifest.\r\n    return config[\"services\"]\r\n\r\n\r\n# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\r\ndef check_health(service: dict) -> dict:\r\n    \"\"\"Probe a single service and return its health record.\"\"\"\r\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n    try:\r\n        resp = requests.get(url, timeout=5)\r\n        if resp.status_code != 200:\r\n            return {\r\n                \"status\": \"unhealthy\",\r\n                \"http_status\": resp.status_code,\r\n                \"criticality\": service[\"criticality\"],\r\n            }\r\n        try:\r\n            body = resp.json()\r\n            state = body.get(\"health_status\", \"ok\")\r\n        except ValueError:\r\n            state = \"ok\"\r\n        healthy = state in (\"ok\", \"up\", \"healthy\")\r\n        return {\r\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n            \"http_status\": resp.status_code,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n    except requests.exceptions.RequestException:\r\n        return {\r\n            \"status\": \"unhealthy\",\r\n            \"http_status\": 0,\r\n            \"criticality\": service[\"criticality\"],\r\n        }\r\n\r\n\r\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\r\ndef compute_startup_order(services: list) -> list:\r\n    \"\"\"\r\n    Return a topologically sorted startup order using Kahn's algorithm.\r\n    Dependencies must start before the services that depend on them.\r\n    \"\"\"\r\n    names = [s[\"name\"] for s in services]\r\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\r\n    graph     = {n: [] for n in names}\r\n    in_degree = {n: 0 for n in names}\r\n\r\n    for svc, deps in deps_map.items():\r\n        for dep in deps:\r\n            graph[svc].append(dep)\r\n            in_degree[dep] += 1\r\n\r\n    queue = deque(n for n in names if in_degree[n] == 0)\r\n    order = []\r\n    while queue:\r\n        node = queue.popleft()\r\n        order.append(node)\r\n        for neighbor in graph[node]:\r\n            in_degree[neighbor] -= 1\r\n            if in_degree[neighbor] == 0:\r\n                queue.append(neighbor)\r\n    return order\r\n\r\n\r\n# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\r\ndef compute_readiness_score(services: list, statuses: dict) -> float:\r\n    \"\"\"\r\n    Compute the weighted fraction of healthy services.\r\n    Criticality weights: high=3, medium=2, low=1.\r\n    \"\"\"\r\n    weight_map = {\"high\": 1, \"medium\": 1, \"low\": 1}\r\n\r\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n    healthy = sum(\r\n        weight_map[s[\"criticality\"]]\r\n        for s in services\r\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n    )\r\n    return round(healthy / total, 4) if total else 0.0\r\n\r\n\r\n# ── 5. Overall status ──────────────────────────"]
[14.057992, "o", "───────────────────────────────\r\n\r\ndef determine_status(services: list, statuses: dict, score: float):\r\n    \"\"\"\r\n    Returns (overall_status, critical_services_healthy).\r\n\r\n    Status rules:\r\n      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n      'degraded'  -- critical_services_healthy AND score < 0.95\r\n      'critical'  -- any high-criticality service is unhealthy\r\n      'not_ready' -- score < 0.70\r\n    \"\"\"\r\n    critical_ok = all(\r\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n        for s in services\r\n    )\r\n\r\n    if not critical_ok:\r\n        return \"critical\", critical_ok\r\n    if score >= 0.95:\r\n        return \"healthy\", critical_ok\r\n    if score >= 0.70:\r\n        return \"degraded\", critical_ok\r\n    return \"not_ready\", critical_ok\r\n\r\n\r\n# ── main ──────────────────────────────────────────────────────────────────────\r\n\r\ndef main():\r\n    manifest_path = \"/app/deployment_manifest.yaml\"\r\n    output_path   = \"/app/deployment_report.json\"\r\n\r\n    print(\"Loading deployment manifest ...\")\r\n    services = load_services(manifest_path)\r\n\r\n    print(\"Checking service health ...\")\r\n    statuses = {}\r\n    for svc in services:\r\n        result = check_health(svc)\r\n        statuses[svc[\"name\"]] = result\r\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\r\n    print(\"Computing startup order ...\")\r\n    startup_order = compute_startup_order(services)\r\n    print(f\"  {' -> '.join(startup_order)}\")\r\n\r\n    print(\"Computing readiness score ...\")\r\n    score = compute_readiness_score(services, statuses)\r\n    print(f\"  score = {score:.4f}\")\r\n\r\n    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\r\n    report = {\r\n        \"deployment_name\":           \"production-stack\",\r\n        \"overall_status\":            overall_status,\r\n        \"readiness_score\":           score,\r\n        \"service_statuses\":          statuses,\r\n        \"startup_order\":             startup_order,\r\n        \"critical_services_healthy\": critical_ok,\r\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n    }\r\n\r\n    with open(output_path, \"w\") as f:\r\n        json.dump(report, f, indent=2)\r\n\r\n    print(f\"\\nReport written to {output_path}\")\r\n    print(f\"Overall status : {overall_status}\")\r\n    print(f\"Readiness score: {score}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[15.599355, "i", "cp /app/validator.py /app/validator.py.backup\n"]
[15.600271, "o", "cp /app/validator.py /app/validator.py.backup\r\n\u001b[?2004l\r"]
[15.602391, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[20.742882, "i", "cat > /app/validator.py << 'EOF'\n#!/usr/bin/env python3\n\"\"\"\nDeployment Health Validator\n===========================\nReads deployment_manifest.yaml, probes each service's health endpoint,\ncomputes a weighted readiness score, determines a valid startup ordering,\nand writes a deployment readiness report to /app/deployment_report.json.\n\"\"\"\n\nimport json\nimport yaml\nimport requests\nfrom datetime import datetime, timezone\nfrom collections import deque\n\n\n# ── 1. Load manifest ──────────────────────────────────────────────────────────\n\ndef load_services(manifest_path: str) -> list:\n    \"\"\"Return the list of service definitions from the manifest.\"\"\"\n    with open(manifest_path) as f:\n        config = yaml.safe_load(f)\n    # Returns the 'deployment.services' list from the manifest.\n    return config[\"deployment\"][\"services\"]\n\n\n# ── 2. Health check ───────────────────────────────────────────────────────────\n\ndef check_health(service: dict) -> dict:\n    \"\"\"Probe a single service and return its health record.\"\"\"\n    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\n    try:\n        resp = requests.get(url, timeout=5)\n        if resp.status_code != 200:\n            return {\n                \"status\": \"unhealthy\",\n                \"http_status\": resp.status_code,\n                \"criticality\": service[\"criticality\"],\n            }\n        try:\n            # Handle different response formats\n            if service['name'] == 'cache-service':\n                # cache-service returns plain text 'pong'\n                state = \"ok\" if resp.text.strip() == \"pong\" else \"unhealthy\"\n            else:\n                # Other services return JSON\n                body = resp.json()\n                state = body.get(\"status\", \"ok\")\n        except ValueError:\n            state = \"ok\"\n        \n        # Map various status values to healthy/unhealthy\n        healthy_states = [\"ok\", \"up\", \"healthy\"]\n        healthy = state in healthy_states\n        \n        return {\n            \"status\": \"healthy\" if healthy else \"unhealthy\",\n            \"http_status\": resp.status_code,\n            \"criticality\": service[\"criticality\"],\n        }\n    except requests.exceptions.RequestException:\n        return {\n            \"status\": \"unhealthy\",\n            \"http_status\": 0,\n            \"criticality\": service[\"criticality\"],\n        }\n\n\n# ── 3. Startup ordering ───────────────────────────────────────────────────────\n\ndef compute_startup_order(services: list) -> list:\n    \"\"\"\n    Return a topologically sorted startup order using Kahn's algorithm.\n    Dependencies must start before the services that depend on them.\n    \"\"\"\n    names = [s[\"name\"] for s in services]\n    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\n\n    graph     = {n: [] for n in names}\n    in_degree = {n: 0 for n in names}\n\n    for svc, deps in deps_map.items():\n        for dep in deps:\n            graph[dep].append(svc)  # dep must come before svc\n            in_degree[svc] += 1\n\n    queue = deque(n for n in names if in_degree[n] == 0)\n    order = []\n    while queue:\n        node = queue.popleft()\n        order.append(node)\n        for neighbor in graph[node]:\n            in_degree[neighbor] -= 1\n            if in_degree[neighbor] == 0:\n                queue.append(neighbor)\n    return order\n\n\n# ── 4. Readiness score ────────────────────────────────────────────────────────\n\ndef compute_readiness_score(services: list, statuses: dict) -> float:\n    \"\"\"\n    Compute the weighted fraction of healthy services.\n    Criticality weights: high=3, medium=2, low=1.\n    \"\"\"\n    weight_map = {\"high\": 3, \"medium\": 2"]
[20.74302, "i", ", \"low\": 1}\n\n    total   = sum(weight_map[s[\"criticality\"]] for s in services)\n    healthy = sum(\n        weight_map[s[\"criticality\"]]\n        for s in services\n        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\n    )\n    return round(healthy / total, 4) if total else 0.0\n\n\n# ── 5. Overall status ─────────────────────────────────────────────────────────\n\ndef determine_status(services: list, statuses: dict, score: float):\n    \"\"\"\n    Returns (overall_status, critical_services_healthy).\n\n    Status rules:\n      'healthy'   -- critical_services_healthy AND score >= 0.95\n      'degraded'  -- critical_services_healthy AND score < 0.95\n      'critical'  -- any high-criticality service is unhealthy\n      'not_ready' -- score < 0.70\n    \"\"\"\n    critical_ok = all(\n        statuses[s[\"name\"]][\"status\"] == \"healthy\"\n        for s in services\n        if s[\"criticality\"] == \"high\"\n    )\n\n    if score < 0.70:\n        return \"not_ready\", critical_ok\n    if not critical_ok:\n        return \"critical\", critical_ok\n    if score >= 0.95:\n        return \"healthy\", critical_ok\n    return \"degraded\", critical_ok\n\n\n# ── main ──────────────────────────────────────────────────────────────────────\n\ndef main():\n    manifest_path = \"/app/deployment_manifest.yaml\"\n    output_path   = \"/app/deployment_report.json\"\n\n    print(\"Loading deployment manifest ...\")\n    services = load_services(manifest_path)\n\n    print(\"Checking service health ...\")\n    statuses = {}\n    for svc in services:\n        result = check_health(svc)\n        statuses[svc[\"name\"]] = result\n        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\n\n    print(\"Computing startup order ...\")\n    startup_order = compute_startup_order(services)\n    print(f\"  {' -> '.join(startup_order)}\")\n\n    print(\"Computing readiness score ...\")\n    score = compute_readiness_score(services, statuses)\n    print(f\"  score = {score:.4f}\")\n\n    overall_status, critical_ok = determine_status(services, statuses, score)\n\n    report = {\n        \"deployment_name\":           \"production-stack\",\n        \"overall_status\":            overall_status,\n        \"readiness_score\":           score,\n        \"service_statuses\":          statuses,\n        \"startup_order\":             startup_order,\n        \"critical_services_healthy\": critical_ok,\n        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\n    }\n\n    with open(output_path, \"w\") as f:\n        json.dump(report, f, indent=2)\n\n    print(f\"\\nReport written to {output_path}\")\n    print(f\"Overall status : {overall_status}\")\n    print(f\"Readiness score: {score}\")\n\n\nif __name__ == \"__main__\":\n    main()\nEOF\n"]
[20.74341, "o", "cat > /app/validator.py << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.744614, "o", "#!/usr/bin/env python3\r\n\u001b[?2004l\r\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> Deployment Health Validator\r\n\u001b[?2004l\r\u001b[?2004h> ===========================\r\n\u001b[?2004l\r\u001b[?2004h> Reads deployment_manifest.yaml, probes each service's health endpoint,\r\n\u001b[?2004l\r\u001b[?2004h> computes a weighted readiness score, determines a valid startup ordering,\r\n\u001b[?2004l\r\u001b[?2004h> and writes a deployment readiness report to /app/deployment_report.json.\r\n\u001b[?2004l\r\u001b[?2004h> \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> import json\r\n\u001b[?2004l\r\u001b[?2004h> import yaml\r\n\u001b[?2004l\r\u001b[?2004h> import requests\r\n\u001b[?2004l\r\u001b[?2004h> from datetime import datetime, timezone\r\n\u001b[?2004l\r\u001b[?2004h> from collections import deque\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # ── 1. Load manifest ──────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.74558, "o", "def load_services(manifest_path: str) -> list:\r\n\u001b[?2004l\r   \u001b[?2004h>     \"\"\"Return the list of service definitions from the manifest.\"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     with open(manifest_path) as f:\r\n\u001b[?2004l\ry se\u001b[?2004h>         config = yaml.safe_load(f)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.745749, "o", "    # Returns the 'deployment.services' list from the manifest.\r\n\u001b[?2004l\r"]
[20.745897, "o", "\u001b[?2004h> "]
[20.746034, "o", "    return config[\"deployment\"][\"services\"]\r\n\u001b[?2004l\r"]
[20.746172, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[20.746293, "o", "\u001b[?2004h> "]
[20.74651, "o", "# ── 2. Health check ───────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r9"]
[20.746587, "o", "\u001b[?2004h> "]
[20.746647, "o", "def check_health(service: dict) -> dict:\r\n\u001b[?2004l\r"]
[20.746686, "o", "\u001b[?2004h> "]
[20.746819, "o", "    \"\"\"Probe a single service and return its health record.\"\"\"\r\n\u001b[?2004l\r"]
[20.746838, "o", "\u001b[?2004h> "]
[20.747095, "o", "    url = f\"http://127.0.0.1:{service['port']}{service['health_endpoint']}\"\r\n\u001b[?2004l\r\u001b[?2004h>     try:\r\n\u001b[?2004l\r"]
[20.747175, "o", "\u001b[?2004h> "]
[20.747311, "o", "        resp = requests.get(url, timeout=5)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.747413, "o", "        if resp.status_code != 200:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.747474, "o", "            return {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.747615, "o", "                \"status\": \"unhealthy\",\r\n\u001b[?2004l\rfest_\u001b[?2004h> "]
[20.747697, "o", "                \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.747809, "o", "                \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r"]
[20.747832, "o", "\u001b[?2004h> "]
[20.747874, "o", "            }\r\n\u001b[?2004l\r"]
[20.747911, "o", "\u001b[?2004h>         try:\r\n\u001b[?2004l\r\u001b[?2004h"]
[20.747929, "o", "> "]
[20.748022, "o", "            # Handle different response formats\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.748094, "o", "            if service['name'] == 'cache-service':\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.748191, "o", "                # cache-service returns plain text 'pong'\r\n\u001b[?2004l\r_h"]
[20.748296, "o", "\u001b[?2004h> "]
[20.748456, "o", "                state = \"ok\" if resp.text.strip() == \"pong\" else \"unhealthy\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.748511, "o", "            else:\r\n\u001b[?2004l\r"]
[20.748567, "o", "\u001b[?2004h>                 # Other services return JSON\r\n\u001b[?2004l\r"]
[20.748725, "o", "\u001b[?2004h> "]
[20.748742, "o", "                body = resp.json()\r\n\u001b[?2004l\rd\u001b[?2004h> "]
[20.748842, "o", "                state = body.get(\"status\", \"ok\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.748861, "o", "        except ValueError:\r\n\u001b[?2004l\r"]
[20.748939, "o", "\u001b[?2004h>             state = \"ok\"\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r\u001b[?2004h"]
[20.748952, "o", "> "]
[20.749061, "o", "        # Map various status values to healthy/unhealthy\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.749154, "o", "        healthy_states = [\"ok\", \"up\", \"healthy\"]\r\n\u001b[?2004l\r(\u001b[?2004h> "]
[20.74956, "o", "        healthy = state in healthy_states\r\n\u001b[?2004l\r\u001b[?2004h>         \r\n\u001b[?2004l\r\u001b[?2004h>         return {\r\n\u001b[?2004l\r\u001b[?2004h>             \"status\": \"healthy\" if healthy else \"unhealthy\",\r\n\u001b[?2004l\r    \u001b[?2004h>             \"http_status\": resp.status_code,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.749629, "o", "            \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r       overall_status,\r\n    \u001b[?2004h> "]
[20.750557, "o", "    except requests.exceptions.RequestException:\r\n\u001b[?2004l\r\u001b[?2004h>         return {\r\n\u001b[?2004l\re_statuses\"\u001b[?2004h>             \"status\": \"unhealthy\",\r\n\u001b[?2004l\r   statuses,\r\n        \"start\u001b[?2004h> "]
[20.750581, "o", "            \"http_status\": 0,\r\n\u001b[?2004l\r         startup\u001b[?2004h>             \"criticality\": service[\"criticality\"],\r\n\u001b[?2004l\r\u001b[?2004h>         }\r\n\u001b[?2004l\r \u001b[?2004h> \r\n\u001b[?2004l\r \u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.751172, "o", "# ── 3. Startup ordering ───────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> def compute_startup_order(services: list) -> list:\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     Return a topologically sorted startup order using Kahn's algorithm.\r\n\u001b[?2004l\r\u001b[?2004h>     Dependencies must start before the services that depend on them.\r\n\u001b[?2004l\r"]
[20.751195, "o", "\u001b[?2004h> "]
[20.751252, "o", "    \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.751333, "o", "    names = [s[\"name\"] for s in services]\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.751537, "o", "    deps_map = {s[\"name\"]: s.get(\"dependencies\", []) for s in services}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     graph     = {n: [] for n in names}\r\n\u001b[?2004l\r"]
[20.751592, "o", "\u001b[?2004h>     in_degree = {n: 0 for n in names}\r\n\u001b[?2004l\r"]
[20.751615, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.752601, "o", "    for svc, deps in deps_map.items():\r\n\u001b[?2004l\r\u001b[?2004h>         for dep in deps:\r\n\u001b[?2004l\r\u001b[?2004h>             graph[dep].append(svc)  # dep must come before svc\r\n\u001b[?2004l\r\u001b[?2004h>             in_degree[svc] += 1\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     queue = deque(n for n in names if in_degree[n] == 0)\r\n\u001b[?2004l\r\u001b[?2004h>     order = []\r\n\u001b[?2004l\r\u001b[?2004h>     while queue:\r\n\u001b[?2004l\r\u001b[?2004h>         node = queue.popleft()\r\n\u001b[?2004l\r\u001b[?2004h>         order.append(node)\r\n\u001b[?2004l\r\u001b[?2004h>         for neighbor in graph[node]:\r\n\u001b[?2004l\r\u001b[?2004h>             in_degree[neighbor] -= 1\r\n\u001b[?2004l\r\u001b[?2004h>             if in_degree[neighbor] == 0:\r\n\u001b[?2004l\r\u001b[?2004h>                 queue.append(neighbor)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.752646, "o", "    return order\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.75289, "o", "# ── 4. Readiness score ────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[20.752914, "o", "> "]
[20.752976, "o", "def compute_readiness_score(services: list, statuses: dict) -> float:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.753063, "o", "    \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[20.75313, "o", ">     Compute the weighted fraction of healthy services.\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.75323, "o", "    Criticality weights: high=3, medium=2, low=1.\r\n\u001b[?2004l\r\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.753267, "o", "    weight_map = {\"high\": 3, \"medium\": 2, \"low\": 1}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[20.75333, "o", "\u001b[?2004h>     total   = sum(weight_map[s[\"criticality\"]] for s in services)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.753413, "o", "    healthy = sum(\r\n\u001b[?2004l\r\u001b[?2004h>         weight_map[s[\"criticality\"]]\r\n\u001b[?2004l\r"]
[20.75347, "o", "\u001b[?2004h>         for s in services\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.753499, "o", "        if statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.753565, "o", "    return round(healthy / total, 4) if total else 0.0\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.753758, "o", "# ── 5. Overall status ─────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[20.753809, "o", "\u001b[?2004h> "]
[20.753895, "o", "def determine_status(services: list, statuses: dict, score: float):\r\n\u001b[?2004l\r"]
[20.753929, "o", "\u001b[?2004h>     \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     Returns (overall_status, critical_services_healthy).\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.75401, "o", "    Status rules:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.754056, "o", "      'healthy'   -- critical_services_healthy AND score >= 0.95\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.754144, "o", "      'degraded'  -- critical_services_healthy AND score < 0.95\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.754181, "o", "      'critical'  -- any high-criticality service is unhealthy\r\n\u001b[?2004l\r"]
[20.754208, "o", "\u001b[?2004h> "]
[20.754267, "o", "      'not_ready' -- score < 0.70\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.754343, "o", "    \"\"\"\r\n\u001b[?2004l\r\u001b[?2004h>     critical_ok = all(\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.754447, "o", "        statuses[s[\"name\"]][\"status\"] == \"healthy\"\r\n\u001b[?2004l\r\u001b[?2004h>         for s in services\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.75454, "o", "        if s[\"criticality\"] == \"high\"\r\n\u001b[?2004l\r\u001b[?2004h>     )\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     if score < 0.70:\r\n\u001b[?2004l\r\u001b[?2004h>         return \"not_ready\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.754664, "o", "    if not critical_ok:\r\n\u001b[?2004l\r\u001b[?2004h>         return \"critical\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h"]
[20.754719, "o", ">     if score >= 0.95:\r\n\u001b[?2004l\r"]
[20.754793, "o", "\u001b[?2004h> "]
[20.754833, "o", "        return \"healthy\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h>     return \"degraded\", critical_ok\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[20.754863, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[20.754951, "o", "\u001b[?2004h> "]
[20.755059, "o", "# ── main ──────────────────────────────────────────────────────────────────────\r\n\u001b[?2004l\r\u001b[?2004h> \r\n"]
[20.755074, "o", "\u001b[?2004l\r\u001b[?2004h"]
[20.755144, "o", "> def main():\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755186, "o", "    manifest_path = \"/app/deployment_manifest.yaml\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755215, "o", "    output_path   = \"/app/deployment_report.json\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[20.755246, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755304, "o", "    print(\"Loading deployment manifest ...\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755384, "o", "    services = load_services(manifest_path)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755459, "o", "    print(\"Checking service health ...\")\r\n\u001b[?2004l\r\u001b[?2004h>     statuses = {}\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755507, "o", "    for svc in services:\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755549, "o", "        result = check_health(svc)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755615, "o", "        statuses[svc[\"name\"]] = result\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755697, "o", "        print(f\"  {svc['name']:25s} {result['status']:10s} (HTTP {result['http_status']})\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.755766, "o", "    print(\"Computing startup order ...\")\r\n\u001b[?2004l\r\u001b[?2004h>     startup_order = compute_startup_order(services)\r\n\u001b[?2004l\r"]
[20.755816, "o", "\u001b[?2004h> "]
[20.755875, "o", "    print(f\"  {' -> '.join(startup_order)}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h>     print(\"Computing readiness score ...\")\r\n\u001b[?2004l\r"]
[20.755926, "o", "\u001b[?2004h> "]
[20.755987, "o", "    score = compute_readiness_score(services, statuses)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756028, "o", "    print(f\"  score = {score:.4f}\")\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756114, "o", "    overall_status, critical_ok = determine_status(services, statuses, score)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756169, "o", "\r\n\u001b[?2004l\r"]
[20.756226, "o", "\u001b[?2004h>     report = {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.75629, "o", "        \"deployment_name\":           \"production-stack\",\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.75637, "o", "        \"overall_status\":            overall_status,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756412, "o", "        \"readiness_score\":           score,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756431, "o", "        \"service_statuses\":          statuses,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756493, "o", "        \"startup_order\":             startup_order,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756575, "o", "        \"critical_services_healthy\": critical_ok,\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756592, "o", "        \"timestamp\":                 datetime.now(timezone.utc).isoformat(),\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756628, "o", "    }\r\n\u001b[?2004l\r\u001b[?2004h"]
[20.756687, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756759, "o", "    with open(output_path, \"w\") as f:\r\n\u001b[?2004l\r\u001b[?2004h>         json.dump(report, f, indent=2)\r\n\u001b[?2004l\r"]
[20.756815, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756894, "o", "    print(f\"\\nReport written to {output_path}\")\r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.756951, "o", "    print(f\"Overall status : {overall_status}\")\r\n\u001b[?2004l\r\u001b[?2004h>     print(f\"Readiness score: {score}\")\r\n\u001b[?2004l\r"]
[20.756972, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[20.757033, "o", "if __name__ == \"__main__\":\r\n\u001b[?2004l\r\u001b[?2004h>     main()\r\n\u001b[?2004l\r\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[20.75834, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[22.261402, "i", "python3 /app/validator.py\n"]
[22.261564, "o", "python3 /app/validator.py\r\n\u001b[?2004l\r"]
[22.321733, "o", "Loading deployment manifest ...\r\n"]
[22.323059, "o", "Checking service health ...\r\n"]
[22.325023, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[22.325866, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[22.326619, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[22.327271, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[22.327944, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[22.328008, "o", "  score = 0.9000\r\n"]
[22.328138, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[22.337036, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[26.270199, "i", "cat /app/deployment_report.json\n"]
[26.270654, "o", "cat /app/deployment_report.json\r\n\u001b[?2004l\r"]
[26.271344, "o", "{\r\n  \"deployment_name\": \"production-stack\",\r\n  \"overall_status\": \"degraded\",\r\n  \"readiness_score\": 0.9,\r\n  \"service_statuses\": {\r\n    \"auth-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"api-gateway\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"high\"\r\n    },\r\n    \"cache-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"medium\"\r\n    },\r\n    \"worker-service\": {\r\n      \"status\": \"unhealthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    },\r\n    \"notification-service\": {\r\n      \"status\": \"healthy\",\r\n      \"http_status\": 200,\r\n      \"criticality\": \"low\"\r\n    }\r\n  },\r\n  \"startup_order\": [\r\n    \"auth-service\",\r\n    \"cache-service\",\r\n    \"api-gateway\",\r\n    \"worker-service\",\r\n    \"notification-service\"\r\n  ],\r\n  \"critical_services_healthy\": true,\r\n  \"timestamp\": \"2026-02-27T21:34:54.477574+00:00\"\r\n}\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[28.415678, "i", "echo \"Manual verification of readiness score:\"\necho \"High (auth-service, api-gateway): 2 services * 3 weight = 6\"\necho \"Medium (cache-service): 1 service * 2 weight = 2\"\necho \"Low (worker-service unhealthy, notification-service): 1 service * 1 weight = 1\"\necho \"Total weight: 6 + 2 + 1 = 9\"\necho \"Healthy weight: (2*3) + (1*2) + (1*1) = 9\"\necho \"Score: 9/9 = 1.0, but since worker-service is unhealthy: (6+2+1)/(6+2+1+1) = 9/10 = 0.9\"\necho \"This matches our calculated score of 0.9\"\n"]
[28.416104, "o", "echo \"Manual verification of readiness score:\"\r\n"]
[28.4163, "o", "\u001b[?2004l\r"]
[28.416339, "o", "Manual verification of readiness score:\r\n"]
[28.416742, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# echo \"High (auth-service, api-gateway): 2 services * 3 weight = 6\"\r\n\u001b[?2004l\rHigh (auth-service, api-gateway): 2 services * 3 weight = 6\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# echo \"Medium (cache-service): 1 service * 2 weight = 2\"\r\n\u001b[?2004l\rMedium (cache-service): 1 service * 2 weight = 2\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[28.416864, "o", "echo \"Low (worker-service unhealthy, notification-service): 1 service * 1 weight = 1\""]
[28.417227, "o", "\r\n\u001b[?2004l\rLow (worker-service unhealthy, notification-service): 1 service * 1 weight = 1\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[28.417249, "o", "echo \"Total weight: 6 + 2 + 1 = 9\"\r\n\u001b[?2004l\r"]
[28.417258, "o", "Total weight: 6 + 2 + 1 = 9\r\n"]
[28.417381, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# echo \"Healthy weight: (2*3) + (1*2) + (1*1) = 9\"\r\n\u001b[?2004l\rHealthy weight: (2*3) + (1*2) + (1*1) = 9\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[28.417435, "o", "echo \"Score: 9/9 = 1.0, but since worker-service is unhealthy: (6+2+1)/(6+2+1+1) = 9/10 = 0.9\"\r\n\u001b[?2004l\r"]
[28.417497, "o", "Score: 9/9 = 1.0, but since worker-service is unhealthy: (6+2+1)/(6+2+1+1) = 9/10 = 0.9\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[28.417659, "o", "echo \"This matches our calculated score of 0.9\"\r\n\u001b[?2004l\r"]
[28.417738, "o", "This matches our calculated score of 0.9\r\n\u001b[?2004hroot@1bbef5e29b1e:/app# "]
[30.993482, "i", "python3 /app/validator.py\n"]
[30.993716, "o", "python3 /app/validator.py\r\n\u001b[?2004l\r"]
[31.063876, "o", "Loading deployment manifest ...\r\n"]
[31.06393, "o", "Checking service health ...\r\n"]
[31.068201, "o", "  auth-service              healthy    (HTTP 200)\r\n"]
[31.069106, "o", "  api-gateway               healthy    (HTTP 200)\r\n"]
[31.069893, "o", "  cache-service             healthy    (HTTP 200)\r\n"]
[31.070535, "o", "  worker-service            unhealthy  (HTTP 200)\r\n"]
[31.071206, "o", "  notification-service      healthy    (HTTP 200)\r\nComputing startup order ...\r\n  auth-service -> cache-service -> api-gateway -> worker-service -> notification-service\r\nComputing readiness score ...\r\n"]
[31.071224, "o", "  score = 0.9000\r\n"]
[31.071402, "o", "\r\nReport written to /app/deployment_report.json\r\nOverall status : degraded\r\nReadiness score: 0.9\r\n"]
[31.08044, "o", "\u001b[?2004hroot@1bbef5e29b1e:/app# "]
